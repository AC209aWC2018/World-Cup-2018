<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Milestone 3 &#8212; World Cup  documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          World Cup</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption"><span class="caption-text">Introduction:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="problem_statement.html">Overview and Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="related_works.html">Literature Review and Related Works</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_description.html">Description of Data</a></li>
</ul>
<p class="caption"><span class="caption-text">EDA:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../EDA-notebook.html">Exploratory Data Analysis</a></li>
</ul>
<p class="caption"><span class="caption-text">Models:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../models/baseline_model.html">Baseline Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/beyond_baseline.html">Modeling with Feature Engineered Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/neural_net.html">Bonus: Neural Network on Small Training Set</a></li>
</ul>
<p class="caption"><span class="caption-text">Conclusion:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="summary.html">Summary and Future Work</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Milestone 3</a><ul>
<li><a class="reference internal" href="#Data-Sources">Data Sources</a></li>
<li><a class="reference internal" href="#Data-Cleaning">Data Cleaning</a><ul>
<li><a class="reference internal" href="#European-Soccer-Database">European Soccer Database</a></li>
<li><a class="reference internal" href="#Sofifa">Sofifa</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Feature-Engineering">Feature Engineering</a></li>
<li><a class="reference internal" href="#Exploratory-Data-Analysis">Exploratory Data Analysis</a><ul>
<li><a class="reference internal" href="#European-Soccer-Database">European Soccer Database</a></li>
<li><a class="reference internal" href="#Sofifa">Sofifa</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Baseline-Models">Baseline Models</a></li>
<li><a class="reference internal" href="#Problems-Encountered-and-Attempts-to-Solve-the-Problems">Problems Encountered and Attempts to Solve the Problems</a><ul>
<li><a class="reference internal" href="#1.-Different-Naming-Conventions-for-Countries,-Players,-and-Teams">1. Different Naming Conventions for Countries, Players, and Teams</a></li>
<li><a class="reference internal" href="#2.-Non-FIFA-Affiliated-Teams">2. Non-FIFA Affiliated Teams</a></li>
<li><a class="reference internal" href="#Aftermath-for-1.-and-2.">Aftermath for 1. and 2.</a></li>
<li><a class="reference internal" href="#3.-Correctly-Matching-the-Players-of-a-Team">3. Correctly Matching the Players of a Team</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/doc/milestone3.ipynb.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 9ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }
</style>
<div class="section" id="Milestone-3">
<h1>Milestone 3<a class="headerlink" href="#Milestone-3" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Data-Sources">
<h2>Data Sources<a class="headerlink" href="#Data-Sources" title="Permalink to this headline">¶</a></h2>
<p>We were able to find a dataset on Kaggle that contains all <a class="reference external" href="https://www.kaggle.com/tadhgfitzgerald/fifa-international-soccer-mens-ranking-1993now">FIFA
international men teams’ rankings from August 1993 to June
2018</a>.
This dataset will prove essential in building our baseline model using
essentially only the FIFA rankings and basic summary statistics about
the teams.</p>
<p>We also found a database on Kaggle that contains data about <a class="reference external" href="https://www.kaggle.com/hugomathien/soccer">European
matches</a> for the seasons
Seasons 2008 to 2016 that also contain information about the teams and
players. We primarily used this database to see look at individual
ratings of players.</p>
<p>We were able to find a dataset on Gitlab that contains the results of
each match of the <a class="reference external" href="https://gitlab.com/djh_or/2018-world-cup-stats/blob/master/world_cup_2018_stats.csv">2018 World
Cup</a>.
This allows us to easily construct a test set.</p>
<p>We also wrote two scrapers for Wikipedia.</p>
<ul class="simple">
<li>One scraper scrapes the <a class="reference external" href="https://en.wikipedia.org/wiki/2018_FIFA_World_Cup_squads">World Cup
teams</a>
for each country
(<a class="reference external" href="https://en.wikipedia.org/wiki/XXXX_FIFA_World_Cup_squads">https://en.wikipedia.org/wiki/XXXX_FIFA_World_Cup_squads</a>, where XXXX
is the year).</li>
<li>The other scraper scrapes information about countries like <a class="reference external" href="https://en.wikipedia.org/wiki/List_of_countries_by_GDP_(PPP)">GDP
PPP</a>,
<a class="reference external" href="https://en.wikipedia.org/wiki/List_of_countries_by_population_(United_Nations)">population</a>,
and <a class="reference external" href="https://en.wikipedia.org/wiki/List_of_countries_by_average_yearly_temperature">average yearly
temperature</a>.</li>
</ul>
</div>
<div class="section" id="Data-Cleaning">
<h2>Data Cleaning<a class="headerlink" href="#Data-Cleaning" title="Permalink to this headline">¶</a></h2>
<div class="section" id="European-Soccer-Database">
<h3>European Soccer Database<a class="headerlink" href="#European-Soccer-Database" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="../european_league/clean_european_league.html"><span class="doc">Link</span></a></p>
</div>
<div class="section" id="Sofifa">
<h3>Sofifa<a class="headerlink" href="#Sofifa" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="../sofifa/sofifa-cleaning.html"><span class="doc">Link</span></a></p>
</div>
</div>
<div class="section" id="Feature-Engineering">
<h2>Feature Engineering<a class="headerlink" href="#Feature-Engineering" title="Permalink to this headline">¶</a></h2>
<p>Because in the case of the World Cup, home team does not actually mean
anything (besides for Russia itself), we needed each feature in our
models to be agnostic to which team is home and which team is away so
that so that switching home team and away team does not result in
different predictions despite everything else being the same. The most
simple way to do so that also makes sense is to take the difference of
home team features with away team features, as we can think of these as
being difference in skills/abilities of the teams.</p>
</div>
<div class="section" id="Exploratory-Data-Analysis">
<h2>Exploratory Data Analysis<a class="headerlink" href="#Exploratory-Data-Analysis" title="Permalink to this headline">¶</a></h2>
<div class="section" id="European-Soccer-Database">
<h3>European Soccer Database<a class="headerlink" href="#European-Soccer-Database" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="../european_league/explore_european_league.html"><span class="doc">Link</span></a></p>
<p>Summary:</p>
<p>In this dataset, we focused primarily on seeing if individual player
statistics were important predictors of the outcome of a match. We
aggregated for each team different player statistics and differenced the
aggregates. From looking at the plots the distributions of a difference
in rating among the three outcome do not really seem that different.
This might be an indication that using individual ratings and
aggregating them might not be the way to go.</p>
<p><img alt="image0" src="../_images/danilo.png" /></p>
<p>On the other hand, it seems that previous match results will be good
predictors. This time it is a bit more obvious that home team winning
tends to have higher values. It seems like we can probably calculate
some kind of momentum and utilize it as a predictor. We will explore
more of this concept later on when we try to make more advanced models.</p>
<p><img alt="image1" src="../_images/previous_wins.png" /></p>
<p>We kept these discoveries in mind as we move on to the Sofifa datasets.</p>
</div>
<div class="section" id="Sofifa">
<h3>Sofifa<a class="headerlink" href="#Sofifa" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="Baseline-Models">
<h2>Baseline Models<a class="headerlink" href="#Baseline-Models" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../models/baseline_model.html"><span class="doc">Link</span></a></p>
<p>Summary:</p>
<p>We have two different simple baseline models, one where we just guess
the majority outcome every time (home team wins). By just guessing the
majority outcome every time, we could achieve a 42.1875% accuracy in
predicting the World Cup results.</p>
<p>The other baseline model utilizes the FIFA rankings as well as some
basic team features, including difference in attack ratings, difference
in defense ratings, and difference in midfield ratings. Through
classification methods such as logistic regression, LDA, QDA, and Random
Forest, we were able to achieve around 60% accuracy in predicting the
World Cup results. We hope to at least match this accuracy in our more
advanced model that does not utilize the FIFA rankings.</p>
<p>Note that because in the World Cup starting from the Round of 16 there
can no longer be ties, we decided for these matches if the model
predicts a tie (i.e.&nbsp;tie is the highest probability), we take the result
with the second highest probability as our prediction. This function can
be found inside the <code class="docutils literal notranslate"><span class="pre">models</span></code> folder with the name
<a class="reference external" href="../models/predict_test_data.py">predict_test_data.py</a>.</p>
</div>
<div class="section" id="Problems-Encountered-and-Attempts-to-Solve-the-Problems">
<h2>Problems Encountered and Attempts to Solve the Problems<a class="headerlink" href="#Problems-Encountered-and-Attempts-to-Solve-the-Problems" title="Permalink to this headline">¶</a></h2>
<p>One of the largest issues we encountered after we collected all the data
was that we realized that we will not be able to merge all the rows.
There are two different underlying problems:</p>
<div class="section" id="1.-Different-Naming-Conventions-for-Countries,-Players,-and-Teams">
<h3>1. Different Naming Conventions for Countries, Players, and Teams<a class="headerlink" href="#1.-Different-Naming-Conventions-for-Countries,-Players,-and-Teams" title="Permalink to this headline">¶</a></h3>
<p>Each dataset we collected had a different naming convention for the
countries. In most cases, this was due to slight variation in spelling
(i.e.&nbsp;St Lucia vs Saint Lucia). With all these different variations, we
needed to map all the variations to just one name so that we could merge
our datasets. We decided to use the official FIFA names of the countries
found using the FIFA rankings dataset as the mapped names. Then, in
order to tackle this problem, we decided to install the package
<a class="reference external" href="https://github.com/seatgeek/fuzzywuzzy">fuzzywuzzy</a>, which
essentially calculates a similarity score using Levenshtein Distance
between two strings. We wrote the method <code class="docutils literal notranslate"><span class="pre">map_country()</span></code> that
essentially calculates the Levenshtein Distance for a country_name
string if the country_name string does not exactly match with the FIFA
names and map the string to the FIFA name with the highest similarity
score (in percentage). We only do this mapping if the highest similarity
score is above a 80%, when we are very confident that this is the right
mapping. From manual inspection, this turned out extremely well and we
believe that there should be no wrong mapping.</p>
<p>However, in some cases, we still needed to do some manual mapping for
ones in which the Levenshtein Distance is not confident about the
mapping, such as in the case of the two Koreas, but the
<code class="docutils literal notranslate"><span class="pre">map_country()</span></code> function has saved us from doing many manual mappings.</p>
</div>
<div class="section" id="2.-Non-FIFA-Affiliated-Teams">
<h3>2. Non-FIFA Affiliated Teams<a class="headerlink" href="#2.-Non-FIFA-Affiliated-Teams" title="Permalink to this headline">¶</a></h3>
<p>There were teams that were not national teams at all (i.e.&nbsp;United
Koreans in Japan, which is a team for the Korean population in Japan).</p>
<p>However, as mentioned before, in the end, we only care about the
national teams that are affiliated with FIFA. As such, we only keep the
rows where both teams appeared on the FIFA rankings starting from 2010
(All affiliated teams are ranked, and we only look after 2010 because
some countries that were on older rankings no longer exist or changed
names such as Zaire, which became Congo DR). Our method
<code class="docutils literal notranslate"><span class="pre">map_country()</span></code> in <code class="docutils literal notranslate"><span class="pre">map_countries.py</span></code> easily takes care of this
since in general there is no similarity score that is above 80% (except
for a few edge cases such as Northern Cyprus, which is a different team
than Cyprus and is not allowed to compete in FIFA). These we manually
took care of.</p>
</div>
<div class="section" id="Aftermath-for-1.-and-2.">
<h3>Aftermath for 1. and 2.<a class="headerlink" href="#Aftermath-for-1.-and-2." title="Permalink to this headline">¶</a></h3>
<p>In the end, however, we decided to scrap all of this effort since our
main goal is to be able to predict the winner of each match in the World
Cup, we decided to focus on the teams that have appeared in the World
Cup before. By doing so, we basically rendered all the above effort
pointless, but one can still see our code for all of this in the repo.</p>
</div>
<div class="section" id="3.-Correctly-Matching-the-Players-of-a-Team">
<h3>3. Correctly Matching the Players of a Team<a class="headerlink" href="#3.-Correctly-Matching-the-Players-of-a-Team" title="Permalink to this headline">¶</a></h3>
<p>While different naming conventions for countries did not prove much of a
problem, different datasets having different naming conventions for the
players themselves proved to be a major problem. Our attempts with fuzzy
matching did not turn out turn out that successful in this case. This is
exacerbated by the fact that there were actually a lot more players with
the same name than we expected there to be (especially in the case of
Brazil).</p>
<p><img alt="image0" src="../_images/danilo.png" /></p>
<p>While theoretically one could match the right player in the players with
the same names with the club they played for, the clubs themselves also
had different naming conventions, so correctly matching players would
result in a TON of manual work.</p>
<p>This is one of the main reasons we decided to try out the European
Soccer Database to see if individual player ratings could be of use
before we attempted anything further with player data since in that
dataset we could identify each player by a unique id, and from the EDA,
we saw that individual data did not really help at all. As such, we
decided to forgo on using indiviual player data.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2018, Brian Lin, Shane Ong, Pat Sukhum, Matteo Zhang.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>