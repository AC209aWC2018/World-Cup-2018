{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Scrape World Cup Squads"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [],
   "source": [
    "import numpy as np\n",
    "import pandas as pd\n",
    "import requests\n",
    "import time\n",
    "from bs4 import BeautifulSoup\n",
    "from map_countries import map_country\n",
    "%matplotlib inline "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": [
    "def scrape_wikpedia_wc_players(year):\n",
    "    url = \"https://en.wikipedia.org/wiki/{}_FIFA_World_Cup_squads\".format(year)\n",
    "    time.sleep(5)\n",
    "    my_page = requests.get(url)\n",
    "    if my_page.status_code == 200:\n",
    "        soup = BeautifulSoup(my_page.content, \"lxml\")\n",
    "        tables = soup.find_all('table',{'class':'sortable wikitable plainrowheaders'})\n",
    "        countries = soup.find_all('li', {'class': 'toclevel-2'})[:32]\n",
    "        players_df = pd.DataFrame(columns = ['Player', 'Country', 'Pos', 'Birthday', 'Age', 'Caps', 'Club', 'Club Country'])\n",
    "        for i, table in enumerate(tables):\n",
    "            #first result would be column names\n",
    "            country = countries[i].find('span', {'class': 'toctext'}).text\n",
    "            players = table.find_all('tr')[1:]\n",
    "            for player in players:\n",
    "                name = player.find('th').find('a').text\n",
    "                td_tags = player.find_all('td')\n",
    "                position = td_tags[1].find('a').text\n",
    "                birthday = td_tags[2].text[2:12]\n",
    "                age = td_tags[2].text[-4:-2]\n",
    "                caps = td_tags[3].text.replace('\\n', \"\")\n",
    "                #Only 2018 has goals, so do not keep it.\n",
    "#                 goals = td_tags[4].text.replace('\\n', \"\")\n",
    "                #Last element is club. Some are free agents. \n",
    "                try: \n",
    "                    club = td_tags[-1].find_all('a')[1].text\n",
    "                    club_country = td_tags[-1].find('a')['title']\n",
    "                except IndexError:\n",
    "                    club = None\n",
    "                    club_country = None\n",
    "                row = pd.DataFrame([[name, country, position, birthday, age, caps, club, club_country]],\\\n",
    "                                   columns = ['Player', 'Country', 'Pos', 'Birthday', 'Age', 'Caps', 'Club', 'Club Country'])\n",
    "                players_df = players_df.append(row)\n",
    "        players_df = players_df.reset_index(drop = True)\n",
    "        players_df['year'] = year\n",
    "        return players_df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [],
   "source": [
    "years = [2010, 2014, 2018]\n",
    "for year in years:\n",
    "    wc_players = scrape_wikpedia_wc_players(year)\n",
    "    wc_players['Country'] = wc_players['Country'].copy().apply(map_country)\n",
    "    wc_players['Club Country'] = wc_players['Club Country'].copy().apply(map_country)\n",
    "    wc_players.to_csv(\"data/cleaned/wc_players_{}.csv\".format(year), index = False)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Map Test Data to Sofifa Dataset"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [],
   "source": [
    "wc_players_2018 = pd.read_csv(\"data/cleaned/wc_players_2018.csv\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 106,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Player</th>\n",
       "      <th>Country</th>\n",
       "      <th>Pos</th>\n",
       "      <th>Birthday</th>\n",
       "      <th>Age</th>\n",
       "      <th>Caps</th>\n",
       "      <th>Club</th>\n",
       "      <th>Club Country</th>\n",
       "      <th>year</th>\n",
       "      <th>name_converted</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Essam El-Hadary</td>\n",
       "      <td>egypt</td>\n",
       "      <td>GK</td>\n",
       "      <td>1973-01-15</td>\n",
       "      <td>45</td>\n",
       "      <td>158</td>\n",
       "      <td>Al-Taawoun</td>\n",
       "      <td>saudi arabia</td>\n",
       "      <td>2018</td>\n",
       "      <td>EElHadary</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>Ali Gabr</td>\n",
       "      <td>egypt</td>\n",
       "      <td>DF</td>\n",
       "      <td>1989-01-01</td>\n",
       "      <td>29</td>\n",
       "      <td>21</td>\n",
       "      <td>West Bromwich Albion</td>\n",
       "      <td>england</td>\n",
       "      <td>2018</td>\n",
       "      <td>AGabr</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Ahmed Elmohamady</td>\n",
       "      <td>egypt</td>\n",
       "      <td>DF</td>\n",
       "      <td>1987-09-09</td>\n",
       "      <td>30</td>\n",
       "      <td>78</td>\n",
       "      <td>Aston Villa</td>\n",
       "      <td>england</td>\n",
       "      <td>2018</td>\n",
       "      <td>AElmohamady</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>Omar Gaber</td>\n",
       "      <td>egypt</td>\n",
       "      <td>MF</td>\n",
       "      <td>1992-01-30</td>\n",
       "      <td>26</td>\n",
       "      <td>24</td>\n",
       "      <td>Los Angeles FC</td>\n",
       "      <td>usa</td>\n",
       "      <td>2018</td>\n",
       "      <td>OGaber</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>Sam Morsy</td>\n",
       "      <td>egypt</td>\n",
       "      <td>MF</td>\n",
       "      <td>1991-09-10</td>\n",
       "      <td>26</td>\n",
       "      <td>5</td>\n",
       "      <td>Wigan Athletic</td>\n",
       "      <td>england</td>\n",
       "      <td>2018</td>\n",
       "      <td>SMorsy</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "             Player Country Pos    Birthday  Age  Caps                  Club  \\\n",
       "0   Essam El-Hadary   egypt  GK  1973-01-15   45   158            Al-Taawoun   \n",
       "1          Ali Gabr   egypt  DF  1989-01-01   29    21  West Bromwich Albion   \n",
       "2  Ahmed Elmohamady   egypt  DF  1987-09-09   30    78           Aston Villa   \n",
       "3        Omar Gaber   egypt  MF  1992-01-30   26    24        Los Angeles FC   \n",
       "4         Sam Morsy   egypt  MF  1991-09-10   26     5        Wigan Athletic   \n",
       "\n",
       "   Club Country  year name_converted  \n",
       "0  saudi arabia  2018      EElHadary  \n",
       "1       england  2018          AGabr  \n",
       "2       england  2018    AElmohamady  \n",
       "3           usa  2018         OGaber  \n",
       "4       england  2018         SMorsy  "
      ]
     },
     "execution_count": 106,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "wc_players_2018.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 94,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/Users/blin/anaconda3/lib/python3.6/site-packages/IPython/core/interactiveshell.py:3020: DtypeWarning: Columns (23,35) have mixed types. Specify dtype option on import or set low_memory=False.\n",
      "  interactivity=interactivity, compiler=compiler, result=result)\n"
     ]
    }
   ],
   "source": [
    "sofifa_df = pd.read_csv('data/sofifa/CompleteDataset.csv').drop(['Unnamed: 0'], axis = 1)\n",
    "sofifa_df['Nationality'] = sofifa_df['Nationality'].copy().apply(map_country)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 107,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Name</th>\n",
       "      <th>Age</th>\n",
       "      <th>Photo</th>\n",
       "      <th>Nationality</th>\n",
       "      <th>Flag</th>\n",
       "      <th>Overall</th>\n",
       "      <th>Potential</th>\n",
       "      <th>Club</th>\n",
       "      <th>Club Logo</th>\n",
       "      <th>Value</th>\n",
       "      <th>...</th>\n",
       "      <th>RCB</th>\n",
       "      <th>RCM</th>\n",
       "      <th>RDM</th>\n",
       "      <th>RF</th>\n",
       "      <th>RM</th>\n",
       "      <th>RS</th>\n",
       "      <th>RW</th>\n",
       "      <th>RWB</th>\n",
       "      <th>ST</th>\n",
       "      <th>name_converted</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Cristiano Ronaldo</td>\n",
       "      <td>32</td>\n",
       "      <td>https://cdn.sofifa.org/48/18/players/20801.png</td>\n",
       "      <td>portugal</td>\n",
       "      <td>https://cdn.sofifa.org/flags/38.png</td>\n",
       "      <td>94</td>\n",
       "      <td>94</td>\n",
       "      <td>Real Madrid CF</td>\n",
       "      <td>https://cdn.sofifa.org/24/18/teams/243.png</td>\n",
       "      <td>€95.5M</td>\n",
       "      <td>...</td>\n",
       "      <td>53.0</td>\n",
       "      <td>82.0</td>\n",
       "      <td>62.0</td>\n",
       "      <td>91.0</td>\n",
       "      <td>89.0</td>\n",
       "      <td>92.0</td>\n",
       "      <td>91.0</td>\n",
       "      <td>66.0</td>\n",
       "      <td>92.0</td>\n",
       "      <td>CRonaldo</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>L. Messi</td>\n",
       "      <td>30</td>\n",
       "      <td>https://cdn.sofifa.org/48/18/players/158023.png</td>\n",
       "      <td>argentina</td>\n",
       "      <td>https://cdn.sofifa.org/flags/52.png</td>\n",
       "      <td>93</td>\n",
       "      <td>93</td>\n",
       "      <td>FC Barcelona</td>\n",
       "      <td>https://cdn.sofifa.org/24/18/teams/241.png</td>\n",
       "      <td>€105M</td>\n",
       "      <td>...</td>\n",
       "      <td>45.0</td>\n",
       "      <td>84.0</td>\n",
       "      <td>59.0</td>\n",
       "      <td>92.0</td>\n",
       "      <td>90.0</td>\n",
       "      <td>88.0</td>\n",
       "      <td>91.0</td>\n",
       "      <td>62.0</td>\n",
       "      <td>88.0</td>\n",
       "      <td>LMessi</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Neymar</td>\n",
       "      <td>25</td>\n",
       "      <td>https://cdn.sofifa.org/48/18/players/190871.png</td>\n",
       "      <td>brazil</td>\n",
       "      <td>https://cdn.sofifa.org/flags/54.png</td>\n",
       "      <td>92</td>\n",
       "      <td>94</td>\n",
       "      <td>Paris Saint-Germain</td>\n",
       "      <td>https://cdn.sofifa.org/24/18/teams/73.png</td>\n",
       "      <td>€123M</td>\n",
       "      <td>...</td>\n",
       "      <td>46.0</td>\n",
       "      <td>79.0</td>\n",
       "      <td>59.0</td>\n",
       "      <td>88.0</td>\n",
       "      <td>87.0</td>\n",
       "      <td>84.0</td>\n",
       "      <td>89.0</td>\n",
       "      <td>64.0</td>\n",
       "      <td>84.0</td>\n",
       "      <td>Neymar</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>L. Suárez</td>\n",
       "      <td>30</td>\n",
       "      <td>https://cdn.sofifa.org/48/18/players/176580.png</td>\n",
       "      <td>uruguay</td>\n",
       "      <td>https://cdn.sofifa.org/flags/60.png</td>\n",
       "      <td>92</td>\n",
       "      <td>92</td>\n",
       "      <td>FC Barcelona</td>\n",
       "      <td>https://cdn.sofifa.org/24/18/teams/241.png</td>\n",
       "      <td>€97M</td>\n",
       "      <td>...</td>\n",
       "      <td>58.0</td>\n",
       "      <td>80.0</td>\n",
       "      <td>65.0</td>\n",
       "      <td>88.0</td>\n",
       "      <td>85.0</td>\n",
       "      <td>88.0</td>\n",
       "      <td>87.0</td>\n",
       "      <td>68.0</td>\n",
       "      <td>88.0</td>\n",
       "      <td>LSuárez</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>M. Neuer</td>\n",
       "      <td>31</td>\n",
       "      <td>https://cdn.sofifa.org/48/18/players/167495.png</td>\n",
       "      <td>germany</td>\n",
       "      <td>https://cdn.sofifa.org/flags/21.png</td>\n",
       "      <td>92</td>\n",
       "      <td>92</td>\n",
       "      <td>FC Bayern Munich</td>\n",
       "      <td>https://cdn.sofifa.org/24/18/teams/21.png</td>\n",
       "      <td>€61M</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>MNeuer</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 75 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                Name  Age                                            Photo  \\\n",
       "0  Cristiano Ronaldo   32   https://cdn.sofifa.org/48/18/players/20801.png   \n",
       "1           L. Messi   30  https://cdn.sofifa.org/48/18/players/158023.png   \n",
       "2             Neymar   25  https://cdn.sofifa.org/48/18/players/190871.png   \n",
       "3          L. Suárez   30  https://cdn.sofifa.org/48/18/players/176580.png   \n",
       "4           M. Neuer   31  https://cdn.sofifa.org/48/18/players/167495.png   \n",
       "\n",
       "  Nationality                                 Flag  Overall  Potential  \\\n",
       "0    portugal  https://cdn.sofifa.org/flags/38.png       94         94   \n",
       "1   argentina  https://cdn.sofifa.org/flags/52.png       93         93   \n",
       "2      brazil  https://cdn.sofifa.org/flags/54.png       92         94   \n",
       "3     uruguay  https://cdn.sofifa.org/flags/60.png       92         92   \n",
       "4     germany  https://cdn.sofifa.org/flags/21.png       92         92   \n",
       "\n",
       "                  Club                                   Club Logo   Value  \\\n",
       "0       Real Madrid CF  https://cdn.sofifa.org/24/18/teams/243.png  €95.5M   \n",
       "1         FC Barcelona  https://cdn.sofifa.org/24/18/teams/241.png   €105M   \n",
       "2  Paris Saint-Germain   https://cdn.sofifa.org/24/18/teams/73.png   €123M   \n",
       "3         FC Barcelona  https://cdn.sofifa.org/24/18/teams/241.png    €97M   \n",
       "4     FC Bayern Munich   https://cdn.sofifa.org/24/18/teams/21.png    €61M   \n",
       "\n",
       "       ...         RCB   RCM   RDM    RF    RM    RS    RW   RWB    ST  \\\n",
       "0      ...        53.0  82.0  62.0  91.0  89.0  92.0  91.0  66.0  92.0   \n",
       "1      ...        45.0  84.0  59.0  92.0  90.0  88.0  91.0  62.0  88.0   \n",
       "2      ...        46.0  79.0  59.0  88.0  87.0  84.0  89.0  64.0  84.0   \n",
       "3      ...        58.0  80.0  65.0  88.0  85.0  88.0  87.0  68.0  88.0   \n",
       "4      ...         NaN   NaN   NaN   NaN   NaN   NaN   NaN   NaN   NaN   \n",
       "\n",
       "  name_converted  \n",
       "0       CRonaldo  \n",
       "1         LMessi  \n",
       "2         Neymar  \n",
       "3        LSuárez  \n",
       "4         MNeuer  \n",
       "\n",
       "[5 rows x 75 columns]"
      ]
     },
     "execution_count": 107,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sofifa_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 114,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array(['14', '15', '33', '91', '8', '86', '7', '5', '10', '12', '11', '4',\n",
       "       '90', '87', '13', '9', '2', '6', '82', '1', '16', '83', '80', '85',\n",
       "       '81', '78', '79', '3', '84', '77', '76', '74', '32', '75', '70',\n",
       "       '17', '19', '73', '72', '69', '71', '65', '18', '71-2', '69+1',\n",
       "       '20', '66', '68', '67', '24', '21', '64', '66-2', '69+2', '63',\n",
       "       '60', '62', '55', '64+1', '61', '57', '59', '65+4', '23', '60+3',\n",
       "       '66-1', '65+1', '58', '30', '63-1', '70+2', '62-1', '56', '51',\n",
       "       '53', '64+2', '62+4', '49', '54', '61-1', '27', '47', '52', '60+1',\n",
       "       '58+2', '50', '58+4', '48', '59+2', '46', '45', '44', '51+3',\n",
       "       '45-1', '42', '40', '43', '41', '38'], dtype=object)"
      ]
     },
     "execution_count": 114,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sofifa_df.iloc[:, 26].unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 97,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Name</th>\n",
       "      <th>Age</th>\n",
       "      <th>Photo</th>\n",
       "      <th>Nationality</th>\n",
       "      <th>Flag</th>\n",
       "      <th>Overall</th>\n",
       "      <th>Potential</th>\n",
       "      <th>Club</th>\n",
       "      <th>Club Logo</th>\n",
       "      <th>Value</th>\n",
       "      <th>...</th>\n",
       "      <th>RB</th>\n",
       "      <th>RCB</th>\n",
       "      <th>RCM</th>\n",
       "      <th>RDM</th>\n",
       "      <th>RF</th>\n",
       "      <th>RM</th>\n",
       "      <th>RS</th>\n",
       "      <th>RW</th>\n",
       "      <th>RWB</th>\n",
       "      <th>ST</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>5314</th>\n",
       "      <td>E. El Hadary</td>\n",
       "      <td>44</td>\n",
       "      <td>https://cdn.sofifa.org/48/18/players/188033.png</td>\n",
       "      <td>egypt</td>\n",
       "      <td>https://cdn.sofifa.org/flags/111.png</td>\n",
       "      <td>70</td>\n",
       "      <td>70</td>\n",
       "      <td>Al Taawoun</td>\n",
       "      <td>https://cdn.sofifa.org/24/18/teams/112393.png</td>\n",
       "      <td>€120K</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>1 rows × 74 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "              Name  Age                                            Photo  \\\n",
       "5314  E. El Hadary   44  https://cdn.sofifa.org/48/18/players/188033.png   \n",
       "\n",
       "     Nationality                                  Flag  Overall  Potential  \\\n",
       "5314       egypt  https://cdn.sofifa.org/flags/111.png       70         70   \n",
       "\n",
       "            Club                                      Club Logo  Value ...  \\\n",
       "5314  Al Taawoun  https://cdn.sofifa.org/24/18/teams/112393.png  €120K ...   \n",
       "\n",
       "      RB  RCB RCM RDM  RF  RM  RS  RW RWB  ST  \n",
       "5314 NaN  NaN NaN NaN NaN NaN NaN NaN NaN NaN  \n",
       "\n",
       "[1 rows x 74 columns]"
      ]
     },
     "execution_count": 97,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sofifa_df[sofifa_df.Name.str.contains('Hadary')]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 98,
   "metadata": {},
   "outputs": [],
   "source": [
    "def to_common_name(name):\n",
    "    #Sofifa dataset does not include \"-\" in people's last name and instead has a space\n",
    "    # (i.e. Essam El-Hadary), so sub it with space\n",
    "    common_name = name.replace(\"-\", \"\")\n",
    "    common_name = common_name.split(\" \")\n",
    "    \n",
    "    if len(common_name) > 1:\n",
    "        #First initial of first name + + last name\n",
    "        common_name = common_name[0][0] + ''.join(common_name[1:])\n",
    "        return common_name\n",
    "        \n",
    "    #case where there is only last name / nickname. Then just return original wc squad name since it seems\n",
    "    #the sofifa name and original wc squad name correspond in this case.\n",
    "    else:\n",
    "        return name"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 99,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'EElHadary'"
      ]
     },
     "execution_count": 99,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "to_sofifa_name('Essam El-Hadary')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 100,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'EElHadary'"
      ]
     },
     "execution_count": 100,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "to_sofifa_name('E. El Hadary')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 101,
   "metadata": {},
   "outputs": [],
   "source": [
    "wc_names_converted = wc_players_2018['Player'].apply(to_sofifa_name)\n",
    "wc_players_2018['name_converted'] = wc_names_converted"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 102,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Sofifa also inconsistent with its own convention sometimes (i.e. Cristiano Ronaldo instead of C. Ronaldo)\n",
    "#So just run the algorithm on sofifa as well. \n",
    "sofifa_names_converted = sofifa_df['Name'].apply(to_sofifa_name)\n",
    "sofifa_df['name_converted'] = sofifa_names_converted"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 130,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Player</th>\n",
       "      <th>Country</th>\n",
       "      <th>Pos</th>\n",
       "      <th>Birthday</th>\n",
       "      <th>Age_x</th>\n",
       "      <th>Caps</th>\n",
       "      <th>Club_x</th>\n",
       "      <th>Club Country</th>\n",
       "      <th>year</th>\n",
       "      <th>name_converted</th>\n",
       "      <th>...</th>\n",
       "      <th>RB</th>\n",
       "      <th>RCB</th>\n",
       "      <th>RCM</th>\n",
       "      <th>RDM</th>\n",
       "      <th>RF</th>\n",
       "      <th>RM</th>\n",
       "      <th>RS</th>\n",
       "      <th>RW</th>\n",
       "      <th>RWB</th>\n",
       "      <th>ST</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Essam El-Hadary</td>\n",
       "      <td>egypt</td>\n",
       "      <td>GK</td>\n",
       "      <td>1973-01-15</td>\n",
       "      <td>45</td>\n",
       "      <td>158</td>\n",
       "      <td>Al-Taawoun</td>\n",
       "      <td>saudi arabia</td>\n",
       "      <td>2018</td>\n",
       "      <td>EElHadary</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>Ali Gabr</td>\n",
       "      <td>egypt</td>\n",
       "      <td>DF</td>\n",
       "      <td>1989-01-01</td>\n",
       "      <td>29</td>\n",
       "      <td>21</td>\n",
       "      <td>West Bromwich Albion</td>\n",
       "      <td>england</td>\n",
       "      <td>2018</td>\n",
       "      <td>AGabr</td>\n",
       "      <td>...</td>\n",
       "      <td>61.0</td>\n",
       "      <td>66.0</td>\n",
       "      <td>50.0</td>\n",
       "      <td>61.0</td>\n",
       "      <td>42.0</td>\n",
       "      <td>46.0</td>\n",
       "      <td>45.0</td>\n",
       "      <td>43.0</td>\n",
       "      <td>58.0</td>\n",
       "      <td>45.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Ahmed Elmohamady</td>\n",
       "      <td>egypt</td>\n",
       "      <td>DF</td>\n",
       "      <td>1987-09-09</td>\n",
       "      <td>30</td>\n",
       "      <td>78</td>\n",
       "      <td>Aston Villa</td>\n",
       "      <td>england</td>\n",
       "      <td>2018</td>\n",
       "      <td>AElmohamady</td>\n",
       "      <td>...</td>\n",
       "      <td>71.0</td>\n",
       "      <td>68.0</td>\n",
       "      <td>72.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>71.0</td>\n",
       "      <td>73.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>72.0</td>\n",
       "      <td>72.0</td>\n",
       "      <td>70.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>Omar Gaber</td>\n",
       "      <td>egypt</td>\n",
       "      <td>MF</td>\n",
       "      <td>1992-01-30</td>\n",
       "      <td>26</td>\n",
       "      <td>24</td>\n",
       "      <td>Los Angeles FC</td>\n",
       "      <td>usa</td>\n",
       "      <td>2018</td>\n",
       "      <td>OGaber</td>\n",
       "      <td>...</td>\n",
       "      <td>68.0</td>\n",
       "      <td>67.0</td>\n",
       "      <td>65.0</td>\n",
       "      <td>68.0</td>\n",
       "      <td>62.0</td>\n",
       "      <td>65.0</td>\n",
       "      <td>62.0</td>\n",
       "      <td>63.0</td>\n",
       "      <td>68.0</td>\n",
       "      <td>62.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>Sam Morsy</td>\n",
       "      <td>egypt</td>\n",
       "      <td>MF</td>\n",
       "      <td>1991-09-10</td>\n",
       "      <td>26</td>\n",
       "      <td>5</td>\n",
       "      <td>Wigan Athletic</td>\n",
       "      <td>england</td>\n",
       "      <td>2018</td>\n",
       "      <td>SMorsy</td>\n",
       "      <td>...</td>\n",
       "      <td>63.0</td>\n",
       "      <td>65.0</td>\n",
       "      <td>67.0</td>\n",
       "      <td>67.0</td>\n",
       "      <td>64.0</td>\n",
       "      <td>65.0</td>\n",
       "      <td>61.0</td>\n",
       "      <td>64.0</td>\n",
       "      <td>64.0</td>\n",
       "      <td>61.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 84 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "             Player Country Pos    Birthday  Age_x  Caps  \\\n",
       "0   Essam El-Hadary   egypt  GK  1973-01-15     45   158   \n",
       "1          Ali Gabr   egypt  DF  1989-01-01     29    21   \n",
       "2  Ahmed Elmohamady   egypt  DF  1987-09-09     30    78   \n",
       "3        Omar Gaber   egypt  MF  1992-01-30     26    24   \n",
       "4         Sam Morsy   egypt  MF  1991-09-10     26     5   \n",
       "\n",
       "                 Club_x  Club Country  year name_converted  ...     RB   RCB  \\\n",
       "0            Al-Taawoun  saudi arabia  2018      EElHadary  ...    NaN   NaN   \n",
       "1  West Bromwich Albion       england  2018          AGabr  ...   61.0  66.0   \n",
       "2           Aston Villa       england  2018    AElmohamady  ...   71.0  68.0   \n",
       "3        Los Angeles FC           usa  2018         OGaber  ...   68.0  67.0   \n",
       "4        Wigan Athletic       england  2018         SMorsy  ...   63.0  65.0   \n",
       "\n",
       "    RCM   RDM    RF    RM    RS    RW   RWB    ST  \n",
       "0   NaN   NaN   NaN   NaN   NaN   NaN   NaN   NaN  \n",
       "1  50.0  61.0  42.0  46.0  45.0  43.0  58.0  45.0  \n",
       "2  72.0  70.0  71.0  73.0  70.0  72.0  72.0  70.0  \n",
       "3  65.0  68.0  62.0  65.0  62.0  63.0  68.0  62.0  \n",
       "4  67.0  67.0  64.0  65.0  61.0  64.0  64.0  61.0  \n",
       "\n",
       "[5 rows x 84 columns]"
      ]
     },
     "execution_count": 130,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "wc_players_sofifa_merged = wc_players_2018.merge(sofifa_df, how = 'left', left_on = ['name_converted', 'Country',],\n",
    "                        right_on = ['name_converted', 'Nationality'])\n",
    "wc_players_sofifa_merged.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 131,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(736, 10)"
      ]
     },
     "execution_count": 131,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "wc_players_2018.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 132,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(788, 84)"
      ]
     },
     "execution_count": 132,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "wc_players_sofifa_merged.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 139,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "Danilo                  5\n",
       "Paulinho                4\n",
       "Danny Rose              3\n",
       "Marcelo                 3\n",
       "Sebastian Larsson       3\n",
       "Rodrigo                 3\n",
       "Thomas Müller           3\n",
       "Dejan Lovren            2\n",
       "Saúl                    2\n",
       "John Guidetti           2\n",
       "Mansoor Al-Harbi        2\n",
       "Anton Miranchuk         2\n",
       "Juan Cuadrado           2\n",
       "James Rodríguez         2\n",
       "Jesse Lingard           2\n",
       "Osama Hawsawi           2\n",
       "Douglas Costa           2\n",
       "Cristian Rodríguez      2\n",
       "Timo Werner             2\n",
       "Nicolai Jørgensen       2\n",
       "Alfred Gomis            2\n",
       "Milan Badelj            2\n",
       "Ismaïla Sarr            2\n",
       "Camilo Vargas           2\n",
       "Phil Jones              2\n",
       "Denis Cheryshev         2\n",
       "Adrien Silva            2\n",
       "Adama Mbengue           2\n",
       "Lee Yong                2\n",
       "Kosuke Nakamura         2\n",
       "                       ..\n",
       "Mohammed Al-Breik       1\n",
       "Stephan Lichtsteiner    1\n",
       "Ashley Young            1\n",
       "Sebastian Rudy          1\n",
       "Ruben Loftus-Cheek      1\n",
       "Alberto Rodríguez       1\n",
       "Naomichi Ueda           1\n",
       "Edison Flores           1\n",
       "Nico Elvedi             1\n",
       "Frederik Rønnow         1\n",
       "Alisson                 1\n",
       "Syam Ben Youssef        1\n",
       "William Troost-Ekong    1\n",
       "Ramadan Sobhi           1\n",
       "Jo Hyeon-woo            1\n",
       "Paul Pogba              1\n",
       "Majid Hosseini          1\n",
       "Nilson Loyola           1\n",
       "Érick Gutiérrez         1\n",
       "Nick Pope               1\n",
       "Mark Milligan           1\n",
       "Lamine Gassama          1\n",
       "Filipe Luís             1\n",
       "Nahitan Nández          1\n",
       "Grzegorz Krychowiak     1\n",
       "Adolfo Machado          1\n",
       "Adnan Januzaj           1\n",
       "Amr Warda               1\n",
       "Kim Seung-gyu           1\n",
       "Christian Bolaños       1\n",
       "Name: Player, Length: 735, dtype: int64"
      ]
     },
     "execution_count": 139,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "wc_players_sofifa_merged.Player.value_counts()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 142,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Club_x</th>\n",
       "      <th>Club_y</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>81</th>\n",
       "      <td>Juventus</td>\n",
       "      <td>Juventus</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>183</th>\n",
       "      <td>Valencia</td>\n",
       "      <td>Valencia CF</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>184</th>\n",
       "      <td>Valencia</td>\n",
       "      <td>Valencia CF</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>185</th>\n",
       "      <td>Valencia</td>\n",
       "      <td>Villarreal CF</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "       Club_x         Club_y\n",
       "81   Juventus       Juventus\n",
       "183  Valencia    Valencia CF\n",
       "184  Valencia    Valencia CF\n",
       "185  Valencia  Villarreal CF"
      ]
     },
     "execution_count": 142,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "wc_players_sofifa_merged[wc_players_sofifa_merged.Player.str.contains('Rodrigo')][['Club_x', 'Club_y']]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
