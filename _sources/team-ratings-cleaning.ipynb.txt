{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "import numpy as np\n",
    "import pandas as pd\n",
    "import matplotlib.pyplot as plt\n",
    "import time\n",
    "import seaborn as sns\n",
    "import re\n",
    "%matplotlib inline"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>home_team</th>\n",
       "      <th>away_team</th>\n",
       "      <th>home_score</th>\n",
       "      <th>away_score</th>\n",
       "      <th>tournament</th>\n",
       "      <th>city</th>\n",
       "      <th>country</th>\n",
       "      <th>neutral</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>31700</th>\n",
       "      <td>2010-01-02 00:00:00+00:00</td>\n",
       "      <td>Iran</td>\n",
       "      <td>Korea DPR</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>Friendly</td>\n",
       "      <td>Doha</td>\n",
       "      <td>Qatar</td>\n",
       "      <td>True</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>31701</th>\n",
       "      <td>2010-01-02 00:00:00+00:00</td>\n",
       "      <td>Qatar</td>\n",
       "      <td>Mali</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>Friendly</td>\n",
       "      <td>Doha</td>\n",
       "      <td>Qatar</td>\n",
       "      <td>False</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>31702</th>\n",
       "      <td>2010-01-02 00:00:00+00:00</td>\n",
       "      <td>Syria</td>\n",
       "      <td>Zimbabwe</td>\n",
       "      <td>6</td>\n",
       "      <td>0</td>\n",
       "      <td>Friendly</td>\n",
       "      <td>Kuala Lumpur</td>\n",
       "      <td>Malaysia</td>\n",
       "      <td>True</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>31703</th>\n",
       "      <td>2010-01-02 00:00:00+00:00</td>\n",
       "      <td>Yemen</td>\n",
       "      <td>Tajikistan</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>Friendly</td>\n",
       "      <td>Sana'a</td>\n",
       "      <td>Yemen</td>\n",
       "      <td>False</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>31704</th>\n",
       "      <td>2010-01-03 00:00:00+00:00</td>\n",
       "      <td>Angola</td>\n",
       "      <td>Gambia</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>Friendly</td>\n",
       "      <td>Vila Real de Santo António</td>\n",
       "      <td>Portugal</td>\n",
       "      <td>True</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                           date home_team   away_team  home_score  away_score  \\\n",
       "31700 2010-01-02 00:00:00+00:00      Iran   Korea DPR           1           0   \n",
       "31701 2010-01-02 00:00:00+00:00     Qatar        Mali           0           0   \n",
       "31702 2010-01-02 00:00:00+00:00     Syria    Zimbabwe           6           0   \n",
       "31703 2010-01-02 00:00:00+00:00     Yemen  Tajikistan           0           1   \n",
       "31704 2010-01-03 00:00:00+00:00    Angola      Gambia           1           1   \n",
       "\n",
       "      tournament                        city   country  neutral  \n",
       "31700   Friendly                        Doha     Qatar     True  \n",
       "31701   Friendly                        Doha     Qatar    False  \n",
       "31702   Friendly                Kuala Lumpur  Malaysia     True  \n",
       "31703   Friendly                      Sana'a     Yemen    False  \n",
       "31704   Friendly  Vila Real de Santo António  Portugal     True  "
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "results = pd.read_csv('data/fifa/international_results.csv')\n",
    "results['date'] = pd.to_datetime(results['date'], utc=True)\n",
    "\n",
    "# restrict dates\n",
    "earliest_date = '2010-01-01'\n",
    "latest_date = '2018-06-14'\n",
    "results = results[(results['date'] > earliest_date) & (results['date'] < latest_date)]\n",
    "results.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [],
   "source": [
    "# response variable\n",
    "score_diff = results['home_score'] - results['away_score']\n",
    "results['home_win'] = [0 if score < 0 else 1 if score > 0 else 2 for score in score_diff]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>team</th>\n",
       "      <th>date</th>\n",
       "      <th>attack</th>\n",
       "      <th>defence</th>\n",
       "      <th>full_age</th>\n",
       "      <th>midfield</th>\n",
       "      <th>overall</th>\n",
       "      <th>prestige</th>\n",
       "      <th>start_age</th>\n",
       "      <th>bup_speed</th>\n",
       "      <th>...</th>\n",
       "      <th>cc_passing</th>\n",
       "      <th>cc_crossing</th>\n",
       "      <th>cc_shooting</th>\n",
       "      <th>d_pressure</th>\n",
       "      <th>d_aggresion</th>\n",
       "      <th>d_width</th>\n",
       "      <th>wage_euros_thousands</th>\n",
       "      <th>value_euros_millions</th>\n",
       "      <th>growth</th>\n",
       "      <th>goalkeeeper_overall</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>1364</th>\n",
       "      <td>Brazil</td>\n",
       "      <td>2018-05-28</td>\n",
       "      <td>86.0</td>\n",
       "      <td>85.0</td>\n",
       "      <td>27.09</td>\n",
       "      <td>83.0</td>\n",
       "      <td>85.0</td>\n",
       "      <td>10.0</td>\n",
       "      <td>26.73</td>\n",
       "      <td>51.0</td>\n",
       "      <td>...</td>\n",
       "      <td>39.0</td>\n",
       "      <td>33.0</td>\n",
       "      <td>67.0</td>\n",
       "      <td>76.0</td>\n",
       "      <td>73.0</td>\n",
       "      <td>63.0</td>\n",
       "      <td>123.608696</td>\n",
       "      <td>32.500000</td>\n",
       "      <td>1.826087</td>\n",
       "      <td>84.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1365</th>\n",
       "      <td>England</td>\n",
       "      <td>2018-05-28</td>\n",
       "      <td>84.0</td>\n",
       "      <td>81.0</td>\n",
       "      <td>24.65</td>\n",
       "      <td>81.0</td>\n",
       "      <td>82.0</td>\n",
       "      <td>8.0</td>\n",
       "      <td>25.00</td>\n",
       "      <td>49.0</td>\n",
       "      <td>...</td>\n",
       "      <td>55.0</td>\n",
       "      <td>41.0</td>\n",
       "      <td>49.0</td>\n",
       "      <td>43.0</td>\n",
       "      <td>55.0</td>\n",
       "      <td>49.0</td>\n",
       "      <td>100.391304</td>\n",
       "      <td>21.065217</td>\n",
       "      <td>3.608696</td>\n",
       "      <td>78.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1366</th>\n",
       "      <td>Italy</td>\n",
       "      <td>2018-05-28</td>\n",
       "      <td>85.0</td>\n",
       "      <td>85.0</td>\n",
       "      <td>26.04</td>\n",
       "      <td>81.0</td>\n",
       "      <td>83.0</td>\n",
       "      <td>9.0</td>\n",
       "      <td>28.45</td>\n",
       "      <td>73.0</td>\n",
       "      <td>...</td>\n",
       "      <td>64.0</td>\n",
       "      <td>80.0</td>\n",
       "      <td>78.0</td>\n",
       "      <td>29.0</td>\n",
       "      <td>33.0</td>\n",
       "      <td>32.0</td>\n",
       "      <td>91.521739</td>\n",
       "      <td>24.869565</td>\n",
       "      <td>3.173913</td>\n",
       "      <td>89.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1367</th>\n",
       "      <td>Spain</td>\n",
       "      <td>2018-05-28</td>\n",
       "      <td>84.0</td>\n",
       "      <td>86.0</td>\n",
       "      <td>27.04</td>\n",
       "      <td>86.0</td>\n",
       "      <td>86.0</td>\n",
       "      <td>9.0</td>\n",
       "      <td>28.18</td>\n",
       "      <td>32.0</td>\n",
       "      <td>...</td>\n",
       "      <td>27.0</td>\n",
       "      <td>32.0</td>\n",
       "      <td>20.0</td>\n",
       "      <td>75.0</td>\n",
       "      <td>62.0</td>\n",
       "      <td>52.0</td>\n",
       "      <td>168.695652</td>\n",
       "      <td>39.239130</td>\n",
       "      <td>1.826087</td>\n",
       "      <td>91.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1368</th>\n",
       "      <td>France</td>\n",
       "      <td>2018-05-28</td>\n",
       "      <td>83.0</td>\n",
       "      <td>82.0</td>\n",
       "      <td>25.65</td>\n",
       "      <td>85.0</td>\n",
       "      <td>84.0</td>\n",
       "      <td>9.0</td>\n",
       "      <td>25.18</td>\n",
       "      <td>35.0</td>\n",
       "      <td>...</td>\n",
       "      <td>24.0</td>\n",
       "      <td>53.0</td>\n",
       "      <td>35.0</td>\n",
       "      <td>47.0</td>\n",
       "      <td>47.0</td>\n",
       "      <td>67.0</td>\n",
       "      <td>110.782609</td>\n",
       "      <td>31.304348</td>\n",
       "      <td>3.173913</td>\n",
       "      <td>88.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 22 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "         team       date  attack  defence  full_age  midfield  overall  \\\n",
       "1364   Brazil 2018-05-28    86.0     85.0     27.09      83.0     85.0   \n",
       "1365  England 2018-05-28    84.0     81.0     24.65      81.0     82.0   \n",
       "1366    Italy 2018-05-28    85.0     85.0     26.04      81.0     83.0   \n",
       "1367    Spain 2018-05-28    84.0     86.0     27.04      86.0     86.0   \n",
       "1368   France 2018-05-28    83.0     82.0     25.65      85.0     84.0   \n",
       "\n",
       "      prestige  start_age  bup_speed         ...           cc_passing  \\\n",
       "1364      10.0      26.73       51.0         ...                 39.0   \n",
       "1365       8.0      25.00       49.0         ...                 55.0   \n",
       "1366       9.0      28.45       73.0         ...                 64.0   \n",
       "1367       9.0      28.18       32.0         ...                 27.0   \n",
       "1368       9.0      25.18       35.0         ...                 24.0   \n",
       "\n",
       "      cc_crossing  cc_shooting  d_pressure  d_aggresion  d_width  \\\n",
       "1364         33.0         67.0        76.0         73.0     63.0   \n",
       "1365         41.0         49.0        43.0         55.0     49.0   \n",
       "1366         80.0         78.0        29.0         33.0     32.0   \n",
       "1367         32.0         20.0        75.0         62.0     52.0   \n",
       "1368         53.0         35.0        47.0         47.0     67.0   \n",
       "\n",
       "      wage_euros_thousands  value_euros_millions    growth  \\\n",
       "1364            123.608696             32.500000  1.826087   \n",
       "1365            100.391304             21.065217  3.608696   \n",
       "1366             91.521739             24.869565  3.173913   \n",
       "1367            168.695652             39.239130  1.826087   \n",
       "1368            110.782609             31.304348  3.173913   \n",
       "\n",
       "      goalkeeeper_overall  \n",
       "1364                 84.0  \n",
       "1365                 78.0  \n",
       "1366                 89.0  \n",
       "1367                 91.0  \n",
       "1368                 88.0  \n",
       "\n",
       "[5 rows x 22 columns]"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ratings = pd.read_csv('data/team_stats_final.csv')\n",
    "ratings['date'] = pd.to_datetime(ratings['date'])\n",
    "\n",
    "# restrict dates\n",
    "ratings = ratings[(ratings['date'] > earliest_date) & (ratings['date'] < latest_date)]\n",
    "ratings.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>rank</th>\n",
       "      <th>country_full</th>\n",
       "      <th>country_abrv</th>\n",
       "      <th>total_points</th>\n",
       "      <th>previous_points</th>\n",
       "      <th>rank_change</th>\n",
       "      <th>cur_year_avg</th>\n",
       "      <th>cur_year_avg_weighted</th>\n",
       "      <th>last_year_avg</th>\n",
       "      <th>last_year_avg_weighted</th>\n",
       "      <th>two_year_ago_avg</th>\n",
       "      <th>two_year_ago_weighted</th>\n",
       "      <th>three_year_ago_avg</th>\n",
       "      <th>three_year_ago_weighted</th>\n",
       "      <th>confederation</th>\n",
       "      <th>rank_date</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>Germany</td>\n",
       "      <td>GER</td>\n",
       "      <td>0.0</td>\n",
       "      <td>57</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>UEFA</td>\n",
       "      <td>1993-08-08</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2</td>\n",
       "      <td>Italy</td>\n",
       "      <td>ITA</td>\n",
       "      <td>0.0</td>\n",
       "      <td>57</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>UEFA</td>\n",
       "      <td>1993-08-08</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>3</td>\n",
       "      <td>Switzerland</td>\n",
       "      <td>SUI</td>\n",
       "      <td>0.0</td>\n",
       "      <td>50</td>\n",
       "      <td>9</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>UEFA</td>\n",
       "      <td>1993-08-08</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>4</td>\n",
       "      <td>Sweden</td>\n",
       "      <td>SWE</td>\n",
       "      <td>0.0</td>\n",
       "      <td>55</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>UEFA</td>\n",
       "      <td>1993-08-08</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>5</td>\n",
       "      <td>Argentina</td>\n",
       "      <td>ARG</td>\n",
       "      <td>0.0</td>\n",
       "      <td>51</td>\n",
       "      <td>5</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>CONMEBOL</td>\n",
       "      <td>1993-08-08</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   rank country_full country_abrv  total_points  previous_points  rank_change  \\\n",
       "0     1      Germany          GER           0.0               57            0   \n",
       "1     2        Italy          ITA           0.0               57            0   \n",
       "2     3  Switzerland          SUI           0.0               50            9   \n",
       "3     4       Sweden          SWE           0.0               55            0   \n",
       "4     5    Argentina          ARG           0.0               51            5   \n",
       "\n",
       "   cur_year_avg  cur_year_avg_weighted  last_year_avg  last_year_avg_weighted  \\\n",
       "0           0.0                    0.0            0.0                     0.0   \n",
       "1           0.0                    0.0            0.0                     0.0   \n",
       "2           0.0                    0.0            0.0                     0.0   \n",
       "3           0.0                    0.0            0.0                     0.0   \n",
       "4           0.0                    0.0            0.0                     0.0   \n",
       "\n",
       "   two_year_ago_avg  two_year_ago_weighted  three_year_ago_avg  \\\n",
       "0               0.0                    0.0                 0.0   \n",
       "1               0.0                    0.0                 0.0   \n",
       "2               0.0                    0.0                 0.0   \n",
       "3               0.0                    0.0                 0.0   \n",
       "4               0.0                    0.0                 0.0   \n",
       "\n",
       "   three_year_ago_weighted confederation  rank_date  \n",
       "0                      0.0          UEFA 1993-08-08  \n",
       "1                      0.0          UEFA 1993-08-08  \n",
       "2                      0.0          UEFA 1993-08-08  \n",
       "3                      0.0          UEFA 1993-08-08  \n",
       "4                      0.0      CONMEBOL 1993-08-08  "
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "fifa_rankings = pd.read_csv('data/fifa_ranking.csv')\n",
    "fifa_rankings['rank_date'] = pd.to_datetime(fifa_rankings['rank_date'])\n",
    "fifa_rankings.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "We now have to find for each match the latest team ratings and ranking."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [],
   "source": [
    "dates = pd.Series(ratings.date.unique())\n",
    "teams = ratings.team.unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Cannot Find Republic of Ireland in Results Home\n",
      "Cannot Find United States in Results Home\n",
      "Cannot Find China PR in Results Home\n",
      "Cannot Find Côte d'Ivoire in Results Home\n",
      "Cannot Find Republic of Ireland in Results Away\n",
      "Cannot Find United States in Results Away\n",
      "Cannot Find China PR in Results Away\n",
      "Cannot Find Côte d'Ivoire in Results Away\n",
      "Cannot Find United States in Rankings\n",
      "Cannot Find Iran in Rankings\n"
     ]
    }
   ],
   "source": [
    "# check that we found the corresponding team from team ratings in results\n",
    "for t in teams:\n",
    "    try:\n",
    "        assert np.sum(results.home_team.unique() == t) == 1\n",
    "    except:\n",
    "        print('Cannot Find {} in Results Home'.format(t))\n",
    "\n",
    "for t in teams:\n",
    "    try:\n",
    "        assert np.sum(results.away_team.unique() == t) == 1\n",
    "    except:\n",
    "        print('Cannot Find {} in Results Away'.format(t))\n",
    "        \n",
    "for t in teams:\n",
    "    try:\n",
    "        assert np.sum(fifa_rankings.country_full.unique() == t) == 1\n",
    "    except:\n",
    "        print('Cannot Find {} in Rankings'.format(t))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Before we proceed with anything else, let's check that country names are spelled similarly. We find that 'Republic of Ireland', 'United States', 'China PR', and 'Côte d'Ivoire' might be spelled differently."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [],
   "source": [
    "ratings.replace('Republic of Ireland', 'Ireland', inplace=True)\n",
    "ratings.replace('United States', 'USA', inplace=True)\n",
    "ratings.replace('China PR', 'China', inplace=True)\n",
    "ratings.replace(\"Côte d'Ivoire\", 'Ivory Coast', inplace=True)\n",
    "fifa_rankings.replace(\"IR Iran\", \"Iran\", inplace = True)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Now we finally have two datasets of teams spelled in the same way."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [],
   "source": [
    "# find closest date that we have data \n",
    "def get_latest_date(match_date, dates):\n",
    "    match_date = match_date.to_datetime64()\n",
    "    return dates[match_date >  dates].max()\n",
    "\n",
    "# results['closest_date'] = results.apply(lambda i: min(dates, key=lambda d: abs(d-i.date)), axis=1)\n",
    "results['closest_rating_date'] = results['date'].apply(get_latest_date, dates = dates)\n",
    "results['closest_ranking_date'] = results['date'].apply(get_latest_date, dates = fifa_rankings.rank_date)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>home_team</th>\n",
       "      <th>away_team</th>\n",
       "      <th>home_score</th>\n",
       "      <th>away_score</th>\n",
       "      <th>tournament</th>\n",
       "      <th>city</th>\n",
       "      <th>country</th>\n",
       "      <th>neutral</th>\n",
       "      <th>home_win</th>\n",
       "      <th>closest_rating_date</th>\n",
       "      <th>closest_ranking_date</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>39601</th>\n",
       "      <td>2018-06-10 00:00:00+00:00</td>\n",
       "      <td>Austria</td>\n",
       "      <td>Brazil</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>Friendly</td>\n",
       "      <td>Vienna</td>\n",
       "      <td>Austria</td>\n",
       "      <td>False</td>\n",
       "      <td>0</td>\n",
       "      <td>2018-06-07</td>\n",
       "      <td>2018-06-07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>39602</th>\n",
       "      <td>2018-06-11 00:00:00+00:00</td>\n",
       "      <td>Korea Republic</td>\n",
       "      <td>Senegal</td>\n",
       "      <td>0</td>\n",
       "      <td>2</td>\n",
       "      <td>Friendly</td>\n",
       "      <td>Grödig</td>\n",
       "      <td>Austria</td>\n",
       "      <td>True</td>\n",
       "      <td>0</td>\n",
       "      <td>2018-06-07</td>\n",
       "      <td>2018-06-07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>39603</th>\n",
       "      <td>2018-06-11 00:00:00+00:00</td>\n",
       "      <td>Belgium</td>\n",
       "      <td>Costa Rica</td>\n",
       "      <td>4</td>\n",
       "      <td>1</td>\n",
       "      <td>Friendly</td>\n",
       "      <td>Brussels</td>\n",
       "      <td>Belgium</td>\n",
       "      <td>False</td>\n",
       "      <td>1</td>\n",
       "      <td>2018-06-07</td>\n",
       "      <td>2018-06-07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>39604</th>\n",
       "      <td>2018-06-12 00:00:00+00:00</td>\n",
       "      <td>Japan</td>\n",
       "      <td>Paraguay</td>\n",
       "      <td>4</td>\n",
       "      <td>2</td>\n",
       "      <td>Friendly</td>\n",
       "      <td>Innsbruck</td>\n",
       "      <td>Austria</td>\n",
       "      <td>True</td>\n",
       "      <td>1</td>\n",
       "      <td>2018-06-11</td>\n",
       "      <td>2018-06-07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>39605</th>\n",
       "      <td>2018-06-12 00:00:00+00:00</td>\n",
       "      <td>Poland</td>\n",
       "      <td>Lithuania</td>\n",
       "      <td>4</td>\n",
       "      <td>0</td>\n",
       "      <td>Friendly</td>\n",
       "      <td>Warsaw</td>\n",
       "      <td>Poland</td>\n",
       "      <td>False</td>\n",
       "      <td>1</td>\n",
       "      <td>2018-06-11</td>\n",
       "      <td>2018-06-07</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                           date       home_team   away_team  home_score  \\\n",
       "39601 2018-06-10 00:00:00+00:00         Austria      Brazil           0   \n",
       "39602 2018-06-11 00:00:00+00:00  Korea Republic     Senegal           0   \n",
       "39603 2018-06-11 00:00:00+00:00         Belgium  Costa Rica           4   \n",
       "39604 2018-06-12 00:00:00+00:00           Japan    Paraguay           4   \n",
       "39605 2018-06-12 00:00:00+00:00          Poland   Lithuania           4   \n",
       "\n",
       "       away_score tournament       city  country  neutral  home_win  \\\n",
       "39601           3   Friendly     Vienna  Austria    False         0   \n",
       "39602           2   Friendly     Grödig  Austria     True         0   \n",
       "39603           1   Friendly   Brussels  Belgium    False         1   \n",
       "39604           2   Friendly  Innsbruck  Austria     True         1   \n",
       "39605           0   Friendly     Warsaw   Poland    False         1   \n",
       "\n",
       "      closest_rating_date closest_ranking_date  \n",
       "39601          2018-06-07           2018-06-07  \n",
       "39602          2018-06-07           2018-06-07  \n",
       "39603          2018-06-07           2018-06-07  \n",
       "39604          2018-06-11           2018-06-07  \n",
       "39605          2018-06-11           2018-06-07  "
      ]
     },
     "execution_count": 11,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "results.tail()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Now that we have the closest matching data for both of our datasets, we can merge on team and date. We will first do this for the ratings dataset. \n",
    "\n",
    "Note that for both the ratings and rankings tables we have merge twice in order to account for both home and away teams."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>index</th>\n",
       "      <th>date_x</th>\n",
       "      <th>home_team</th>\n",
       "      <th>away_team</th>\n",
       "      <th>home_score</th>\n",
       "      <th>away_score</th>\n",
       "      <th>tournament</th>\n",
       "      <th>city</th>\n",
       "      <th>country</th>\n",
       "      <th>neutral</th>\n",
       "      <th>...</th>\n",
       "      <th>cc_passing_y</th>\n",
       "      <th>cc_crossing_y</th>\n",
       "      <th>cc_shooting_y</th>\n",
       "      <th>d_pressure_y</th>\n",
       "      <th>d_aggresion_y</th>\n",
       "      <th>d_width_y</th>\n",
       "      <th>wage_euros_thousands_y</th>\n",
       "      <th>value_euros_millions_y</th>\n",
       "      <th>growth_y</th>\n",
       "      <th>goalkeeeper_overall_y</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>31786</td>\n",
       "      <td>2010-02-24 00:00:00+00:00</td>\n",
       "      <td>Mexico</td>\n",
       "      <td>Bolivia</td>\n",
       "      <td>5</td>\n",
       "      <td>0</td>\n",
       "      <td>Friendly</td>\n",
       "      <td>San Francisco</td>\n",
       "      <td>USA</td>\n",
       "      <td>True</td>\n",
       "      <td>...</td>\n",
       "      <td>53.0</td>\n",
       "      <td>72.0</td>\n",
       "      <td>64.0</td>\n",
       "      <td>47.0</td>\n",
       "      <td>33.0</td>\n",
       "      <td>64.0</td>\n",
       "      <td>0.869565</td>\n",
       "      <td>0.275</td>\n",
       "      <td>4.391304</td>\n",
       "      <td>66.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>31823</td>\n",
       "      <td>2010-03-03 00:00:00+00:00</td>\n",
       "      <td>Mexico</td>\n",
       "      <td>New Zealand</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>Friendly</td>\n",
       "      <td>Pasadena</td>\n",
       "      <td>USA</td>\n",
       "      <td>True</td>\n",
       "      <td>...</td>\n",
       "      <td>70.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>35.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000</td>\n",
       "      <td>8.266667</td>\n",
       "      <td>60.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>31878</td>\n",
       "      <td>2010-05-24 00:00:00+00:00</td>\n",
       "      <td>Australia</td>\n",
       "      <td>New Zealand</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>Friendly</td>\n",
       "      <td>Melbourne</td>\n",
       "      <td>Australia</td>\n",
       "      <td>False</td>\n",
       "      <td>...</td>\n",
       "      <td>70.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>35.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000</td>\n",
       "      <td>8.266667</td>\n",
       "      <td>60.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>32000</td>\n",
       "      <td>2010-06-20 00:00:00+00:00</td>\n",
       "      <td>Italy</td>\n",
       "      <td>New Zealand</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>FIFA World Cup</td>\n",
       "      <td>Nelspruit</td>\n",
       "      <td>South Africa</td>\n",
       "      <td>True</td>\n",
       "      <td>...</td>\n",
       "      <td>70.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>35.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000</td>\n",
       "      <td>8.266667</td>\n",
       "      <td>60.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>31949</td>\n",
       "      <td>2010-06-04 00:00:00+00:00</td>\n",
       "      <td>Slovenia</td>\n",
       "      <td>New Zealand</td>\n",
       "      <td>3</td>\n",
       "      <td>1</td>\n",
       "      <td>Friendly</td>\n",
       "      <td>Maribor</td>\n",
       "      <td>Slovenia</td>\n",
       "      <td>False</td>\n",
       "      <td>...</td>\n",
       "      <td>70.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>35.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000</td>\n",
       "      <td>8.266667</td>\n",
       "      <td>60.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 57 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   index                    date_x  home_team    away_team  home_score  \\\n",
       "0  31786 2010-02-24 00:00:00+00:00     Mexico      Bolivia           5   \n",
       "1  31823 2010-03-03 00:00:00+00:00     Mexico  New Zealand           2   \n",
       "2  31878 2010-05-24 00:00:00+00:00  Australia  New Zealand           2   \n",
       "3  32000 2010-06-20 00:00:00+00:00      Italy  New Zealand           1   \n",
       "4  31949 2010-06-04 00:00:00+00:00   Slovenia  New Zealand           3   \n",
       "\n",
       "   away_score      tournament           city       country  neutral  \\\n",
       "0           0        Friendly  San Francisco           USA     True   \n",
       "1           0        Friendly       Pasadena           USA     True   \n",
       "2           1        Friendly      Melbourne     Australia    False   \n",
       "3           1  FIFA World Cup      Nelspruit  South Africa     True   \n",
       "4           1        Friendly        Maribor      Slovenia    False   \n",
       "\n",
       "           ...            cc_passing_y cc_crossing_y cc_shooting_y  \\\n",
       "0          ...                    53.0          72.0          64.0   \n",
       "1          ...                    70.0          70.0          70.0   \n",
       "2          ...                    70.0          70.0          70.0   \n",
       "3          ...                    70.0          70.0          70.0   \n",
       "4          ...                    70.0          70.0          70.0   \n",
       "\n",
       "  d_pressure_y d_aggresion_y  d_width_y  wage_euros_thousands_y  \\\n",
       "0         47.0          33.0       64.0                0.869565   \n",
       "1         70.0          70.0       35.0                0.000000   \n",
       "2         70.0          70.0       35.0                0.000000   \n",
       "3         70.0          70.0       35.0                0.000000   \n",
       "4         70.0          70.0       35.0                0.000000   \n",
       "\n",
       "   value_euros_millions_y  growth_y  goalkeeeper_overall_y  \n",
       "0                   0.275  4.391304                   66.0  \n",
       "1                   0.000  8.266667                   60.0  \n",
       "2                   0.000  8.266667                   60.0  \n",
       "3                   0.000  8.266667                   60.0  \n",
       "4                   0.000  8.266667                   60.0  \n",
       "\n",
       "[5 rows x 57 columns]"
      ]
     },
     "execution_count": 12,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Reset index to keep track of original index\n",
    "results = results.reset_index()\n",
    "\n",
    "results_ratings1 = results.merge(ratings, how='inner', \n",
    "                                left_on=['closest_rating_date', 'home_team'],\n",
    "                                right_on=['date', 'team'])\n",
    "\n",
    "results_ratings2 = results_ratings1.merge(ratings, how='inner',\n",
    "                                       left_on=['closest_rating_date', 'away_team'],\n",
    "                                       right_on=['date', 'team'])\n",
    "\n",
    "results_ratings2.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(1871, 57)"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "results_ratings2.shape"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "We find that we have 1871 observations that can still be used after matching team ratings with the results dataframe with an inner merge. We now clean up the merged dataframe slightly."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>attack_x</th>\n",
       "      <th>attack_y</th>\n",
       "      <th>bup_dribbling_x</th>\n",
       "      <th>bup_dribbling_y</th>\n",
       "      <th>bup_passing_x</th>\n",
       "      <th>bup_passing_y</th>\n",
       "      <th>bup_speed_x</th>\n",
       "      <th>bup_speed_y</th>\n",
       "      <th>cc_crossing_x</th>\n",
       "      <th>cc_crossing_y</th>\n",
       "      <th>...</th>\n",
       "      <th>overall_x</th>\n",
       "      <th>overall_y</th>\n",
       "      <th>prestige_x</th>\n",
       "      <th>prestige_y</th>\n",
       "      <th>start_age_x</th>\n",
       "      <th>start_age_y</th>\n",
       "      <th>value_euros_millions_x</th>\n",
       "      <th>value_euros_millions_y</th>\n",
       "      <th>wage_euros_thousands_x</th>\n",
       "      <th>wage_euros_thousands_y</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>73.0</td>\n",
       "      <td>67.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>52.0</td>\n",
       "      <td>45.0</td>\n",
       "      <td>52.0</td>\n",
       "      <td>65.0</td>\n",
       "      <td>50.0</td>\n",
       "      <td>55.0</td>\n",
       "      <td>72.0</td>\n",
       "      <td>...</td>\n",
       "      <td>77.0</td>\n",
       "      <td>67.0</td>\n",
       "      <td>15.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>27.09</td>\n",
       "      <td>25.18</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.275</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.869565</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>73.0</td>\n",
       "      <td>60.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>45.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>65.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>55.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>...</td>\n",
       "      <td>77.0</td>\n",
       "      <td>62.0</td>\n",
       "      <td>15.0</td>\n",
       "      <td>6.0</td>\n",
       "      <td>27.09</td>\n",
       "      <td>29.18</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>71.0</td>\n",
       "      <td>60.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>60.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>...</td>\n",
       "      <td>75.0</td>\n",
       "      <td>62.0</td>\n",
       "      <td>11.0</td>\n",
       "      <td>6.0</td>\n",
       "      <td>30.36</td>\n",
       "      <td>29.18</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>83.0</td>\n",
       "      <td>60.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>30.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>67.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>60.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>...</td>\n",
       "      <td>83.0</td>\n",
       "      <td>62.0</td>\n",
       "      <td>19.0</td>\n",
       "      <td>6.0</td>\n",
       "      <td>28.91</td>\n",
       "      <td>29.18</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>70.0</td>\n",
       "      <td>60.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>65.0</td>\n",
       "      <td>70.0</td>\n",
       "      <td>...</td>\n",
       "      <td>70.0</td>\n",
       "      <td>62.0</td>\n",
       "      <td>5.0</td>\n",
       "      <td>6.0</td>\n",
       "      <td>25.64</td>\n",
       "      <td>29.18</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 41 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   attack_x  attack_y  bup_dribbling_x  bup_dribbling_y  bup_passing_x  \\\n",
       "0      73.0      67.0              0.0             52.0           45.0   \n",
       "1      73.0      60.0              0.0              0.0           45.0   \n",
       "2      71.0      60.0              0.0              0.0           70.0   \n",
       "3      83.0      60.0              0.0              0.0           30.0   \n",
       "4      70.0      60.0              0.0              0.0           70.0   \n",
       "\n",
       "   bup_passing_y  bup_speed_x  bup_speed_y  cc_crossing_x  cc_crossing_y  \\\n",
       "0           52.0         65.0         50.0           55.0           72.0   \n",
       "1           70.0         65.0         70.0           55.0           70.0   \n",
       "2           70.0         70.0         70.0           60.0           70.0   \n",
       "3           70.0         67.0         70.0           60.0           70.0   \n",
       "4           70.0         70.0         70.0           65.0           70.0   \n",
       "\n",
       "            ...            overall_x  overall_y  prestige_x  prestige_y  \\\n",
       "0           ...                 77.0       67.0        15.0         1.0   \n",
       "1           ...                 77.0       62.0        15.0         6.0   \n",
       "2           ...                 75.0       62.0        11.0         6.0   \n",
       "3           ...                 83.0       62.0        19.0         6.0   \n",
       "4           ...                 70.0       62.0         5.0         6.0   \n",
       "\n",
       "   start_age_x  start_age_y  value_euros_millions_x  value_euros_millions_y  \\\n",
       "0        27.09        25.18                     0.0                   0.275   \n",
       "1        27.09        29.18                     0.0                   0.000   \n",
       "2        30.36        29.18                     0.0                   0.000   \n",
       "3        28.91        29.18                     0.0                   0.000   \n",
       "4        25.64        29.18                     0.0                   0.000   \n",
       "\n",
       "   wage_euros_thousands_x  wage_euros_thousands_y  \n",
       "0                     0.0                0.869565  \n",
       "1                     0.0                0.000000  \n",
       "2                     0.0                0.000000  \n",
       "3                     0.0                0.000000  \n",
       "4                     0.0                0.000000  \n",
       "\n",
       "[5 rows x 41 columns]"
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# drop useless columns\n",
    "results_ratings3 = results_ratings2.drop(['index', 'home_team', 'away_team', 'tournament', \n",
    "                       'city', 'country', 'neutral', 'closest_rating_date', 'closest_ranking_date',\n",
    "                      'team_x', 'date_y', 'team_y', 'date',\n",
    "                      'home_score', 'away_score', 'date_x'], axis=1)\n",
    "\n",
    "# reorder columns\n",
    "results_ratings3.sort_index(axis=1, inplace=True)\n",
    "results_ratings3.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Our final training data is basically a difference in the various team ratings. Now let's clean up the dataframe for our training."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>home_win</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   home_win\n",
       "0         1\n",
       "1         1\n",
       "2         1\n",
       "3         2\n",
       "4         1"
      ]
     },
     "execution_count": 15,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ratings_base = results_ratings3.loc[:,['home_win']]\n",
    "ratings_base.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 46,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>attack_y</th>\n",
       "      <th>bup_dribbling_y</th>\n",
       "      <th>bup_passing_y</th>\n",
       "      <th>bup_speed_y</th>\n",
       "      <th>cc_crossing_y</th>\n",
       "      <th>cc_passing_y</th>\n",
       "      <th>cc_shooting_y</th>\n",
       "      <th>d_aggresion_y</th>\n",
       "      <th>d_pressure_y</th>\n",
       "      <th>d_width_y</th>\n",
       "      <th>defence_y</th>\n",
       "      <th>full_age_y</th>\n",
       "      <th>goalkeeeper_overall_y</th>\n",
       "      <th>growth_y</th>\n",
       "      <th>midfield_y</th>\n",
       "      <th>overall_y</th>\n",
       "      <th>prestige_y</th>\n",
       "      <th>start_age_y</th>\n",
       "      <th>value_euros_millions_y</th>\n",
       "      <th>wage_euros_thousands_y</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>6.0</td>\n",
       "      <td>-52.0</td>\n",
       "      <td>-7.0</td>\n",
       "      <td>15.0</td>\n",
       "      <td>-17.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>27.0</td>\n",
       "      <td>18.0</td>\n",
       "      <td>-4.0</td>\n",
       "      <td>9.0</td>\n",
       "      <td>1.46</td>\n",
       "      <td>13.0</td>\n",
       "      <td>2.208696</td>\n",
       "      <td>6.0</td>\n",
       "      <td>10.0</td>\n",
       "      <td>14.0</td>\n",
       "      <td>1.91</td>\n",
       "      <td>-0.275</td>\n",
       "      <td>-0.869565</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>13.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-25.0</td>\n",
       "      <td>-5.0</td>\n",
       "      <td>-15.0</td>\n",
       "      <td>-5.0</td>\n",
       "      <td>-5.0</td>\n",
       "      <td>-10.0</td>\n",
       "      <td>-5.0</td>\n",
       "      <td>25.0</td>\n",
       "      <td>16.0</td>\n",
       "      <td>0.23</td>\n",
       "      <td>19.0</td>\n",
       "      <td>-1.666667</td>\n",
       "      <td>17.0</td>\n",
       "      <td>15.0</td>\n",
       "      <td>9.0</td>\n",
       "      <td>-2.09</td>\n",
       "      <td>-0.000</td>\n",
       "      <td>-0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>11.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-10.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-20.0</td>\n",
       "      <td>15.0</td>\n",
       "      <td>10.0</td>\n",
       "      <td>1.53</td>\n",
       "      <td>19.0</td>\n",
       "      <td>-1.466667</td>\n",
       "      <td>14.0</td>\n",
       "      <td>13.0</td>\n",
       "      <td>5.0</td>\n",
       "      <td>1.18</td>\n",
       "      <td>-0.000</td>\n",
       "      <td>-0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>23.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-40.0</td>\n",
       "      <td>-3.0</td>\n",
       "      <td>-10.0</td>\n",
       "      <td>-15.0</td>\n",
       "      <td>-30.0</td>\n",
       "      <td>-40.0</td>\n",
       "      <td>-40.0</td>\n",
       "      <td>15.0</td>\n",
       "      <td>22.0</td>\n",
       "      <td>1.20</td>\n",
       "      <td>28.0</td>\n",
       "      <td>-3.433333</td>\n",
       "      <td>24.0</td>\n",
       "      <td>21.0</td>\n",
       "      <td>13.0</td>\n",
       "      <td>-0.27</td>\n",
       "      <td>-0.000</td>\n",
       "      <td>-0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>10.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-5.0</td>\n",
       "      <td>-15.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-20.0</td>\n",
       "      <td>15.0</td>\n",
       "      <td>9.0</td>\n",
       "      <td>-0.30</td>\n",
       "      <td>18.0</td>\n",
       "      <td>0.300000</td>\n",
       "      <td>10.0</td>\n",
       "      <td>8.0</td>\n",
       "      <td>-1.0</td>\n",
       "      <td>-3.54</td>\n",
       "      <td>-0.000</td>\n",
       "      <td>-0.000000</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   attack_y  bup_dribbling_y  bup_passing_y  bup_speed_y  cc_crossing_y  \\\n",
       "0       6.0            -52.0           -7.0         15.0          -17.0   \n",
       "1      13.0             -0.0          -25.0         -5.0          -15.0   \n",
       "2      11.0             -0.0           -0.0         -0.0          -10.0   \n",
       "3      23.0             -0.0          -40.0         -3.0          -10.0   \n",
       "4      10.0             -0.0           -0.0         -0.0           -5.0   \n",
       "\n",
       "   cc_passing_y  cc_shooting_y  d_aggresion_y  d_pressure_y  d_width_y  \\\n",
       "0          12.0            1.0           27.0          18.0       -4.0   \n",
       "1          -5.0           -5.0          -10.0          -5.0       25.0   \n",
       "2          -0.0           -0.0           -0.0         -20.0       15.0   \n",
       "3         -15.0          -30.0          -40.0         -40.0       15.0   \n",
       "4         -15.0           -0.0           -0.0         -20.0       15.0   \n",
       "\n",
       "   defence_y  full_age_y  goalkeeeper_overall_y  growth_y  midfield_y  \\\n",
       "0        9.0        1.46                   13.0  2.208696         6.0   \n",
       "1       16.0        0.23                   19.0 -1.666667        17.0   \n",
       "2       10.0        1.53                   19.0 -1.466667        14.0   \n",
       "3       22.0        1.20                   28.0 -3.433333        24.0   \n",
       "4        9.0       -0.30                   18.0  0.300000        10.0   \n",
       "\n",
       "   overall_y  prestige_y  start_age_y  value_euros_millions_y  \\\n",
       "0       10.0        14.0         1.91                  -0.275   \n",
       "1       15.0         9.0        -2.09                  -0.000   \n",
       "2       13.0         5.0         1.18                  -0.000   \n",
       "3       21.0        13.0        -0.27                  -0.000   \n",
       "4        8.0        -1.0        -3.54                  -0.000   \n",
       "\n",
       "   wage_euros_thousands_y  \n",
       "0               -0.869565  \n",
       "1               -0.000000  \n",
       "2               -0.000000  \n",
       "3               -0.000000  \n",
       "4               -0.000000  "
      ]
     },
     "execution_count": 46,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "diff_ratings = results_ratings3.drop('home_win', axis=1)\n",
    "#Diff every column with column beforehand. \n",
    "diff_ratings = diff_ratings.diff(axis=1)\n",
    "ncol = diff_ratings.shape[1]\n",
    "\n",
    "# Since we diff every column with column beforehand, we only want every alternate column since those are the true diff\n",
    "diff_ratings = diff_ratings.iloc[:,list(np.arange(1,ncol, 2))]\n",
    "\n",
    "# we want our statistics to be from perspective of home team\n",
    "diff_ratings = diff_ratings*-1\n",
    "\n",
    "\n",
    "diff_ratings.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 47,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>home_win</th>\n",
       "      <th>attack_diff</th>\n",
       "      <th>bup_dribbling_diff</th>\n",
       "      <th>bup_passing_diff</th>\n",
       "      <th>bup_speed_diff</th>\n",
       "      <th>cc_crossing_diff</th>\n",
       "      <th>cc_passing_diff</th>\n",
       "      <th>cc_shooting_diff</th>\n",
       "      <th>d_aggresion_diff</th>\n",
       "      <th>d_pressure_diff</th>\n",
       "      <th>...</th>\n",
       "      <th>growth_diff</th>\n",
       "      <th>midfield_diff</th>\n",
       "      <th>overall_diff</th>\n",
       "      <th>prestige_diff</th>\n",
       "      <th>start_age_diff</th>\n",
       "      <th>value_euros_millions_diff</th>\n",
       "      <th>wage_euros_thousands_diff</th>\n",
       "      <th>attack_home_defence_away_diff</th>\n",
       "      <th>attack_away_defence_home_diff</th>\n",
       "      <th>index</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>6.0</td>\n",
       "      <td>-52.0</td>\n",
       "      <td>-7.0</td>\n",
       "      <td>15.0</td>\n",
       "      <td>-17.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>27.0</td>\n",
       "      <td>18.0</td>\n",
       "      <td>...</td>\n",
       "      <td>2.208696</td>\n",
       "      <td>6.0</td>\n",
       "      <td>10.0</td>\n",
       "      <td>14.0</td>\n",
       "      <td>1.91</td>\n",
       "      <td>-0.275</td>\n",
       "      <td>-0.869565</td>\n",
       "      <td>8.0</td>\n",
       "      <td>-7.0</td>\n",
       "      <td>31786</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>13.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-25.0</td>\n",
       "      <td>-5.0</td>\n",
       "      <td>-15.0</td>\n",
       "      <td>-5.0</td>\n",
       "      <td>-5.0</td>\n",
       "      <td>-10.0</td>\n",
       "      <td>-5.0</td>\n",
       "      <td>...</td>\n",
       "      <td>-1.666667</td>\n",
       "      <td>17.0</td>\n",
       "      <td>15.0</td>\n",
       "      <td>9.0</td>\n",
       "      <td>-2.09</td>\n",
       "      <td>-0.000</td>\n",
       "      <td>-0.000000</td>\n",
       "      <td>15.0</td>\n",
       "      <td>-14.0</td>\n",
       "      <td>31823</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1</td>\n",
       "      <td>11.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-10.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-20.0</td>\n",
       "      <td>...</td>\n",
       "      <td>-1.466667</td>\n",
       "      <td>14.0</td>\n",
       "      <td>13.0</td>\n",
       "      <td>5.0</td>\n",
       "      <td>1.18</td>\n",
       "      <td>-0.000</td>\n",
       "      <td>-0.000000</td>\n",
       "      <td>13.0</td>\n",
       "      <td>-8.0</td>\n",
       "      <td>31878</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2</td>\n",
       "      <td>23.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-40.0</td>\n",
       "      <td>-3.0</td>\n",
       "      <td>-10.0</td>\n",
       "      <td>-15.0</td>\n",
       "      <td>-30.0</td>\n",
       "      <td>-40.0</td>\n",
       "      <td>-40.0</td>\n",
       "      <td>...</td>\n",
       "      <td>-3.433333</td>\n",
       "      <td>24.0</td>\n",
       "      <td>21.0</td>\n",
       "      <td>13.0</td>\n",
       "      <td>-0.27</td>\n",
       "      <td>-0.000</td>\n",
       "      <td>-0.000000</td>\n",
       "      <td>25.0</td>\n",
       "      <td>-20.0</td>\n",
       "      <td>32000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>1</td>\n",
       "      <td>10.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-5.0</td>\n",
       "      <td>-15.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-20.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.300000</td>\n",
       "      <td>10.0</td>\n",
       "      <td>8.0</td>\n",
       "      <td>-1.0</td>\n",
       "      <td>-3.54</td>\n",
       "      <td>-0.000</td>\n",
       "      <td>-0.000000</td>\n",
       "      <td>12.0</td>\n",
       "      <td>-7.0</td>\n",
       "      <td>31949</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 24 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   home_win  attack_diff  bup_dribbling_diff  bup_passing_diff  \\\n",
       "0         1          6.0               -52.0              -7.0   \n",
       "1         1         13.0                -0.0             -25.0   \n",
       "2         1         11.0                -0.0              -0.0   \n",
       "3         2         23.0                -0.0             -40.0   \n",
       "4         1         10.0                -0.0              -0.0   \n",
       "\n",
       "   bup_speed_diff  cc_crossing_diff  cc_passing_diff  cc_shooting_diff  \\\n",
       "0            15.0             -17.0             12.0               1.0   \n",
       "1            -5.0             -15.0             -5.0              -5.0   \n",
       "2            -0.0             -10.0             -0.0              -0.0   \n",
       "3            -3.0             -10.0            -15.0             -30.0   \n",
       "4            -0.0              -5.0            -15.0              -0.0   \n",
       "\n",
       "   d_aggresion_diff  d_pressure_diff  ...    growth_diff  midfield_diff  \\\n",
       "0              27.0             18.0  ...       2.208696            6.0   \n",
       "1             -10.0             -5.0  ...      -1.666667           17.0   \n",
       "2              -0.0            -20.0  ...      -1.466667           14.0   \n",
       "3             -40.0            -40.0  ...      -3.433333           24.0   \n",
       "4              -0.0            -20.0  ...       0.300000           10.0   \n",
       "\n",
       "   overall_diff  prestige_diff  start_age_diff  value_euros_millions_diff  \\\n",
       "0          10.0           14.0            1.91                     -0.275   \n",
       "1          15.0            9.0           -2.09                     -0.000   \n",
       "2          13.0            5.0            1.18                     -0.000   \n",
       "3          21.0           13.0           -0.27                     -0.000   \n",
       "4           8.0           -1.0           -3.54                     -0.000   \n",
       "\n",
       "   wage_euros_thousands_diff  attack_home_defence_away_diff  \\\n",
       "0                  -0.869565                            8.0   \n",
       "1                  -0.000000                           15.0   \n",
       "2                  -0.000000                           13.0   \n",
       "3                  -0.000000                           25.0   \n",
       "4                  -0.000000                           12.0   \n",
       "\n",
       "   attack_away_defence_home_diff  index  \n",
       "0                           -7.0  31786  \n",
       "1                          -14.0  31823  \n",
       "2                           -8.0  31878  \n",
       "3                          -20.0  32000  \n",
       "4                           -7.0  31949  \n",
       "\n",
       "[5 rows x 24 columns]"
      ]
     },
     "execution_count": 47,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "columns = [column[:-2] + '_diff' for column in diff_ratings.columns]\n",
    "\n",
    "diff_ratings.columns = columns\n",
    "\n",
    "#Also want difference in attack of one team and defense of the other\n",
    "diff_ratings['attack_home_defence_away_diff'] = results_ratings3['attack_x'] - results_ratings3['defence_y']\n",
    "diff_ratings['attack_away_defence_home_diff'] = results_ratings3['attack_y'] - results_ratings3['defence_x']\n",
    "\n",
    "# compile datframe\n",
    "train = pd.concat([ratings_base, diff_ratings, results_ratings2['index']], axis=1)\n",
    "train.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Now we do the same for rankings."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 48,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Now merge rankings\n",
    "results_rankings1 = results.merge(fifa_rankings, how='inner', \n",
    "                                left_on=['closest_ranking_date', 'home_team'],\n",
    "                                right_on=['rank_date', 'country_full'])\n",
    "\n",
    "results_rankings2 = results_rankings1.merge(fifa_rankings, how='inner', \n",
    "                                left_on=['closest_ranking_date', 'away_team'],\n",
    "                                right_on=['rank_date', 'country_full'])\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 49,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>rank_x</th>\n",
       "      <th>rank_y</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>64</td>\n",
       "      <td>86</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>86</td>\n",
       "      <td>47</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>95</td>\n",
       "      <td>47</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>24</td>\n",
       "      <td>47</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>91</td>\n",
       "      <td>109</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   rank_x  rank_y\n",
       "0      64      86\n",
       "1      86      47\n",
       "2      95      47\n",
       "3      24      47\n",
       "4      91     109"
      ]
     },
     "execution_count": 49,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# drop useless columns\n",
    "results_rankings3 = results_rankings2.drop(['home_team', 'away_team', 'tournament', \n",
    "                       'city', 'country', 'neutral', 'closest_rating_date', 'closest_ranking_date',\n",
    "                      'country_full_x', 'rank_date_y', 'country_full_y', 'date',\n",
    "                      'home_score', 'away_score', 'rank_date_x', 'confederation_x', \n",
    "                       'confederation_y', 'country_abrv_x', 'country_abrv_y', 'home_win', 'index'], axis=1)\n",
    "\n",
    "# reorder columns\n",
    "results_rankings3.sort_index(axis=1, inplace=True)\n",
    "results_rankings3[['rank_x', 'rank_y']].head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 50,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>cur_year_avg_weighted_diff</th>\n",
       "      <th>cur_year_avg_diff</th>\n",
       "      <th>last_year_avg_weighted_diff</th>\n",
       "      <th>last_year_avg_diff</th>\n",
       "      <th>previous_points_diff</th>\n",
       "      <th>rank_change_diff</th>\n",
       "      <th>rank_diff</th>\n",
       "      <th>three_year_ago_avg_diff</th>\n",
       "      <th>three_year_ago_weighted_diff</th>\n",
       "      <th>total_points_diff</th>\n",
       "      <th>two_year_ago_avg_diff</th>\n",
       "      <th>two_year_ago_weighted_diff</th>\n",
       "      <th>index</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>119.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>-22.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>31700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-288.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>39.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>31701</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-325.0</td>\n",
       "      <td>-1.0</td>\n",
       "      <td>48.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>31723</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>158.0</td>\n",
       "      <td>5.0</td>\n",
       "      <td>-23.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>31705</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>83.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>-18.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>31702</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   cur_year_avg_weighted_diff  cur_year_avg_diff  last_year_avg_weighted_diff  \\\n",
       "0                        -0.0               -0.0                         -0.0   \n",
       "1                        -0.0               -0.0                         -0.0   \n",
       "2                        -0.0               -0.0                         -0.0   \n",
       "3                        -0.0               -0.0                         -0.0   \n",
       "4                        -0.0               -0.0                         -0.0   \n",
       "\n",
       "   last_year_avg_diff  previous_points_diff  rank_change_diff  rank_diff  \\\n",
       "0                -0.0                 119.0               1.0      -22.0   \n",
       "1                -0.0                -288.0               1.0       39.0   \n",
       "2                -0.0                -325.0              -1.0       48.0   \n",
       "3                -0.0                 158.0               5.0      -23.0   \n",
       "4                -0.0                  83.0               1.0      -18.0   \n",
       "\n",
       "   three_year_ago_avg_diff  three_year_ago_weighted_diff  total_points_diff  \\\n",
       "0                     -0.0                          -0.0               -0.0   \n",
       "1                     -0.0                          -0.0               -0.0   \n",
       "2                     -0.0                          -0.0               -0.0   \n",
       "3                     -0.0                          -0.0               -0.0   \n",
       "4                     -0.0                          -0.0               -0.0   \n",
       "\n",
       "   two_year_ago_avg_diff  two_year_ago_weighted_diff  index  \n",
       "0                   -0.0                        -0.0  31700  \n",
       "1                   -0.0                        -0.0  31701  \n",
       "2                   -0.0                        -0.0  31723  \n",
       "3                   -0.0                        -0.0  31705  \n",
       "4                   -0.0                        -0.0  31702  "
      ]
     },
     "execution_count": 50,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Diff every column with column beforehand. \n",
    "diff_rankings = results_rankings3.diff(axis=1)\n",
    "ncol = diff_rankings.shape[1]\n",
    "\n",
    "# Since we diff every column with column beforehand, we only want every alternate column since those are the true diff\n",
    "diff_rankings = diff_rankings.iloc[:,list(np.arange(1,ncol, 2))]\n",
    "\n",
    "# we want our statistics to be from perspective of home team\n",
    "diff_rankings = diff_rankings*-1\n",
    "columns = [column[:-2] + \"_diff\" for column in diff_rankings.columns]\n",
    "\n",
    "diff_rankings.columns = columns\n",
    "diff_rankings['index'] = results_rankings2['index']\n",
    "\n",
    "diff_rankings.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 51,
   "metadata": {},
   "outputs": [],
   "source": [
    "train = train.merge(diff_rankings, left_on=['index'], right_on=['index'], how = 'inner').drop(['index'], axis = 1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 52,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>home_win</th>\n",
       "      <th>attack_diff</th>\n",
       "      <th>bup_dribbling_diff</th>\n",
       "      <th>bup_passing_diff</th>\n",
       "      <th>bup_speed_diff</th>\n",
       "      <th>cc_crossing_diff</th>\n",
       "      <th>cc_passing_diff</th>\n",
       "      <th>cc_shooting_diff</th>\n",
       "      <th>d_aggresion_diff</th>\n",
       "      <th>d_pressure_diff</th>\n",
       "      <th>...</th>\n",
       "      <th>last_year_avg_weighted_diff</th>\n",
       "      <th>last_year_avg_diff</th>\n",
       "      <th>previous_points_diff</th>\n",
       "      <th>rank_change_diff</th>\n",
       "      <th>rank_diff</th>\n",
       "      <th>three_year_ago_avg_diff</th>\n",
       "      <th>three_year_ago_weighted_diff</th>\n",
       "      <th>total_points_diff</th>\n",
       "      <th>two_year_ago_avg_diff</th>\n",
       "      <th>two_year_ago_weighted_diff</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>6.0</td>\n",
       "      <td>-52.0</td>\n",
       "      <td>-7.0</td>\n",
       "      <td>15.0</td>\n",
       "      <td>-17.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>27.0</td>\n",
       "      <td>18.0</td>\n",
       "      <td>...</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>358.0</td>\n",
       "      <td>-1.0</td>\n",
       "      <td>-38.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>13.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-25.0</td>\n",
       "      <td>-5.0</td>\n",
       "      <td>-15.0</td>\n",
       "      <td>-5.0</td>\n",
       "      <td>-5.0</td>\n",
       "      <td>-10.0</td>\n",
       "      <td>-5.0</td>\n",
       "      <td>...</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>531.0</td>\n",
       "      <td>-3.0</td>\n",
       "      <td>-62.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1</td>\n",
       "      <td>11.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-10.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-20.0</td>\n",
       "      <td>...</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>489.0</td>\n",
       "      <td>-2.0</td>\n",
       "      <td>-58.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2</td>\n",
       "      <td>23.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-40.0</td>\n",
       "      <td>-3.0</td>\n",
       "      <td>-10.0</td>\n",
       "      <td>-15.0</td>\n",
       "      <td>-30.0</td>\n",
       "      <td>-40.0</td>\n",
       "      <td>-40.0</td>\n",
       "      <td>...</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>771.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-73.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>1</td>\n",
       "      <td>10.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-5.0</td>\n",
       "      <td>-15.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-20.0</td>\n",
       "      <td>...</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>447.0</td>\n",
       "      <td>-2.0</td>\n",
       "      <td>-53.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 35 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   home_win  attack_diff  bup_dribbling_diff  bup_passing_diff  \\\n",
       "0         1          6.0               -52.0              -7.0   \n",
       "1         1         13.0                -0.0             -25.0   \n",
       "2         1         11.0                -0.0              -0.0   \n",
       "3         2         23.0                -0.0             -40.0   \n",
       "4         1         10.0                -0.0              -0.0   \n",
       "\n",
       "   bup_speed_diff  cc_crossing_diff  cc_passing_diff  cc_shooting_diff  \\\n",
       "0            15.0             -17.0             12.0               1.0   \n",
       "1            -5.0             -15.0             -5.0              -5.0   \n",
       "2            -0.0             -10.0             -0.0              -0.0   \n",
       "3            -3.0             -10.0            -15.0             -30.0   \n",
       "4            -0.0              -5.0            -15.0              -0.0   \n",
       "\n",
       "   d_aggresion_diff  d_pressure_diff             ...              \\\n",
       "0              27.0             18.0             ...               \n",
       "1             -10.0             -5.0             ...               \n",
       "2              -0.0            -20.0             ...               \n",
       "3             -40.0            -40.0             ...               \n",
       "4              -0.0            -20.0             ...               \n",
       "\n",
       "   last_year_avg_weighted_diff  last_year_avg_diff  previous_points_diff  \\\n",
       "0                         -0.0                -0.0                 358.0   \n",
       "1                         -0.0                -0.0                 531.0   \n",
       "2                         -0.0                -0.0                 489.0   \n",
       "3                         -0.0                -0.0                 771.0   \n",
       "4                         -0.0                -0.0                 447.0   \n",
       "\n",
       "   rank_change_diff  rank_diff  three_year_ago_avg_diff  \\\n",
       "0              -1.0      -38.0                     -0.0   \n",
       "1              -3.0      -62.0                     -0.0   \n",
       "2              -2.0      -58.0                     -0.0   \n",
       "3              -0.0      -73.0                     -0.0   \n",
       "4              -2.0      -53.0                     -0.0   \n",
       "\n",
       "   three_year_ago_weighted_diff  total_points_diff  two_year_ago_avg_diff  \\\n",
       "0                          -0.0               -0.0                   -0.0   \n",
       "1                          -0.0               -0.0                   -0.0   \n",
       "2                          -0.0               -0.0                   -0.0   \n",
       "3                          -0.0               -0.0                   -0.0   \n",
       "4                          -0.0               -0.0                   -0.0   \n",
       "\n",
       "   two_year_ago_weighted_diff  \n",
       "0                        -0.0  \n",
       "1                        -0.0  \n",
       "2                        -0.0  \n",
       "3                        -0.0  \n",
       "4                        -0.0  \n",
       "\n",
       "[5 rows x 35 columns]"
      ]
     },
     "execution_count": 52,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "train.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 53,
   "metadata": {},
   "outputs": [],
   "source": [
    "# save to csv\n",
    "train.to_csv('data/train_team.csv', index = False)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "We now create our test set with actual world cup data."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 54,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>team</th>\n",
       "      <th>date</th>\n",
       "      <th>attack</th>\n",
       "      <th>defence</th>\n",
       "      <th>full_age</th>\n",
       "      <th>midfield</th>\n",
       "      <th>overall</th>\n",
       "      <th>prestige</th>\n",
       "      <th>start_age</th>\n",
       "      <th>bup_speed</th>\n",
       "      <th>...</th>\n",
       "      <th>cc_passing</th>\n",
       "      <th>cc_crossing</th>\n",
       "      <th>cc_shooting</th>\n",
       "      <th>d_pressure</th>\n",
       "      <th>d_aggresion</th>\n",
       "      <th>d_width</th>\n",
       "      <th>wage_euros_thousands</th>\n",
       "      <th>value_euros_millions</th>\n",
       "      <th>growth</th>\n",
       "      <th>goalkeeeper_overall</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Brazil</td>\n",
       "      <td>2018-07-15 00:00:00+00:00</td>\n",
       "      <td>87.0</td>\n",
       "      <td>84.0</td>\n",
       "      <td>27.43</td>\n",
       "      <td>86.0</td>\n",
       "      <td>86.0</td>\n",
       "      <td>10.0</td>\n",
       "      <td>27.55</td>\n",
       "      <td>51.0</td>\n",
       "      <td>...</td>\n",
       "      <td>39.0</td>\n",
       "      <td>33.0</td>\n",
       "      <td>67.0</td>\n",
       "      <td>76.0</td>\n",
       "      <td>73.0</td>\n",
       "      <td>63.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.62500</td>\n",
       "      <td>84.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>England</td>\n",
       "      <td>2018-07-15 00:00:00+00:00</td>\n",
       "      <td>83.0</td>\n",
       "      <td>80.0</td>\n",
       "      <td>25.88</td>\n",
       "      <td>81.0</td>\n",
       "      <td>81.0</td>\n",
       "      <td>8.0</td>\n",
       "      <td>24.64</td>\n",
       "      <td>36.0</td>\n",
       "      <td>...</td>\n",
       "      <td>31.0</td>\n",
       "      <td>41.0</td>\n",
       "      <td>41.0</td>\n",
       "      <td>43.0</td>\n",
       "      <td>55.0</td>\n",
       "      <td>49.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2.57500</td>\n",
       "      <td>80.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Italy</td>\n",
       "      <td>2018-07-15 00:00:00+00:00</td>\n",
       "      <td>81.0</td>\n",
       "      <td>82.0</td>\n",
       "      <td>25.96</td>\n",
       "      <td>81.0</td>\n",
       "      <td>82.0</td>\n",
       "      <td>9.0</td>\n",
       "      <td>27.36</td>\n",
       "      <td>73.0</td>\n",
       "      <td>...</td>\n",
       "      <td>64.0</td>\n",
       "      <td>80.0</td>\n",
       "      <td>78.0</td>\n",
       "      <td>29.0</td>\n",
       "      <td>26.0</td>\n",
       "      <td>32.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>3.26087</td>\n",
       "      <td>88.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>Spain</td>\n",
       "      <td>2018-07-15 00:00:00+00:00</td>\n",
       "      <td>84.0</td>\n",
       "      <td>85.0</td>\n",
       "      <td>27.18</td>\n",
       "      <td>86.0</td>\n",
       "      <td>85.0</td>\n",
       "      <td>9.0</td>\n",
       "      <td>27.27</td>\n",
       "      <td>32.0</td>\n",
       "      <td>...</td>\n",
       "      <td>27.0</td>\n",
       "      <td>32.0</td>\n",
       "      <td>20.0</td>\n",
       "      <td>75.0</td>\n",
       "      <td>62.0</td>\n",
       "      <td>52.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.77500</td>\n",
       "      <td>91.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>France</td>\n",
       "      <td>2018-07-15 00:00:00+00:00</td>\n",
       "      <td>86.0</td>\n",
       "      <td>81.0</td>\n",
       "      <td>25.05</td>\n",
       "      <td>84.0</td>\n",
       "      <td>85.0</td>\n",
       "      <td>9.0</td>\n",
       "      <td>24.82</td>\n",
       "      <td>35.0</td>\n",
       "      <td>...</td>\n",
       "      <td>24.0</td>\n",
       "      <td>53.0</td>\n",
       "      <td>35.0</td>\n",
       "      <td>47.0</td>\n",
       "      <td>47.0</td>\n",
       "      <td>67.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>3.45000</td>\n",
       "      <td>87.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 22 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "      team                      date  attack  defence  full_age  midfield  \\\n",
       "0   Brazil 2018-07-15 00:00:00+00:00    87.0     84.0     27.43      86.0   \n",
       "1  England 2018-07-15 00:00:00+00:00    83.0     80.0     25.88      81.0   \n",
       "2    Italy 2018-07-15 00:00:00+00:00    81.0     82.0     25.96      81.0   \n",
       "3    Spain 2018-07-15 00:00:00+00:00    84.0     85.0     27.18      86.0   \n",
       "4   France 2018-07-15 00:00:00+00:00    86.0     81.0     25.05      84.0   \n",
       "\n",
       "   overall  prestige  start_age  bup_speed         ...           cc_passing  \\\n",
       "0     86.0      10.0      27.55       51.0         ...                 39.0   \n",
       "1     81.0       8.0      24.64       36.0         ...                 31.0   \n",
       "2     82.0       9.0      27.36       73.0         ...                 64.0   \n",
       "3     85.0       9.0      27.27       32.0         ...                 27.0   \n",
       "4     85.0       9.0      24.82       35.0         ...                 24.0   \n",
       "\n",
       "   cc_crossing  cc_shooting  d_pressure  d_aggresion  d_width  \\\n",
       "0         33.0         67.0        76.0         73.0     63.0   \n",
       "1         41.0         41.0        43.0         55.0     49.0   \n",
       "2         80.0         78.0        29.0         26.0     32.0   \n",
       "3         32.0         20.0        75.0         62.0     52.0   \n",
       "4         53.0         35.0        47.0         47.0     67.0   \n",
       "\n",
       "   wage_euros_thousands  value_euros_millions   growth  goalkeeeper_overall  \n",
       "0                   0.0                   0.0  1.62500                 84.0  \n",
       "1                   0.0                   0.0  2.57500                 80.0  \n",
       "2                   0.0                   0.0  3.26087                 88.0  \n",
       "3                   0.0                   0.0  1.77500                 91.0  \n",
       "4                   0.0                   0.0  3.45000                 87.0  \n",
       "\n",
       "[5 rows x 22 columns]"
      ]
     },
     "execution_count": 54,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ratings_wc = pd.read_csv('data/team_stats_final.csv')\n",
    "ratings_wc['date'] = pd.to_datetime(ratings_wc['date'], utc=True)\n",
    "\n",
    "# restrict dates\n",
    "latest_date = '2018-06-14'\n",
    "wc_start = '2018-06-16' # first WC rating\n",
    "wc_end = '2018-07-15'\n",
    "# restrict dates\n",
    "ratings_wc = ratings_wc[(ratings_wc['date'] >= wc_start) & (ratings_wc['date'] <= wc_end)]\n",
    "\n",
    "ratings_wc.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 55,
   "metadata": {},
   "outputs": [],
   "source": [
    "ratings_teams_wc = ratings_wc.team.unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 56,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Game</th>\n",
       "      <th>Group</th>\n",
       "      <th>Team</th>\n",
       "      <th>Opponent</th>\n",
       "      <th>Home/Away</th>\n",
       "      <th>Score</th>\n",
       "      <th>WDL</th>\n",
       "      <th>Pens?</th>\n",
       "      <th>Goals For</th>\n",
       "      <th>Goals Against</th>\n",
       "      <th>...</th>\n",
       "      <th>Passes Completed</th>\n",
       "      <th>Distance Covered km</th>\n",
       "      <th>Balls recovered</th>\n",
       "      <th>Tackles</th>\n",
       "      <th>Blocks</th>\n",
       "      <th>Clearances</th>\n",
       "      <th>Yellow cards</th>\n",
       "      <th>Red Cards</th>\n",
       "      <th>Second Yellow Card leading to Red Card</th>\n",
       "      <th>Fouls Committed</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>A</td>\n",
       "      <td>Russia</td>\n",
       "      <td>Saudi Arabia</td>\n",
       "      <td>home</td>\n",
       "      <td>5-0</td>\n",
       "      <td>W</td>\n",
       "      <td>NaN</td>\n",
       "      <td>5</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>240</td>\n",
       "      <td>118</td>\n",
       "      <td>53</td>\n",
       "      <td>9</td>\n",
       "      <td>3</td>\n",
       "      <td>19</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>22</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>A</td>\n",
       "      <td>Saudi Arabia</td>\n",
       "      <td>Russia</td>\n",
       "      <td>away</td>\n",
       "      <td>5-0</td>\n",
       "      <td>L</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0</td>\n",
       "      <td>5</td>\n",
       "      <td>...</td>\n",
       "      <td>442</td>\n",
       "      <td>105</td>\n",
       "      <td>48</td>\n",
       "      <td>16</td>\n",
       "      <td>3</td>\n",
       "      <td>31</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>10</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2</td>\n",
       "      <td>A</td>\n",
       "      <td>Egypt</td>\n",
       "      <td>Uruguay</td>\n",
       "      <td>home</td>\n",
       "      <td>0-1</td>\n",
       "      <td>L</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>...</td>\n",
       "      <td>308</td>\n",
       "      <td>112</td>\n",
       "      <td>57</td>\n",
       "      <td>12</td>\n",
       "      <td>4</td>\n",
       "      <td>32</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>12</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2</td>\n",
       "      <td>A</td>\n",
       "      <td>Uruguay</td>\n",
       "      <td>Egypt</td>\n",
       "      <td>away</td>\n",
       "      <td>0-1</td>\n",
       "      <td>W</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>508</td>\n",
       "      <td>111</td>\n",
       "      <td>54</td>\n",
       "      <td>8</td>\n",
       "      <td>2</td>\n",
       "      <td>22</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>6</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>3</td>\n",
       "      <td>B</td>\n",
       "      <td>Morocco</td>\n",
       "      <td>IR Iran</td>\n",
       "      <td>home</td>\n",
       "      <td>0-1</td>\n",
       "      <td>L</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>...</td>\n",
       "      <td>371</td>\n",
       "      <td>101</td>\n",
       "      <td>38</td>\n",
       "      <td>9</td>\n",
       "      <td>1</td>\n",
       "      <td>16</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>22</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 32 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   Game Group          Team      Opponent Home/Away Score WDL Pens?  \\\n",
       "0     1     A        Russia  Saudi Arabia      home   5-0   W   NaN   \n",
       "1     1     A  Saudi Arabia        Russia      away   5-0   L   NaN   \n",
       "2     2     A         Egypt       Uruguay      home   0-1   L   NaN   \n",
       "3     2     A       Uruguay         Egypt      away   0-1   W   NaN   \n",
       "4     3     B       Morocco       IR Iran      home   0-1   L   NaN   \n",
       "\n",
       "   Goals For  Goals Against       ...         Passes Completed  \\\n",
       "0          5              0       ...                      240   \n",
       "1          0              5       ...                      442   \n",
       "2          0              1       ...                      308   \n",
       "3          1              0       ...                      508   \n",
       "4          0              1       ...                      371   \n",
       "\n",
       "   Distance Covered km  Balls recovered  Tackles  Blocks  Clearances  \\\n",
       "0                  118               53        9       3          19   \n",
       "1                  105               48       16       3          31   \n",
       "2                  112               57       12       4          32   \n",
       "3                  111               54        8       2          22   \n",
       "4                  101               38        9       1          16   \n",
       "\n",
       "   Yellow cards  Red Cards  Second Yellow Card leading to Red Card  \\\n",
       "0             1          0                                       0   \n",
       "1             1          0                                       0   \n",
       "2             2          0                                       0   \n",
       "3             0          0                                       0   \n",
       "4             1          0                                       0   \n",
       "\n",
       "   Fouls Committed  \n",
       "0               22  \n",
       "1               10  \n",
       "2               12  \n",
       "3                6  \n",
       "4               22  \n",
       "\n",
       "[5 rows x 32 columns]"
      ]
     },
     "execution_count": 56,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#https://gitlab.com/djh_or/2018-world-cup-stats/blob/master/world_cup_2018_stats.csv\n",
    "results_wc = pd.read_csv(\"data/world_cup_2018_stats.csv\")\n",
    "results_wc.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Before we proceed, let's ensure that our country names match up similarly."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 57,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Cannot Find in Ratings IR Iran\n",
      "Cannot Find in Rankings IR Iran\n"
     ]
    }
   ],
   "source": [
    "# check that we found the corresponding team from team ratings in results\n",
    "# but now we reverse it such that we try to find a rating and ranking for each wc team\n",
    "for t in results_wc.Team.unique():\n",
    "    try:\n",
    "        assert np.sum(ratings_teams_wc == t) == 1\n",
    "    except:\n",
    "        print('Cannot Find in Ratings {}'.format(t))\n",
    "        \n",
    "for t in results_wc.Team.unique():\n",
    "    try:\n",
    "        assert np.sum(fifa_rankings.country_full.unique() == t) == 1\n",
    "    except:\n",
    "        print('Cannot Find in Rankings {}'.format(t))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 58,
   "metadata": {},
   "outputs": [],
   "source": [
    "results_wc.replace('IR Iran', 'Iran', inplace=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 59,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Team</th>\n",
       "      <th>Opponent</th>\n",
       "      <th>home_win</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>123</th>\n",
       "      <td>England</td>\n",
       "      <td>Croatia</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>124</th>\n",
       "      <td>Belgium</td>\n",
       "      <td>England</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>125</th>\n",
       "      <td>England</td>\n",
       "      <td>Belgium</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>126</th>\n",
       "      <td>France</td>\n",
       "      <td>Croatia</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>127</th>\n",
       "      <td>Croatia</td>\n",
       "      <td>France</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        Team Opponent  home_win\n",
       "123  England  Croatia         0\n",
       "124  Belgium  England         1\n",
       "125  England  Belgium         0\n",
       "126   France  Croatia         1\n",
       "127  Croatia   France         0"
      ]
     },
     "execution_count": 59,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "tournament_round = results_wc.Group\n",
    "results_wc = results_wc.loc[:,['Team', 'Opponent', 'WDL']]\n",
    "results_wc['home_win'] = [0 if score == 'L' else 1 if score == 'W' else 2 for score in results_wc.WDL]\n",
    "results_wc.drop('WDL', axis=1, inplace=True)\n",
    "results_wc.tail()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Now we can match the ratings and rankings data to our test dataset as well. We note that there might be some value in using the updated FIFA ratings and rankings at each time of the match. However, for simplicity, let's just assume that teams have the same rating and rankings throughout the tournament. We will take the rating and rankings at the start of the tournament."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 60,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "Index(['Team', 'Opponent', 'home_win', 'rank_x', 'country_full_x',\n",
       "       'country_abrv_x', 'total_points_x', 'previous_points_x',\n",
       "       'rank_change_x', 'cur_year_avg_x', 'cur_year_avg_weighted_x',\n",
       "       'last_year_avg_x', 'last_year_avg_weighted_x', 'two_year_ago_avg_x',\n",
       "       'two_year_ago_weighted_x', 'three_year_ago_avg_x',\n",
       "       'three_year_ago_weighted_x', 'confederation_x', 'rank_date_x', 'rank_y',\n",
       "       'country_full_y', 'country_abrv_y', 'total_points_y',\n",
       "       'previous_points_y', 'rank_change_y', 'cur_year_avg_y',\n",
       "       'cur_year_avg_weighted_y', 'last_year_avg_y',\n",
       "       'last_year_avg_weighted_y', 'two_year_ago_avg_y',\n",
       "       'two_year_ago_weighted_y', 'three_year_ago_avg_y',\n",
       "       'three_year_ago_weighted_y', 'confederation_y', 'rank_date_y'],\n",
       "      dtype='object')"
      ]
     },
     "execution_count": 60,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "rankings_wc = fifa_rankings[fifa_rankings.rank_date == \\\n",
    "                            get_latest_date(pd.to_datetime(wc_start), fifa_rankings.rank_date)]\n",
    "results_rankings_wc1 = results_wc.merge(rankings_wc, how = 'left', left_on = 'Team', right_on = 'country_full')\n",
    "results_rankings_wc2 = results_rankings_wc1.merge(rankings_wc, how = 'left', left_on = 'Opponent',\n",
    "                                                  right_on = 'country_full')\n",
    "results_rankings_wc2.columns"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 61,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>cur_year_avg_weighted_x</th>\n",
       "      <th>cur_year_avg_weighted_y</th>\n",
       "      <th>cur_year_avg_x</th>\n",
       "      <th>cur_year_avg_y</th>\n",
       "      <th>home_win</th>\n",
       "      <th>last_year_avg_weighted_x</th>\n",
       "      <th>last_year_avg_weighted_y</th>\n",
       "      <th>last_year_avg_x</th>\n",
       "      <th>last_year_avg_y</th>\n",
       "      <th>previous_points_x</th>\n",
       "      <th>...</th>\n",
       "      <th>three_year_ago_avg_x</th>\n",
       "      <th>three_year_ago_avg_y</th>\n",
       "      <th>three_year_ago_weighted_x</th>\n",
       "      <th>three_year_ago_weighted_y</th>\n",
       "      <th>total_points_x</th>\n",
       "      <th>total_points_y</th>\n",
       "      <th>two_year_ago_avg_x</th>\n",
       "      <th>two_year_ago_avg_y</th>\n",
       "      <th>two_year_ago_weighted_x</th>\n",
       "      <th>two_year_ago_weighted_y</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>166.07</td>\n",
       "      <td>143.89</td>\n",
       "      <td>166.07</td>\n",
       "      <td>143.89</td>\n",
       "      <td>1</td>\n",
       "      <td>108.09</td>\n",
       "      <td>180.10</td>\n",
       "      <td>216.18</td>\n",
       "      <td>360.20</td>\n",
       "      <td>493</td>\n",
       "      <td>...</td>\n",
       "      <td>368.50</td>\n",
       "      <td>135.09</td>\n",
       "      <td>73.70</td>\n",
       "      <td>27.02</td>\n",
       "      <td>456.53</td>\n",
       "      <td>465.28</td>\n",
       "      <td>362.25</td>\n",
       "      <td>380.91</td>\n",
       "      <td>108.68</td>\n",
       "      <td>114.27</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>143.89</td>\n",
       "      <td>166.07</td>\n",
       "      <td>143.89</td>\n",
       "      <td>166.07</td>\n",
       "      <td>0</td>\n",
       "      <td>180.10</td>\n",
       "      <td>108.09</td>\n",
       "      <td>360.20</td>\n",
       "      <td>216.18</td>\n",
       "      <td>462</td>\n",
       "      <td>...</td>\n",
       "      <td>135.09</td>\n",
       "      <td>368.50</td>\n",
       "      <td>27.02</td>\n",
       "      <td>73.70</td>\n",
       "      <td>465.28</td>\n",
       "      <td>456.53</td>\n",
       "      <td>380.91</td>\n",
       "      <td>362.25</td>\n",
       "      <td>114.27</td>\n",
       "      <td>108.68</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>208.27</td>\n",
       "      <td>486.28</td>\n",
       "      <td>208.27</td>\n",
       "      <td>486.28</td>\n",
       "      <td>0</td>\n",
       "      <td>291.04</td>\n",
       "      <td>243.84</td>\n",
       "      <td>582.07</td>\n",
       "      <td>487.69</td>\n",
       "      <td>636</td>\n",
       "      <td>...</td>\n",
       "      <td>253.18</td>\n",
       "      <td>599.26</td>\n",
       "      <td>50.64</td>\n",
       "      <td>119.85</td>\n",
       "      <td>649.43</td>\n",
       "      <td>1018.41</td>\n",
       "      <td>331.62</td>\n",
       "      <td>561.47</td>\n",
       "      <td>99.48</td>\n",
       "      <td>168.44</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>486.28</td>\n",
       "      <td>208.27</td>\n",
       "      <td>486.28</td>\n",
       "      <td>208.27</td>\n",
       "      <td>1</td>\n",
       "      <td>243.84</td>\n",
       "      <td>291.04</td>\n",
       "      <td>487.69</td>\n",
       "      <td>582.07</td>\n",
       "      <td>976</td>\n",
       "      <td>...</td>\n",
       "      <td>599.26</td>\n",
       "      <td>253.18</td>\n",
       "      <td>119.85</td>\n",
       "      <td>50.64</td>\n",
       "      <td>1018.41</td>\n",
       "      <td>649.43</td>\n",
       "      <td>561.47</td>\n",
       "      <td>331.62</td>\n",
       "      <td>168.44</td>\n",
       "      <td>99.48</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>369.10</td>\n",
       "      <td>290.29</td>\n",
       "      <td>369.10</td>\n",
       "      <td>290.29</td>\n",
       "      <td>0</td>\n",
       "      <td>172.65</td>\n",
       "      <td>246.02</td>\n",
       "      <td>345.29</td>\n",
       "      <td>492.04</td>\n",
       "      <td>681</td>\n",
       "      <td>...</td>\n",
       "      <td>170.43</td>\n",
       "      <td>398.22</td>\n",
       "      <td>34.09</td>\n",
       "      <td>79.64</td>\n",
       "      <td>685.86</td>\n",
       "      <td>708.35</td>\n",
       "      <td>366.78</td>\n",
       "      <td>308.01</td>\n",
       "      <td>110.03</td>\n",
       "      <td>92.40</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 25 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   cur_year_avg_weighted_x  cur_year_avg_weighted_y  cur_year_avg_x  \\\n",
       "0                   166.07                   143.89          166.07   \n",
       "1                   143.89                   166.07          143.89   \n",
       "2                   208.27                   486.28          208.27   \n",
       "3                   486.28                   208.27          486.28   \n",
       "4                   369.10                   290.29          369.10   \n",
       "\n",
       "   cur_year_avg_y  home_win  last_year_avg_weighted_x  \\\n",
       "0          143.89         1                    108.09   \n",
       "1          166.07         0                    180.10   \n",
       "2          486.28         0                    291.04   \n",
       "3          208.27         1                    243.84   \n",
       "4          290.29         0                    172.65   \n",
       "\n",
       "   last_year_avg_weighted_y  last_year_avg_x  last_year_avg_y  \\\n",
       "0                    180.10           216.18           360.20   \n",
       "1                    108.09           360.20           216.18   \n",
       "2                    243.84           582.07           487.69   \n",
       "3                    291.04           487.69           582.07   \n",
       "4                    246.02           345.29           492.04   \n",
       "\n",
       "   previous_points_x           ...             three_year_ago_avg_x  \\\n",
       "0                493           ...                           368.50   \n",
       "1                462           ...                           135.09   \n",
       "2                636           ...                           253.18   \n",
       "3                976           ...                           599.26   \n",
       "4                681           ...                           170.43   \n",
       "\n",
       "   three_year_ago_avg_y  three_year_ago_weighted_x  three_year_ago_weighted_y  \\\n",
       "0                135.09                      73.70                      27.02   \n",
       "1                368.50                      27.02                      73.70   \n",
       "2                599.26                      50.64                     119.85   \n",
       "3                253.18                     119.85                      50.64   \n",
       "4                398.22                      34.09                      79.64   \n",
       "\n",
       "   total_points_x  total_points_y  two_year_ago_avg_x  two_year_ago_avg_y  \\\n",
       "0          456.53          465.28              362.25              380.91   \n",
       "1          465.28          456.53              380.91              362.25   \n",
       "2          649.43         1018.41              331.62              561.47   \n",
       "3         1018.41          649.43              561.47              331.62   \n",
       "4          685.86          708.35              366.78              308.01   \n",
       "\n",
       "   two_year_ago_weighted_x  two_year_ago_weighted_y  \n",
       "0                   108.68                   114.27  \n",
       "1                   114.27                   108.68  \n",
       "2                    99.48                   168.44  \n",
       "3                   168.44                    99.48  \n",
       "4                   110.03                    92.40  \n",
       "\n",
       "[5 rows x 25 columns]"
      ]
     },
     "execution_count": 61,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# drop useless columns\n",
    "results_rankings_wc3 = results_rankings_wc2.drop(['Team', 'Opponent','country_full_x', 'rank_date_y', 'country_full_y', \n",
    "                      'rank_date_x', 'confederation_x', 'confederation_y', 'country_abrv_x', 'country_abrv_y'], axis=1)\n",
    "\n",
    "# reorder columns\n",
    "results_rankings_wc3.sort_index(axis=1, inplace=True)\n",
    "results_rankings_wc3.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 62,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>cur_year_avg_weighted_diff</th>\n",
       "      <th>cur_year_avg_diff</th>\n",
       "      <th>last_year_avg_weighted_diff</th>\n",
       "      <th>last_year_avg_diff</th>\n",
       "      <th>previous_points_diff</th>\n",
       "      <th>rank_change_diff</th>\n",
       "      <th>rank_diff</th>\n",
       "      <th>three_year_ago_avg_diff</th>\n",
       "      <th>three_year_ago_weighted_diff</th>\n",
       "      <th>total_points_diff</th>\n",
       "      <th>two_year_ago_avg_diff</th>\n",
       "      <th>two_year_ago_weighted_diff</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>22.18</td>\n",
       "      <td>22.18</td>\n",
       "      <td>-72.01</td>\n",
       "      <td>-144.02</td>\n",
       "      <td>31.0</td>\n",
       "      <td>-4.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>233.41</td>\n",
       "      <td>46.68</td>\n",
       "      <td>-8.75</td>\n",
       "      <td>-18.66</td>\n",
       "      <td>-5.59</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>-22.18</td>\n",
       "      <td>-22.18</td>\n",
       "      <td>72.01</td>\n",
       "      <td>144.02</td>\n",
       "      <td>-31.0</td>\n",
       "      <td>4.0</td>\n",
       "      <td>-3.0</td>\n",
       "      <td>-233.41</td>\n",
       "      <td>-46.68</td>\n",
       "      <td>8.75</td>\n",
       "      <td>18.66</td>\n",
       "      <td>5.59</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>-278.01</td>\n",
       "      <td>-278.01</td>\n",
       "      <td>47.20</td>\n",
       "      <td>94.38</td>\n",
       "      <td>-340.0</td>\n",
       "      <td>-2.0</td>\n",
       "      <td>31.0</td>\n",
       "      <td>-346.08</td>\n",
       "      <td>-69.21</td>\n",
       "      <td>-368.98</td>\n",
       "      <td>-229.85</td>\n",
       "      <td>-68.96</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>278.01</td>\n",
       "      <td>278.01</td>\n",
       "      <td>-47.20</td>\n",
       "      <td>-94.38</td>\n",
       "      <td>340.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>-31.0</td>\n",
       "      <td>346.08</td>\n",
       "      <td>69.21</td>\n",
       "      <td>368.98</td>\n",
       "      <td>229.85</td>\n",
       "      <td>68.96</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>78.81</td>\n",
       "      <td>78.81</td>\n",
       "      <td>-73.37</td>\n",
       "      <td>-146.75</td>\n",
       "      <td>-46.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>4.0</td>\n",
       "      <td>-227.79</td>\n",
       "      <td>-45.55</td>\n",
       "      <td>-22.49</td>\n",
       "      <td>58.77</td>\n",
       "      <td>17.63</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   cur_year_avg_weighted_diff  cur_year_avg_diff  last_year_avg_weighted_diff  \\\n",
       "0                       22.18              22.18                       -72.01   \n",
       "1                      -22.18             -22.18                        72.01   \n",
       "2                     -278.01            -278.01                        47.20   \n",
       "3                      278.01             278.01                       -47.20   \n",
       "4                       78.81              78.81                       -73.37   \n",
       "\n",
       "   last_year_avg_diff  previous_points_diff  rank_change_diff  rank_diff  \\\n",
       "0             -144.02                  31.0              -4.0        3.0   \n",
       "1              144.02                 -31.0               4.0       -3.0   \n",
       "2               94.38                -340.0              -2.0       31.0   \n",
       "3              -94.38                 340.0               2.0      -31.0   \n",
       "4             -146.75                 -46.0               2.0        4.0   \n",
       "\n",
       "   three_year_ago_avg_diff  three_year_ago_weighted_diff  total_points_diff  \\\n",
       "0                   233.41                         46.68              -8.75   \n",
       "1                  -233.41                        -46.68               8.75   \n",
       "2                  -346.08                        -69.21            -368.98   \n",
       "3                   346.08                         69.21             368.98   \n",
       "4                  -227.79                        -45.55             -22.49   \n",
       "\n",
       "   two_year_ago_avg_diff  two_year_ago_weighted_diff  \n",
       "0                 -18.66                       -5.59  \n",
       "1                  18.66                        5.59  \n",
       "2                -229.85                      -68.96  \n",
       "3                 229.85                       68.96  \n",
       "4                  58.77                       17.63  "
      ]
     },
     "execution_count": 62,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "diff_rankings_wc = results_rankings_wc3.drop('home_win', axis=1)\n",
    "diff_rankings_wc = diff_rankings_wc.diff(axis=1)\n",
    "ncol_wc = diff_rankings_wc.shape[1]\n",
    "\n",
    "# we only want every alternate column\n",
    "diff_rankings_wc = diff_rankings_wc.iloc[:,list(np.arange(1,ncol_wc, 2))]\n",
    "\n",
    "# we want our statistics to be from perspective of home teams\n",
    "diff_rankings_wc = diff_rankings_wc*-1\n",
    "\n",
    "diff_rankings_wc.columns = [column[:-2] + '_diff' for column in diff_rankings_wc.columns]\n",
    "diff_rankings_wc.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 63,
   "metadata": {},
   "outputs": [],
   "source": [
    "ratings_wc_start = ratings_wc[ratings_wc['date'] == wc_start]\n",
    "\n",
    "# merge ratings with results table\n",
    "results_ratings_wc1 = results_wc.merge(ratings_wc_start, how='left',\n",
    "                                     left_on='Team', right_on='team')\n",
    "results_ratings_wc2 = results_ratings_wc1.merge(ratings_wc_start, how='left',\n",
    "                                             left_on='Opponent', right_on='team')\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 64,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>attack_x</th>\n",
       "      <th>attack_y</th>\n",
       "      <th>bup_dribbling_x</th>\n",
       "      <th>bup_dribbling_y</th>\n",
       "      <th>bup_passing_x</th>\n",
       "      <th>bup_passing_y</th>\n",
       "      <th>bup_speed_x</th>\n",
       "      <th>bup_speed_y</th>\n",
       "      <th>cc_crossing_x</th>\n",
       "      <th>cc_crossing_y</th>\n",
       "      <th>...</th>\n",
       "      <th>overall_x</th>\n",
       "      <th>overall_y</th>\n",
       "      <th>prestige_x</th>\n",
       "      <th>prestige_y</th>\n",
       "      <th>start_age_x</th>\n",
       "      <th>start_age_y</th>\n",
       "      <th>value_euros_millions_x</th>\n",
       "      <th>value_euros_millions_y</th>\n",
       "      <th>wage_euros_thousands_x</th>\n",
       "      <th>wage_euros_thousands_y</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>80.0</td>\n",
       "      <td>71.0</td>\n",
       "      <td>77.0</td>\n",
       "      <td>68.0</td>\n",
       "      <td>49.0</td>\n",
       "      <td>66.0</td>\n",
       "      <td>50.0</td>\n",
       "      <td>69.0</td>\n",
       "      <td>37.0</td>\n",
       "      <td>48.0</td>\n",
       "      <td>...</td>\n",
       "      <td>79.0</td>\n",
       "      <td>72.0</td>\n",
       "      <td>6.0</td>\n",
       "      <td>4.0</td>\n",
       "      <td>27.82</td>\n",
       "      <td>28.00</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>71.0</td>\n",
       "      <td>80.0</td>\n",
       "      <td>68.0</td>\n",
       "      <td>77.0</td>\n",
       "      <td>66.0</td>\n",
       "      <td>49.0</td>\n",
       "      <td>69.0</td>\n",
       "      <td>50.0</td>\n",
       "      <td>48.0</td>\n",
       "      <td>37.0</td>\n",
       "      <td>...</td>\n",
       "      <td>72.0</td>\n",
       "      <td>79.0</td>\n",
       "      <td>4.0</td>\n",
       "      <td>6.0</td>\n",
       "      <td>28.00</td>\n",
       "      <td>27.82</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>72.0</td>\n",
       "      <td>86.0</td>\n",
       "      <td>34.0</td>\n",
       "      <td>42.0</td>\n",
       "      <td>49.0</td>\n",
       "      <td>36.0</td>\n",
       "      <td>52.0</td>\n",
       "      <td>38.0</td>\n",
       "      <td>64.0</td>\n",
       "      <td>43.0</td>\n",
       "      <td>...</td>\n",
       "      <td>76.0</td>\n",
       "      <td>80.0</td>\n",
       "      <td>5.0</td>\n",
       "      <td>7.0</td>\n",
       "      <td>27.64</td>\n",
       "      <td>26.09</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>86.0</td>\n",
       "      <td>72.0</td>\n",
       "      <td>42.0</td>\n",
       "      <td>34.0</td>\n",
       "      <td>36.0</td>\n",
       "      <td>49.0</td>\n",
       "      <td>38.0</td>\n",
       "      <td>52.0</td>\n",
       "      <td>43.0</td>\n",
       "      <td>64.0</td>\n",
       "      <td>...</td>\n",
       "      <td>80.0</td>\n",
       "      <td>76.0</td>\n",
       "      <td>7.0</td>\n",
       "      <td>5.0</td>\n",
       "      <td>26.09</td>\n",
       "      <td>27.64</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>72.0</td>\n",
       "      <td>79.0</td>\n",
       "      <td>52.0</td>\n",
       "      <td>67.0</td>\n",
       "      <td>38.0</td>\n",
       "      <td>69.0</td>\n",
       "      <td>38.0</td>\n",
       "      <td>69.0</td>\n",
       "      <td>58.0</td>\n",
       "      <td>37.0</td>\n",
       "      <td>...</td>\n",
       "      <td>76.0</td>\n",
       "      <td>74.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>26.55</td>\n",
       "      <td>26.27</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 41 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   attack_x  attack_y  bup_dribbling_x  bup_dribbling_y  bup_passing_x  \\\n",
       "0      80.0      71.0             77.0             68.0           49.0   \n",
       "1      71.0      80.0             68.0             77.0           66.0   \n",
       "2      72.0      86.0             34.0             42.0           49.0   \n",
       "3      86.0      72.0             42.0             34.0           36.0   \n",
       "4      72.0      79.0             52.0             67.0           38.0   \n",
       "\n",
       "   bup_passing_y  bup_speed_x  bup_speed_y  cc_crossing_x  cc_crossing_y  \\\n",
       "0           66.0         50.0         69.0           37.0           48.0   \n",
       "1           49.0         69.0         50.0           48.0           37.0   \n",
       "2           36.0         52.0         38.0           64.0           43.0   \n",
       "3           49.0         38.0         52.0           43.0           64.0   \n",
       "4           69.0         38.0         69.0           58.0           37.0   \n",
       "\n",
       "            ...            overall_x  overall_y  prestige_x  prestige_y  \\\n",
       "0           ...                 79.0       72.0         6.0         4.0   \n",
       "1           ...                 72.0       79.0         4.0         6.0   \n",
       "2           ...                 76.0       80.0         5.0         7.0   \n",
       "3           ...                 80.0       76.0         7.0         5.0   \n",
       "4           ...                 76.0       74.0         3.0         3.0   \n",
       "\n",
       "   start_age_x  start_age_y  value_euros_millions_x  value_euros_millions_y  \\\n",
       "0        27.82        28.00                     0.0                     0.0   \n",
       "1        28.00        27.82                     0.0                     0.0   \n",
       "2        27.64        26.09                     0.0                     0.0   \n",
       "3        26.09        27.64                     0.0                     0.0   \n",
       "4        26.55        26.27                     0.0                     0.0   \n",
       "\n",
       "   wage_euros_thousands_x  wage_euros_thousands_y  \n",
       "0                     0.0                     0.0  \n",
       "1                     0.0                     0.0  \n",
       "2                     0.0                     0.0  \n",
       "3                     0.0                     0.0  \n",
       "4                     0.0                     0.0  \n",
       "\n",
       "[5 rows x 41 columns]"
      ]
     },
     "execution_count": 64,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# drop useless columns\n",
    "results_ratings_wc3 = results_ratings_wc2.drop(['Team', 'Opponent', 'team_x', 'team_y', 'date_y', 'date_x'], \n",
    "                         axis=1)\n",
    "\n",
    "# reorder columns\n",
    "results_ratings_wc3.sort_index(axis=1, inplace=True)\n",
    "results_ratings_wc3.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 65,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>home_win</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   home_win\n",
       "0         1\n",
       "1         0\n",
       "2         0\n",
       "3         1\n",
       "4         0"
      ]
     },
     "execution_count": 65,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ratings_base_wc = results_ratings_wc3.loc[:,['home_win']]\n",
    "ratings_base_wc.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 66,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>attack_diff</th>\n",
       "      <th>bup_dribbling_diff</th>\n",
       "      <th>bup_passing_diff</th>\n",
       "      <th>bup_speed_diff</th>\n",
       "      <th>cc_crossing_diff</th>\n",
       "      <th>cc_passing_diff</th>\n",
       "      <th>cc_shooting_diff</th>\n",
       "      <th>d_aggresion_diff</th>\n",
       "      <th>d_pressure_diff</th>\n",
       "      <th>d_width_diff</th>\n",
       "      <th>...</th>\n",
       "      <th>goalkeeeper_overall_diff</th>\n",
       "      <th>growth_diff</th>\n",
       "      <th>midfield_diff</th>\n",
       "      <th>overall_diff</th>\n",
       "      <th>prestige_diff</th>\n",
       "      <th>start_age_diff</th>\n",
       "      <th>value_euros_millions_diff</th>\n",
       "      <th>wage_euros_thousands_diff</th>\n",
       "      <th>attack_home_defence_away_diff</th>\n",
       "      <th>attack_away_defence_home_diff</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>9.0</td>\n",
       "      <td>9.0</td>\n",
       "      <td>-17.0</td>\n",
       "      <td>-19.0</td>\n",
       "      <td>-11.0</td>\n",
       "      <td>-9.0</td>\n",
       "      <td>-27.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-17.0</td>\n",
       "      <td>...</td>\n",
       "      <td>11.0</td>\n",
       "      <td>-0.000</td>\n",
       "      <td>6.0</td>\n",
       "      <td>7.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>-0.18</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>9.0</td>\n",
       "      <td>-6.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>-9.0</td>\n",
       "      <td>-9.0</td>\n",
       "      <td>17.0</td>\n",
       "      <td>19.0</td>\n",
       "      <td>11.0</td>\n",
       "      <td>9.0</td>\n",
       "      <td>27.0</td>\n",
       "      <td>-1.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>17.0</td>\n",
       "      <td>...</td>\n",
       "      <td>-11.0</td>\n",
       "      <td>-0.000</td>\n",
       "      <td>-6.0</td>\n",
       "      <td>-7.0</td>\n",
       "      <td>-2.0</td>\n",
       "      <td>0.18</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-6.0</td>\n",
       "      <td>9.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>-14.0</td>\n",
       "      <td>-8.0</td>\n",
       "      <td>13.0</td>\n",
       "      <td>14.0</td>\n",
       "      <td>21.0</td>\n",
       "      <td>25.0</td>\n",
       "      <td>-12.0</td>\n",
       "      <td>-9.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-30.0</td>\n",
       "      <td>...</td>\n",
       "      <td>-15.0</td>\n",
       "      <td>-0.425</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-4.0</td>\n",
       "      <td>-2.0</td>\n",
       "      <td>1.55</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-7.0</td>\n",
       "      <td>12.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>14.0</td>\n",
       "      <td>8.0</td>\n",
       "      <td>-13.0</td>\n",
       "      <td>-14.0</td>\n",
       "      <td>-21.0</td>\n",
       "      <td>-25.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>9.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>30.0</td>\n",
       "      <td>...</td>\n",
       "      <td>15.0</td>\n",
       "      <td>0.425</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>4.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>-1.55</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>-7.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>-7.0</td>\n",
       "      <td>-15.0</td>\n",
       "      <td>-31.0</td>\n",
       "      <td>-31.0</td>\n",
       "      <td>21.0</td>\n",
       "      <td>-9.0</td>\n",
       "      <td>-9.0</td>\n",
       "      <td>9.0</td>\n",
       "      <td>17.0</td>\n",
       "      <td>46.0</td>\n",
       "      <td>...</td>\n",
       "      <td>-3.0</td>\n",
       "      <td>-0.175</td>\n",
       "      <td>6.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>0.28</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>2.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 22 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   attack_diff  bup_dribbling_diff  bup_passing_diff  bup_speed_diff  \\\n",
       "0          9.0                 9.0             -17.0           -19.0   \n",
       "1         -9.0                -9.0              17.0            19.0   \n",
       "2        -14.0                -8.0              13.0            14.0   \n",
       "3         14.0                 8.0             -13.0           -14.0   \n",
       "4         -7.0               -15.0             -31.0           -31.0   \n",
       "\n",
       "   cc_crossing_diff  cc_passing_diff  cc_shooting_diff  d_aggresion_diff  \\\n",
       "0             -11.0             -9.0             -27.0               1.0   \n",
       "1              11.0              9.0              27.0              -1.0   \n",
       "2              21.0             25.0             -12.0              -9.0   \n",
       "3             -21.0            -25.0              12.0               9.0   \n",
       "4              21.0             -9.0              -9.0               9.0   \n",
       "\n",
       "   d_pressure_diff  d_width_diff              ...                \\\n",
       "0             -0.0         -17.0              ...                 \n",
       "1             -0.0          17.0              ...                 \n",
       "2             -0.0         -30.0              ...                 \n",
       "3             -0.0          30.0              ...                 \n",
       "4             17.0          46.0              ...                 \n",
       "\n",
       "   goalkeeeper_overall_diff  growth_diff  midfield_diff  overall_diff  \\\n",
       "0                      11.0       -0.000            6.0           7.0   \n",
       "1                     -11.0       -0.000           -6.0          -7.0   \n",
       "2                     -15.0       -0.425           -0.0          -4.0   \n",
       "3                      15.0        0.425           -0.0           4.0   \n",
       "4                      -3.0       -0.175            6.0           2.0   \n",
       "\n",
       "   prestige_diff  start_age_diff  value_euros_millions_diff  \\\n",
       "0            2.0           -0.18                       -0.0   \n",
       "1           -2.0            0.18                       -0.0   \n",
       "2           -2.0            1.55                       -0.0   \n",
       "3            2.0           -1.55                       -0.0   \n",
       "4           -0.0            0.28                       -0.0   \n",
       "\n",
       "   wage_euros_thousands_diff  attack_home_defence_away_diff  \\\n",
       "0                       -0.0                            9.0   \n",
       "1                       -0.0                           -6.0   \n",
       "2                       -0.0                           -7.0   \n",
       "3                       -0.0                           12.0   \n",
       "4                       -0.0                            2.0   \n",
       "\n",
       "   attack_away_defence_home_diff  \n",
       "0                           -6.0  \n",
       "1                            9.0  \n",
       "2                           12.0  \n",
       "3                           -7.0  \n",
       "4                            2.0  \n",
       "\n",
       "[5 rows x 22 columns]"
      ]
     },
     "execution_count": 66,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "diff_ratings_wc = results_ratings_wc3.drop('home_win', axis=1)\n",
    "diff_ratings_wc = diff_ratings_wc.diff(axis=1)\n",
    "ncol_wc = diff_ratings_wc.shape[1]\n",
    "\n",
    "# we only want every alternate column\n",
    "diff_ratings_wc = diff_ratings_wc.iloc[:,list(np.arange(1,ncol_wc, 2))]\n",
    "\n",
    "# we want our statistics to be from perspective of home teams\n",
    "diff_ratings_wc = diff_ratings_wc*-1\n",
    "diff_ratings_wc.columns = [column[:-2] + '_diff' for column in diff_ratings_wc.columns]\n",
    "\n",
    "#Also want difference in attack of one team and defense of the other\n",
    "diff_ratings_wc['attack_home_defence_away_diff'] = results_ratings_wc3['attack_x'] - results_ratings_wc3['defence_y']\n",
    "diff_ratings_wc['attack_away_defence_home_diff'] = results_ratings_wc3['attack_y'] - results_ratings_wc3['defence_x']\n",
    "\n",
    "diff_ratings_wc.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 67,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>home_win</th>\n",
       "      <th>attack_diff</th>\n",
       "      <th>bup_dribbling_diff</th>\n",
       "      <th>bup_passing_diff</th>\n",
       "      <th>bup_speed_diff</th>\n",
       "      <th>cc_crossing_diff</th>\n",
       "      <th>cc_passing_diff</th>\n",
       "      <th>cc_shooting_diff</th>\n",
       "      <th>d_aggresion_diff</th>\n",
       "      <th>d_pressure_diff</th>\n",
       "      <th>...</th>\n",
       "      <th>last_year_avg_weighted_diff</th>\n",
       "      <th>last_year_avg_diff</th>\n",
       "      <th>previous_points_diff</th>\n",
       "      <th>rank_change_diff</th>\n",
       "      <th>rank_diff</th>\n",
       "      <th>three_year_ago_avg_diff</th>\n",
       "      <th>three_year_ago_weighted_diff</th>\n",
       "      <th>total_points_diff</th>\n",
       "      <th>two_year_ago_avg_diff</th>\n",
       "      <th>two_year_ago_weighted_diff</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>9.0</td>\n",
       "      <td>9.0</td>\n",
       "      <td>-17.0</td>\n",
       "      <td>-19.0</td>\n",
       "      <td>-11.0</td>\n",
       "      <td>-9.0</td>\n",
       "      <td>-27.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>-72.01</td>\n",
       "      <td>-144.02</td>\n",
       "      <td>31.0</td>\n",
       "      <td>-4.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>233.41</td>\n",
       "      <td>46.68</td>\n",
       "      <td>-8.75</td>\n",
       "      <td>-18.66</td>\n",
       "      <td>-5.59</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>0</td>\n",
       "      <td>-9.0</td>\n",
       "      <td>-9.0</td>\n",
       "      <td>17.0</td>\n",
       "      <td>19.0</td>\n",
       "      <td>11.0</td>\n",
       "      <td>9.0</td>\n",
       "      <td>27.0</td>\n",
       "      <td>-1.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>72.01</td>\n",
       "      <td>144.02</td>\n",
       "      <td>-31.0</td>\n",
       "      <td>4.0</td>\n",
       "      <td>-3.0</td>\n",
       "      <td>-233.41</td>\n",
       "      <td>-46.68</td>\n",
       "      <td>8.75</td>\n",
       "      <td>18.66</td>\n",
       "      <td>5.59</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0</td>\n",
       "      <td>-14.0</td>\n",
       "      <td>-8.0</td>\n",
       "      <td>13.0</td>\n",
       "      <td>14.0</td>\n",
       "      <td>21.0</td>\n",
       "      <td>25.0</td>\n",
       "      <td>-12.0</td>\n",
       "      <td>-9.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>47.20</td>\n",
       "      <td>94.38</td>\n",
       "      <td>-340.0</td>\n",
       "      <td>-2.0</td>\n",
       "      <td>31.0</td>\n",
       "      <td>-346.08</td>\n",
       "      <td>-69.21</td>\n",
       "      <td>-368.98</td>\n",
       "      <td>-229.85</td>\n",
       "      <td>-68.96</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>1</td>\n",
       "      <td>14.0</td>\n",
       "      <td>8.0</td>\n",
       "      <td>-13.0</td>\n",
       "      <td>-14.0</td>\n",
       "      <td>-21.0</td>\n",
       "      <td>-25.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>9.0</td>\n",
       "      <td>-0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>-47.20</td>\n",
       "      <td>-94.38</td>\n",
       "      <td>340.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>-31.0</td>\n",
       "      <td>346.08</td>\n",
       "      <td>69.21</td>\n",
       "      <td>368.98</td>\n",
       "      <td>229.85</td>\n",
       "      <td>68.96</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0</td>\n",
       "      <td>-7.0</td>\n",
       "      <td>-15.0</td>\n",
       "      <td>-31.0</td>\n",
       "      <td>-31.0</td>\n",
       "      <td>21.0</td>\n",
       "      <td>-9.0</td>\n",
       "      <td>-9.0</td>\n",
       "      <td>9.0</td>\n",
       "      <td>17.0</td>\n",
       "      <td>...</td>\n",
       "      <td>-73.37</td>\n",
       "      <td>-146.75</td>\n",
       "      <td>-46.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>4.0</td>\n",
       "      <td>-227.79</td>\n",
       "      <td>-45.55</td>\n",
       "      <td>-22.49</td>\n",
       "      <td>58.77</td>\n",
       "      <td>17.63</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 35 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   home_win  attack_diff  bup_dribbling_diff  bup_passing_diff  \\\n",
       "0         1          9.0                 9.0             -17.0   \n",
       "1         0         -9.0                -9.0              17.0   \n",
       "2         0        -14.0                -8.0              13.0   \n",
       "3         1         14.0                 8.0             -13.0   \n",
       "4         0         -7.0               -15.0             -31.0   \n",
       "\n",
       "   bup_speed_diff  cc_crossing_diff  cc_passing_diff  cc_shooting_diff  \\\n",
       "0           -19.0             -11.0             -9.0             -27.0   \n",
       "1            19.0              11.0              9.0              27.0   \n",
       "2            14.0              21.0             25.0             -12.0   \n",
       "3           -14.0             -21.0            -25.0              12.0   \n",
       "4           -31.0              21.0             -9.0              -9.0   \n",
       "\n",
       "   d_aggresion_diff  d_pressure_diff             ...              \\\n",
       "0               1.0             -0.0             ...               \n",
       "1              -1.0             -0.0             ...               \n",
       "2              -9.0             -0.0             ...               \n",
       "3               9.0             -0.0             ...               \n",
       "4               9.0             17.0             ...               \n",
       "\n",
       "   last_year_avg_weighted_diff  last_year_avg_diff  previous_points_diff  \\\n",
       "0                       -72.01             -144.02                  31.0   \n",
       "1                        72.01              144.02                 -31.0   \n",
       "2                        47.20               94.38                -340.0   \n",
       "3                       -47.20              -94.38                 340.0   \n",
       "4                       -73.37             -146.75                 -46.0   \n",
       "\n",
       "   rank_change_diff  rank_diff  three_year_ago_avg_diff  \\\n",
       "0              -4.0        3.0                   233.41   \n",
       "1               4.0       -3.0                  -233.41   \n",
       "2              -2.0       31.0                  -346.08   \n",
       "3               2.0      -31.0                   346.08   \n",
       "4               2.0        4.0                  -227.79   \n",
       "\n",
       "   three_year_ago_weighted_diff  total_points_diff  two_year_ago_avg_diff  \\\n",
       "0                         46.68              -8.75                 -18.66   \n",
       "1                        -46.68               8.75                  18.66   \n",
       "2                        -69.21            -368.98                -229.85   \n",
       "3                         69.21             368.98                 229.85   \n",
       "4                        -45.55             -22.49                  58.77   \n",
       "\n",
       "   two_year_ago_weighted_diff  \n",
       "0                       -5.59  \n",
       "1                        5.59  \n",
       "2                      -68.96  \n",
       "3                       68.96  \n",
       "4                       17.63  \n",
       "\n",
       "[5 rows x 35 columns]"
      ]
     },
     "execution_count": 67,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "\n",
    "# compile datframe\n",
    "test = pd.concat([ratings_base_wc, diff_ratings_wc, diff_rankings_wc], axis=1)\n",
    "#Assert columns of train and test are in same order\n",
    "assert len(test.columns) == len(train.columns)\n",
    "assert list(test.columns) == list(train.columns)\n",
    "test.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 68,
   "metadata": {},
   "outputs": [],
   "source": [
    "test['Group'] = tournament_round"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 69,
   "metadata": {},
   "outputs": [],
   "source": [
    "#get rid of even rows since same match as odd rows.\n",
    "test = test[test.index % 2 == 0]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 70,
   "metadata": {},
   "outputs": [],
   "source": [
    "# save to csv\n",
    "test.to_csv(\"data/test_team.csv', index = False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
