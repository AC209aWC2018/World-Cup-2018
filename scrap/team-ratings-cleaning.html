<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>&lt;no title&gt; &#8212; World Cup  documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          World Cup</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption"><span class="caption-text">Introduction:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/problem_statement.html">Overview and Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/related_works.html">Literature Review and Related Works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/data_description.html">Description of Data</a></li>
</ul>
<p class="caption"><span class="caption-text">EDA:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/EDA-notebook.html">Exploratory Data Analysis</a></li>
</ul>
<p class="caption"><span class="caption-text">Models:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../models/baseline_model.html">Baseline Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/beyond_baseline.html">Modeling with Feature Engineered Features</a></li>
</ul>
<p class="caption"><span class="caption-text">Conclusion:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/summary.html">Summary and Future Work</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul class="simple">
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/scrap/team-ratings-cleaning.ipynb.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 9ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }
</style>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [134]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [135]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/fifa/international_results.csv&#39;</span><span class="p">)</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># restrict dates</span>
<span class="n">earliest_date</span> <span class="o">=</span> <span class="s1">&#39;2010-01-01&#39;</span>
<span class="n">latest_date</span> <span class="o">=</span> <span class="s1">&#39;2018-06-14&#39;</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="p">[(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">earliest_date</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">latest_date</span><span class="p">)]</span>
<span class="n">results</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[135]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>home_team</th>
      <th>away_team</th>
      <th>home_score</th>
      <th>away_score</th>
      <th>tournament</th>
      <th>city</th>
      <th>country</th>
      <th>neutral</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>31700</th>
      <td>2010-01-02 00:00:00+00:00</td>
      <td>Iran</td>
      <td>Korea DPR</td>
      <td>1</td>
      <td>0</td>
      <td>Friendly</td>
      <td>Doha</td>
      <td>Qatar</td>
      <td>True</td>
    </tr>
    <tr>
      <th>31701</th>
      <td>2010-01-02 00:00:00+00:00</td>
      <td>Qatar</td>
      <td>Mali</td>
      <td>0</td>
      <td>0</td>
      <td>Friendly</td>
      <td>Doha</td>
      <td>Qatar</td>
      <td>False</td>
    </tr>
    <tr>
      <th>31702</th>
      <td>2010-01-02 00:00:00+00:00</td>
      <td>Syria</td>
      <td>Zimbabwe</td>
      <td>6</td>
      <td>0</td>
      <td>Friendly</td>
      <td>Kuala Lumpur</td>
      <td>Malaysia</td>
      <td>True</td>
    </tr>
    <tr>
      <th>31703</th>
      <td>2010-01-02 00:00:00+00:00</td>
      <td>Yemen</td>
      <td>Tajikistan</td>
      <td>0</td>
      <td>1</td>
      <td>Friendly</td>
      <td>Sana'a</td>
      <td>Yemen</td>
      <td>False</td>
    </tr>
    <tr>
      <th>31704</th>
      <td>2010-01-03 00:00:00+00:00</td>
      <td>Angola</td>
      <td>Gambia</td>
      <td>1</td>
      <td>1</td>
      <td>Friendly</td>
      <td>Vila Real de Santo António</td>
      <td>Portugal</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [136]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># response variable</span>
<span class="n">score_diff</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;home_score&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;away_score&#39;</span><span class="p">]</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;home_win&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">score</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">score_diff</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [137]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ratings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/sofifa_final.csv&#39;</span><span class="p">)</span>
<span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>

<span class="c1"># restrict dates</span>
<span class="n">ratings</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[(</span><span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">earliest_date</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">latest_date</span><span class="p">)]</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[137]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>team</th>
      <th>date</th>
      <th>overall</th>
      <th>attack</th>
      <th>midfield</th>
      <th>defence</th>
      <th>prestige</th>
      <th>start_age</th>
      <th>full_age</th>
      <th>bup_speed</th>
      <th>...</th>
      <th>cc_passing</th>
      <th>cc_crossing</th>
      <th>cc_shooting</th>
      <th>d_pressure</th>
      <th>d_aggresion</th>
      <th>d_width</th>
      <th>wage_euros_thousands</th>
      <th>value_euros_millions</th>
      <th>growth</th>
      <th>goalkeeeper_overall</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>48</th>
      <td>Brazil</td>
      <td>2018-06-11</td>
      <td>85.0</td>
      <td>86.0</td>
      <td>83.0</td>
      <td>85.0</td>
      <td>10.0</td>
      <td>26.73</td>
      <td>27.09</td>
      <td>51.0</td>
      <td>...</td>
      <td>39.0</td>
      <td>33.0</td>
      <td>67.0</td>
      <td>76.0</td>
      <td>73.0</td>
      <td>63.0</td>
      <td>123.608696</td>
      <td>32.5</td>
      <td>1.826087</td>
      <td>84.0</td>
    </tr>
    <tr>
      <th>49</th>
      <td>Brazil</td>
      <td>2018-06-07</td>
      <td>85.0</td>
      <td>86.0</td>
      <td>83.0</td>
      <td>85.0</td>
      <td>10.0</td>
      <td>26.73</td>
      <td>27.09</td>
      <td>51.0</td>
      <td>...</td>
      <td>39.0</td>
      <td>33.0</td>
      <td>67.0</td>
      <td>76.0</td>
      <td>73.0</td>
      <td>63.0</td>
      <td>123.608696</td>
      <td>32.5</td>
      <td>1.826087</td>
      <td>84.0</td>
    </tr>
    <tr>
      <th>50</th>
      <td>Brazil</td>
      <td>2018-06-04</td>
      <td>85.0</td>
      <td>86.0</td>
      <td>83.0</td>
      <td>85.0</td>
      <td>10.0</td>
      <td>26.73</td>
      <td>27.09</td>
      <td>51.0</td>
      <td>...</td>
      <td>39.0</td>
      <td>33.0</td>
      <td>67.0</td>
      <td>76.0</td>
      <td>73.0</td>
      <td>63.0</td>
      <td>123.608696</td>
      <td>32.5</td>
      <td>1.826087</td>
      <td>84.0</td>
    </tr>
    <tr>
      <th>51</th>
      <td>Brazil</td>
      <td>2018-05-31</td>
      <td>85.0</td>
      <td>86.0</td>
      <td>83.0</td>
      <td>85.0</td>
      <td>10.0</td>
      <td>26.73</td>
      <td>27.09</td>
      <td>51.0</td>
      <td>...</td>
      <td>39.0</td>
      <td>33.0</td>
      <td>67.0</td>
      <td>76.0</td>
      <td>73.0</td>
      <td>63.0</td>
      <td>123.608696</td>
      <td>32.5</td>
      <td>1.826087</td>
      <td>84.0</td>
    </tr>
    <tr>
      <th>52</th>
      <td>Brazil</td>
      <td>2018-05-28</td>
      <td>85.0</td>
      <td>86.0</td>
      <td>83.0</td>
      <td>85.0</td>
      <td>10.0</td>
      <td>26.73</td>
      <td>27.09</td>
      <td>51.0</td>
      <td>...</td>
      <td>39.0</td>
      <td>33.0</td>
      <td>67.0</td>
      <td>76.0</td>
      <td>73.0</td>
      <td>63.0</td>
      <td>123.608696</td>
      <td>32.5</td>
      <td>1.826087</td>
      <td>84.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 22 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [138]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fifa_rankings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/fifa_ranking.csv&#39;</span><span class="p">)</span>
<span class="n">fifa_rankings</span><span class="p">[</span><span class="s1">&#39;rank_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">fifa_rankings</span><span class="p">[</span><span class="s1">&#39;rank_date&#39;</span><span class="p">])</span>
<span class="n">fifa_rankings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[138]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rank</th>
      <th>country_full</th>
      <th>country_abrv</th>
      <th>total_points</th>
      <th>previous_points</th>
      <th>rank_change</th>
      <th>cur_year_avg</th>
      <th>cur_year_avg_weighted</th>
      <th>last_year_avg</th>
      <th>last_year_avg_weighted</th>
      <th>two_year_ago_avg</th>
      <th>two_year_ago_weighted</th>
      <th>three_year_ago_avg</th>
      <th>three_year_ago_weighted</th>
      <th>confederation</th>
      <th>rank_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Germany</td>
      <td>GER</td>
      <td>0.0</td>
      <td>57</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>UEFA</td>
      <td>1993-08-08</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Italy</td>
      <td>ITA</td>
      <td>0.0</td>
      <td>57</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>UEFA</td>
      <td>1993-08-08</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Switzerland</td>
      <td>SUI</td>
      <td>0.0</td>
      <td>50</td>
      <td>9</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>UEFA</td>
      <td>1993-08-08</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Sweden</td>
      <td>SWE</td>
      <td>0.0</td>
      <td>55</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>UEFA</td>
      <td>1993-08-08</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Argentina</td>
      <td>ARG</td>
      <td>0.0</td>
      <td>51</td>
      <td>5</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>CONMEBOL</td>
      <td>1993-08-08</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We now have to find for each match the latest team ratings and ranking.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [98]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">ratings</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="n">teams</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [99]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># check that we found the corresponding team from team ratings in results</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">teams</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">home_team</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="o">==</span> <span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cannot Find </span><span class="si">{}</span><span class="s1"> in Results Home&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">teams</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">away_team</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="o">==</span> <span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cannot Find </span><span class="si">{}</span><span class="s1"> in Results Away&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">teams</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">fifa_rankings</span><span class="o">.</span><span class="n">country_full</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="o">==</span> <span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cannot Find </span><span class="si">{}</span><span class="s1"> in Rankings&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Cannot Find Republic of Ireland in Results Home
Cannot Find United States in Results Home
Cannot Find China PR in Results Home
Cannot Find Côte d&#39;Ivoire in Results Home
Cannot Find Republic of Ireland in Results Away
Cannot Find United States in Results Away
Cannot Find China PR in Results Away
Cannot Find Côte d&#39;Ivoire in Results Away
Cannot Find United States in Rankings
Cannot Find Iran in Rankings
</pre></div></div>
</div>
<p>Before we proceed with anything else, let’s check that country names are
spelled similarly. We find that ‘Republic of Ireland’, ‘United States’,
‘China PR’, ‘Iran’, and ‘Côte d’Ivoire’ might be spelled differently.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [100]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ratings</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Republic of Ireland&#39;</span><span class="p">,</span> <span class="s1">&#39;Ireland&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;United States&#39;</span><span class="p">,</span> <span class="s1">&#39;USA&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;China PR&#39;</span><span class="p">,</span> <span class="s1">&#39;China&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Côte d&#39;Ivoire&quot;</span><span class="p">,</span> <span class="s1">&#39;Ivory Coast&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fifa_rankings</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;IR Iran&quot;</span><span class="p">,</span> <span class="s2">&quot;Iran&quot;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now we finally have two datasets of teams spelled in the same way.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [101]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># find closest date that we have data</span>
<span class="k">def</span> <span class="nf">get_latest_date</span><span class="p">(</span><span class="n">match_date</span><span class="p">,</span> <span class="n">dates</span><span class="p">):</span>
    <span class="n">match_date</span> <span class="o">=</span> <span class="n">match_date</span><span class="o">.</span><span class="n">to_datetime64</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">dates</span><span class="p">[</span><span class="n">match_date</span> <span class="o">&gt;</span>  <span class="n">dates</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="c1"># results[&#39;closest_date&#39;] = results.apply(lambda i: min(dates, key=lambda d: abs(d-i.date)), axis=1)</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;closest_rating_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_latest_date</span><span class="p">,</span> <span class="n">dates</span> <span class="o">=</span> <span class="n">dates</span><span class="p">)</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;closest_ranking_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_latest_date</span><span class="p">,</span> <span class="n">dates</span> <span class="o">=</span> <span class="n">fifa_rankings</span><span class="o">.</span><span class="n">rank_date</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [102]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[102]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>home_team</th>
      <th>away_team</th>
      <th>home_score</th>
      <th>away_score</th>
      <th>tournament</th>
      <th>city</th>
      <th>country</th>
      <th>neutral</th>
      <th>home_win</th>
      <th>closest_rating_date</th>
      <th>closest_ranking_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>39601</th>
      <td>2018-06-10 00:00:00+00:00</td>
      <td>Austria</td>
      <td>Brazil</td>
      <td>0</td>
      <td>3</td>
      <td>Friendly</td>
      <td>Vienna</td>
      <td>Austria</td>
      <td>False</td>
      <td>0</td>
      <td>2018-06-07</td>
      <td>2018-06-07</td>
    </tr>
    <tr>
      <th>39602</th>
      <td>2018-06-11 00:00:00+00:00</td>
      <td>Korea Republic</td>
      <td>Senegal</td>
      <td>0</td>
      <td>2</td>
      <td>Friendly</td>
      <td>Grödig</td>
      <td>Austria</td>
      <td>True</td>
      <td>0</td>
      <td>2018-06-07</td>
      <td>2018-06-07</td>
    </tr>
    <tr>
      <th>39603</th>
      <td>2018-06-11 00:00:00+00:00</td>
      <td>Belgium</td>
      <td>Costa Rica</td>
      <td>4</td>
      <td>1</td>
      <td>Friendly</td>
      <td>Brussels</td>
      <td>Belgium</td>
      <td>False</td>
      <td>1</td>
      <td>2018-06-07</td>
      <td>2018-06-07</td>
    </tr>
    <tr>
      <th>39604</th>
      <td>2018-06-12 00:00:00+00:00</td>
      <td>Japan</td>
      <td>Paraguay</td>
      <td>4</td>
      <td>2</td>
      <td>Friendly</td>
      <td>Innsbruck</td>
      <td>Austria</td>
      <td>True</td>
      <td>1</td>
      <td>2018-06-11</td>
      <td>2018-06-07</td>
    </tr>
    <tr>
      <th>39605</th>
      <td>2018-06-12 00:00:00+00:00</td>
      <td>Poland</td>
      <td>Lithuania</td>
      <td>4</td>
      <td>0</td>
      <td>Friendly</td>
      <td>Warsaw</td>
      <td>Poland</td>
      <td>False</td>
      <td>1</td>
      <td>2018-06-11</td>
      <td>2018-06-07</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Now that we have the closest matching data for both of our datasets, we
can merge on team and date. We will first do this for the ratings
dataset.</p>
<p>Note that for both the ratings and rankings tables we have merge twice
in order to account for both home and away teams.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [104]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Reset index to keep track of original index</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">results_ratings1</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span>
                                <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;closest_rating_date&#39;</span><span class="p">,</span> <span class="s1">&#39;home_team&#39;</span><span class="p">],</span>
                                <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;team&#39;</span><span class="p">])</span>

<span class="n">results_ratings2</span> <span class="o">=</span> <span class="n">results_ratings1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span>
                                       <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;closest_rating_date&#39;</span><span class="p">,</span> <span class="s1">&#39;away_team&#39;</span><span class="p">],</span>
                                       <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;team&#39;</span><span class="p">])</span>

<span class="n">results_ratings2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[104]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>index</th>
      <th>date_x</th>
      <th>home_team</th>
      <th>away_team</th>
      <th>home_score</th>
      <th>away_score</th>
      <th>tournament</th>
      <th>city</th>
      <th>country</th>
      <th>neutral</th>
      <th>...</th>
      <th>cc_passing_y</th>
      <th>cc_crossing_y</th>
      <th>cc_shooting_y</th>
      <th>d_pressure_y</th>
      <th>d_aggresion_y</th>
      <th>d_width_y</th>
      <th>wage_euros_thousands_y</th>
      <th>value_euros_millions_y</th>
      <th>growth_y</th>
      <th>goalkeeeper_overall_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>31823</td>
      <td>2010-03-03 00:00:00+00:00</td>
      <td>Mexico</td>
      <td>New Zealand</td>
      <td>2</td>
      <td>0</td>
      <td>Friendly</td>
      <td>Pasadena</td>
      <td>USA</td>
      <td>True</td>
      <td>...</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>35.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>8.266667</td>
      <td>60.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>31878</td>
      <td>2010-05-24 00:00:00+00:00</td>
      <td>Australia</td>
      <td>New Zealand</td>
      <td>2</td>
      <td>1</td>
      <td>Friendly</td>
      <td>Melbourne</td>
      <td>Australia</td>
      <td>False</td>
      <td>...</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>35.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>8.266667</td>
      <td>60.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>32000</td>
      <td>2010-06-20 00:00:00+00:00</td>
      <td>Italy</td>
      <td>New Zealand</td>
      <td>1</td>
      <td>1</td>
      <td>FIFA World Cup</td>
      <td>Nelspruit</td>
      <td>South Africa</td>
      <td>True</td>
      <td>...</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>35.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>8.266667</td>
      <td>60.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>31949</td>
      <td>2010-06-04 00:00:00+00:00</td>
      <td>Slovenia</td>
      <td>New Zealand</td>
      <td>3</td>
      <td>1</td>
      <td>Friendly</td>
      <td>Maribor</td>
      <td>Slovenia</td>
      <td>False</td>
      <td>...</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>35.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>8.266667</td>
      <td>60.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>32017</td>
      <td>2010-06-24 00:00:00+00:00</td>
      <td>Paraguay</td>
      <td>New Zealand</td>
      <td>0</td>
      <td>0</td>
      <td>FIFA World Cup</td>
      <td>Polokwane</td>
      <td>South Africa</td>
      <td>True</td>
      <td>...</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>35.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>8.266667</td>
      <td>60.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 57 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [105]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results_ratings2</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[105]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(1169, 57)
</pre></div>
</div>
</div>
<p>We find that we have 1169 observations that can still be used after
matching team ratings with the results dataframe with an inner merge. We
now clean up the merged dataframe slightly.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [106]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># drop useless columns</span>
<span class="n">results_ratings3</span> <span class="o">=</span> <span class="n">results_ratings2</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;home_team&#39;</span><span class="p">,</span> <span class="s1">&#39;away_team&#39;</span><span class="p">,</span> <span class="s1">&#39;tournament&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="s1">&#39;neutral&#39;</span><span class="p">,</span> <span class="s1">&#39;closest_rating_date&#39;</span><span class="p">,</span> <span class="s1">&#39;closest_ranking_date&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;team_x&#39;</span><span class="p">,</span> <span class="s1">&#39;date_y&#39;</span><span class="p">,</span> <span class="s1">&#39;team_y&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;home_score&#39;</span><span class="p">,</span> <span class="s1">&#39;away_score&#39;</span><span class="p">,</span> <span class="s1">&#39;date_x&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># reorder columns</span>
<span class="n">results_ratings3</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">results_ratings3</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[106]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>attack_x</th>
      <th>attack_y</th>
      <th>bup_dribbling_x</th>
      <th>bup_dribbling_y</th>
      <th>bup_passing_x</th>
      <th>bup_passing_y</th>
      <th>bup_speed_x</th>
      <th>bup_speed_y</th>
      <th>cc_crossing_x</th>
      <th>cc_crossing_y</th>
      <th>...</th>
      <th>overall_x</th>
      <th>overall_y</th>
      <th>prestige_x</th>
      <th>prestige_y</th>
      <th>start_age_x</th>
      <th>start_age_y</th>
      <th>value_euros_millions_x</th>
      <th>value_euros_millions_y</th>
      <th>wage_euros_thousands_x</th>
      <th>wage_euros_thousands_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>73.0</td>
      <td>60.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>45.0</td>
      <td>70.0</td>
      <td>65.0</td>
      <td>70.0</td>
      <td>55.0</td>
      <td>70.0</td>
      <td>...</td>
      <td>77.0</td>
      <td>62.0</td>
      <td>15.0</td>
      <td>6.0</td>
      <td>27.09</td>
      <td>29.18</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>71.0</td>
      <td>60.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>60.0</td>
      <td>70.0</td>
      <td>...</td>
      <td>75.0</td>
      <td>62.0</td>
      <td>11.0</td>
      <td>6.0</td>
      <td>30.36</td>
      <td>29.18</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>83.0</td>
      <td>60.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>30.0</td>
      <td>70.0</td>
      <td>67.0</td>
      <td>70.0</td>
      <td>60.0</td>
      <td>70.0</td>
      <td>...</td>
      <td>83.0</td>
      <td>62.0</td>
      <td>19.0</td>
      <td>6.0</td>
      <td>28.91</td>
      <td>29.18</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>70.0</td>
      <td>60.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>65.0</td>
      <td>70.0</td>
      <td>...</td>
      <td>70.0</td>
      <td>62.0</td>
      <td>5.0</td>
      <td>6.0</td>
      <td>25.64</td>
      <td>29.18</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>75.0</td>
      <td>60.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>40.0</td>
      <td>70.0</td>
      <td>65.0</td>
      <td>70.0</td>
      <td>40.0</td>
      <td>70.0</td>
      <td>...</td>
      <td>75.0</td>
      <td>62.0</td>
      <td>8.0</td>
      <td>6.0</td>
      <td>28.09</td>
      <td>29.18</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 41 columns</p>
</div></div>
</div>
<p>Our final training data is basically a difference in the various team
ratings. Now let’s clean up the dataframe for our training.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [107]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ratings_base</span> <span class="o">=</span> <span class="n">results_ratings3</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;home_win&#39;</span><span class="p">]]</span>
<span class="n">ratings_base</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[107]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>home_win</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [108]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">diff_ratings</span> <span class="o">=</span> <span class="n">results_ratings3</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;home_win&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#Diff every column with column beforehand.</span>
<span class="n">diff_ratings</span> <span class="o">=</span> <span class="n">diff_ratings</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ncol</span> <span class="o">=</span> <span class="n">diff_ratings</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Since we diff every column with column beforehand, we only want every alternate column since those are the true diff</span>
<span class="n">diff_ratings</span> <span class="o">=</span> <span class="n">diff_ratings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ncol</span><span class="p">,</span> <span class="mi">2</span><span class="p">))]</span>

<span class="c1"># we want our statistics to be from perspective of home team</span>
<span class="n">diff_ratings</span> <span class="o">=</span> <span class="n">diff_ratings</span><span class="o">*-</span><span class="mi">1</span>


<span class="n">diff_ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[108]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>attack_y</th>
      <th>bup_dribbling_y</th>
      <th>bup_passing_y</th>
      <th>bup_speed_y</th>
      <th>cc_crossing_y</th>
      <th>cc_passing_y</th>
      <th>cc_shooting_y</th>
      <th>d_aggresion_y</th>
      <th>d_pressure_y</th>
      <th>d_width_y</th>
      <th>defence_y</th>
      <th>full_age_y</th>
      <th>goalkeeeper_overall_y</th>
      <th>growth_y</th>
      <th>midfield_y</th>
      <th>overall_y</th>
      <th>prestige_y</th>
      <th>start_age_y</th>
      <th>value_euros_millions_y</th>
      <th>wage_euros_thousands_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>13.0</td>
      <td>-0.0</td>
      <td>-25.0</td>
      <td>-5.0</td>
      <td>-15.0</td>
      <td>-5.0</td>
      <td>-5.0</td>
      <td>-10.0</td>
      <td>-5.0</td>
      <td>25.0</td>
      <td>16.0</td>
      <td>0.23</td>
      <td>19.0</td>
      <td>-1.666667</td>
      <td>17.0</td>
      <td>15.0</td>
      <td>9.0</td>
      <td>-2.09</td>
      <td>-0.0</td>
      <td>-0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>11.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-10.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-20.0</td>
      <td>15.0</td>
      <td>10.0</td>
      <td>1.53</td>
      <td>19.0</td>
      <td>-1.466667</td>
      <td>14.0</td>
      <td>13.0</td>
      <td>5.0</td>
      <td>1.18</td>
      <td>-0.0</td>
      <td>-0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>23.0</td>
      <td>-0.0</td>
      <td>-40.0</td>
      <td>-3.0</td>
      <td>-10.0</td>
      <td>-15.0</td>
      <td>-30.0</td>
      <td>-40.0</td>
      <td>-40.0</td>
      <td>15.0</td>
      <td>22.0</td>
      <td>1.20</td>
      <td>28.0</td>
      <td>-3.433333</td>
      <td>24.0</td>
      <td>21.0</td>
      <td>13.0</td>
      <td>-0.27</td>
      <td>-0.0</td>
      <td>-0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-5.0</td>
      <td>-15.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-20.0</td>
      <td>15.0</td>
      <td>9.0</td>
      <td>-0.30</td>
      <td>18.0</td>
      <td>0.300000</td>
      <td>10.0</td>
      <td>8.0</td>
      <td>-1.0</td>
      <td>-3.54</td>
      <td>-0.0</td>
      <td>-0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>15.0</td>
      <td>-0.0</td>
      <td>-30.0</td>
      <td>-5.0</td>
      <td>-30.0</td>
      <td>-5.0</td>
      <td>-0.0</td>
      <td>-25.0</td>
      <td>-35.0</td>
      <td>15.0</td>
      <td>15.0</td>
      <td>1.53</td>
      <td>16.0</td>
      <td>-3.166667</td>
      <td>13.0</td>
      <td>13.0</td>
      <td>2.0</td>
      <td>-1.09</td>
      <td>-0.0</td>
      <td>-0.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [109]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_diff&#39;</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">diff_ratings</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

<span class="n">diff_ratings</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>

<span class="c1">#Also want difference in attack of one team and defense of the other</span>
<span class="n">diff_ratings</span><span class="p">[</span><span class="s1">&#39;attack_home_defence_away_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_ratings3</span><span class="p">[</span><span class="s1">&#39;attack_x&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">results_ratings3</span><span class="p">[</span><span class="s1">&#39;defence_y&#39;</span><span class="p">]</span>
<span class="n">diff_ratings</span><span class="p">[</span><span class="s1">&#39;attack_away_defence_home_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_ratings3</span><span class="p">[</span><span class="s1">&#39;attack_y&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">results_ratings3</span><span class="p">[</span><span class="s1">&#39;defence_x&#39;</span><span class="p">]</span>

<span class="c1"># compile datframe</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ratings_base</span><span class="p">,</span> <span class="n">diff_ratings</span><span class="p">,</span> <span class="n">results_ratings2</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[109]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>home_win</th>
      <th>attack_diff</th>
      <th>bup_dribbling_diff</th>
      <th>bup_passing_diff</th>
      <th>bup_speed_diff</th>
      <th>cc_crossing_diff</th>
      <th>cc_passing_diff</th>
      <th>cc_shooting_diff</th>
      <th>d_aggresion_diff</th>
      <th>d_pressure_diff</th>
      <th>...</th>
      <th>growth_diff</th>
      <th>midfield_diff</th>
      <th>overall_diff</th>
      <th>prestige_diff</th>
      <th>start_age_diff</th>
      <th>value_euros_millions_diff</th>
      <th>wage_euros_thousands_diff</th>
      <th>attack_home_defence_away_diff</th>
      <th>attack_away_defence_home_diff</th>
      <th>index</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>13.0</td>
      <td>-0.0</td>
      <td>-25.0</td>
      <td>-5.0</td>
      <td>-15.0</td>
      <td>-5.0</td>
      <td>-5.0</td>
      <td>-10.0</td>
      <td>-5.0</td>
      <td>...</td>
      <td>-1.666667</td>
      <td>17.0</td>
      <td>15.0</td>
      <td>9.0</td>
      <td>-2.09</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>15.0</td>
      <td>-14.0</td>
      <td>31823</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>11.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-10.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-20.0</td>
      <td>...</td>
      <td>-1.466667</td>
      <td>14.0</td>
      <td>13.0</td>
      <td>5.0</td>
      <td>1.18</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>13.0</td>
      <td>-8.0</td>
      <td>31878</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>23.0</td>
      <td>-0.0</td>
      <td>-40.0</td>
      <td>-3.0</td>
      <td>-10.0</td>
      <td>-15.0</td>
      <td>-30.0</td>
      <td>-40.0</td>
      <td>-40.0</td>
      <td>...</td>
      <td>-3.433333</td>
      <td>24.0</td>
      <td>21.0</td>
      <td>13.0</td>
      <td>-0.27</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>25.0</td>
      <td>-20.0</td>
      <td>32000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>10.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-5.0</td>
      <td>-15.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-20.0</td>
      <td>...</td>
      <td>0.300000</td>
      <td>10.0</td>
      <td>8.0</td>
      <td>-1.0</td>
      <td>-3.54</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>12.0</td>
      <td>-7.0</td>
      <td>31949</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2</td>
      <td>15.0</td>
      <td>-0.0</td>
      <td>-30.0</td>
      <td>-5.0</td>
      <td>-30.0</td>
      <td>-5.0</td>
      <td>-0.0</td>
      <td>-25.0</td>
      <td>-35.0</td>
      <td>...</td>
      <td>-3.166667</td>
      <td>13.0</td>
      <td>13.0</td>
      <td>2.0</td>
      <td>-1.09</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>17.0</td>
      <td>-13.0</td>
      <td>32017</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 24 columns</p>
</div></div>
</div>
<p>Now we do the same for rankings.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [110]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Now merge rankings</span>
<span class="n">results_rankings1</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fifa_rankings</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span>
                                <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;closest_ranking_date&#39;</span><span class="p">,</span> <span class="s1">&#39;home_team&#39;</span><span class="p">],</span>
                                <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;rank_date&#39;</span><span class="p">,</span> <span class="s1">&#39;country_full&#39;</span><span class="p">])</span>

<span class="n">results_rankings2</span> <span class="o">=</span> <span class="n">results_rankings1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fifa_rankings</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span>
                                <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;closest_ranking_date&#39;</span><span class="p">,</span> <span class="s1">&#39;away_team&#39;</span><span class="p">],</span>
                                <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;rank_date&#39;</span><span class="p">,</span> <span class="s1">&#39;country_full&#39;</span><span class="p">])</span>

</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [111]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># drop useless columns</span>
<span class="n">results_rankings3</span> <span class="o">=</span> <span class="n">results_rankings2</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;home_team&#39;</span><span class="p">,</span> <span class="s1">&#39;away_team&#39;</span><span class="p">,</span> <span class="s1">&#39;tournament&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="s1">&#39;neutral&#39;</span><span class="p">,</span> <span class="s1">&#39;closest_rating_date&#39;</span><span class="p">,</span> <span class="s1">&#39;closest_ranking_date&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;country_full_x&#39;</span><span class="p">,</span> <span class="s1">&#39;rank_date_y&#39;</span><span class="p">,</span> <span class="s1">&#39;country_full_y&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;home_score&#39;</span><span class="p">,</span> <span class="s1">&#39;away_score&#39;</span><span class="p">,</span> <span class="s1">&#39;rank_date_x&#39;</span><span class="p">,</span> <span class="s1">&#39;confederation_x&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;confederation_y&#39;</span><span class="p">,</span> <span class="s1">&#39;country_abrv_x&#39;</span><span class="p">,</span> <span class="s1">&#39;country_abrv_y&#39;</span><span class="p">,</span> <span class="s1">&#39;home_win&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># reorder columns</span>
<span class="n">results_rankings3</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">results_rankings3</span><span class="p">[[</span><span class="s1">&#39;rank_x&#39;</span><span class="p">,</span> <span class="s1">&#39;rank_y&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[111]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rank_x</th>
      <th>rank_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>64</td>
      <td>86</td>
    </tr>
    <tr>
      <th>1</th>
      <td>86</td>
      <td>47</td>
    </tr>
    <tr>
      <th>2</th>
      <td>95</td>
      <td>47</td>
    </tr>
    <tr>
      <th>3</th>
      <td>24</td>
      <td>47</td>
    </tr>
    <tr>
      <th>4</th>
      <td>91</td>
      <td>109</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [112]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Diff every column with column beforehand.</span>
<span class="n">diff_rankings</span> <span class="o">=</span> <span class="n">results_rankings3</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ncol</span> <span class="o">=</span> <span class="n">diff_rankings</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Since we diff every column with column beforehand, we only want every alternate column since those are the true diff</span>
<span class="n">diff_rankings</span> <span class="o">=</span> <span class="n">diff_rankings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ncol</span><span class="p">,</span> <span class="mi">2</span><span class="p">))]</span>

<span class="c1"># we want our statistics to be from perspective of home team</span>
<span class="n">diff_rankings</span> <span class="o">=</span> <span class="n">diff_rankings</span><span class="o">*-</span><span class="mi">1</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_diff&quot;</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">diff_rankings</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

<span class="n">diff_rankings</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>
<span class="n">diff_rankings</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_rankings2</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span>

<span class="n">diff_rankings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[112]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cur_year_avg_weighted_diff</th>
      <th>cur_year_avg_diff</th>
      <th>last_year_avg_weighted_diff</th>
      <th>last_year_avg_diff</th>
      <th>previous_points_diff</th>
      <th>rank_change_diff</th>
      <th>rank_diff</th>
      <th>three_year_ago_avg_diff</th>
      <th>three_year_ago_weighted_diff</th>
      <th>total_points_diff</th>
      <th>two_year_ago_avg_diff</th>
      <th>two_year_ago_weighted_diff</th>
      <th>index</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>119.0</td>
      <td>1.0</td>
      <td>-22.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>31700</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-288.0</td>
      <td>1.0</td>
      <td>39.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>31701</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-325.0</td>
      <td>-1.0</td>
      <td>48.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>31723</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>158.0</td>
      <td>5.0</td>
      <td>-23.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>31705</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>83.0</td>
      <td>1.0</td>
      <td>-18.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>31702</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [113]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">diff_rankings</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">],</span> <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">],</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;inner&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;index&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [114]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[114]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>home_win</th>
      <th>attack_diff</th>
      <th>bup_dribbling_diff</th>
      <th>bup_passing_diff</th>
      <th>bup_speed_diff</th>
      <th>cc_crossing_diff</th>
      <th>cc_passing_diff</th>
      <th>cc_shooting_diff</th>
      <th>d_aggresion_diff</th>
      <th>d_pressure_diff</th>
      <th>...</th>
      <th>last_year_avg_weighted_diff</th>
      <th>last_year_avg_diff</th>
      <th>previous_points_diff</th>
      <th>rank_change_diff</th>
      <th>rank_diff</th>
      <th>three_year_ago_avg_diff</th>
      <th>three_year_ago_weighted_diff</th>
      <th>total_points_diff</th>
      <th>two_year_ago_avg_diff</th>
      <th>two_year_ago_weighted_diff</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>13.0</td>
      <td>-0.0</td>
      <td>-25.0</td>
      <td>-5.0</td>
      <td>-15.0</td>
      <td>-5.0</td>
      <td>-5.0</td>
      <td>-10.0</td>
      <td>-5.0</td>
      <td>...</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>531.0</td>
      <td>-3.0</td>
      <td>-62.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>11.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-10.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-20.0</td>
      <td>...</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>489.0</td>
      <td>-2.0</td>
      <td>-58.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>23.0</td>
      <td>-0.0</td>
      <td>-40.0</td>
      <td>-3.0</td>
      <td>-10.0</td>
      <td>-15.0</td>
      <td>-30.0</td>
      <td>-40.0</td>
      <td>-40.0</td>
      <td>...</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>771.0</td>
      <td>-0.0</td>
      <td>-73.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>10.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-5.0</td>
      <td>-15.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-20.0</td>
      <td>...</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>447.0</td>
      <td>-2.0</td>
      <td>-53.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2</td>
      <td>15.0</td>
      <td>-0.0</td>
      <td>-30.0</td>
      <td>-5.0</td>
      <td>-30.0</td>
      <td>-5.0</td>
      <td>-0.0</td>
      <td>-25.0</td>
      <td>-35.0</td>
      <td>...</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>409.0</td>
      <td>-1.0</td>
      <td>-47.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 35 columns</p>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [115]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># save to csv</span>
<span class="n">train</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;data/train_team.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We now create our test set with actual world cup data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [116]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ratings_wc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/team_stats_final.csv&#39;</span><span class="p">)</span>
<span class="n">ratings_wc</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">ratings_wc</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># restrict dates</span>
<span class="n">latest_date</span> <span class="o">=</span> <span class="s1">&#39;2018-06-14&#39;</span>
<span class="n">wc_start</span> <span class="o">=</span> <span class="s1">&#39;2018-06-16&#39;</span> <span class="c1"># first WC rating</span>
<span class="n">wc_end</span> <span class="o">=</span> <span class="s1">&#39;2018-07-15&#39;</span>
<span class="c1"># restrict dates</span>
<span class="n">ratings_wc</span> <span class="o">=</span> <span class="n">ratings_wc</span><span class="p">[(</span><span class="n">ratings_wc</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">wc_start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ratings_wc</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">wc_end</span><span class="p">)]</span>

<span class="n">ratings_wc</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[116]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>team</th>
      <th>date</th>
      <th>attack</th>
      <th>defence</th>
      <th>full_age</th>
      <th>midfield</th>
      <th>overall</th>
      <th>prestige</th>
      <th>start_age</th>
      <th>bup_speed</th>
      <th>...</th>
      <th>cc_passing</th>
      <th>cc_crossing</th>
      <th>cc_shooting</th>
      <th>d_pressure</th>
      <th>d_aggresion</th>
      <th>d_width</th>
      <th>wage_euros_thousands</th>
      <th>value_euros_millions</th>
      <th>growth</th>
      <th>goalkeeeper_overall</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Brazil</td>
      <td>2018-07-15 00:00:00+00:00</td>
      <td>87.0</td>
      <td>84.0</td>
      <td>27.43</td>
      <td>86.0</td>
      <td>86.0</td>
      <td>10.0</td>
      <td>27.55</td>
      <td>51.0</td>
      <td>...</td>
      <td>39.0</td>
      <td>33.0</td>
      <td>67.0</td>
      <td>76.0</td>
      <td>73.0</td>
      <td>63.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.62500</td>
      <td>84.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>England</td>
      <td>2018-07-15 00:00:00+00:00</td>
      <td>83.0</td>
      <td>80.0</td>
      <td>25.88</td>
      <td>81.0</td>
      <td>81.0</td>
      <td>8.0</td>
      <td>24.64</td>
      <td>36.0</td>
      <td>...</td>
      <td>31.0</td>
      <td>41.0</td>
      <td>41.0</td>
      <td>43.0</td>
      <td>55.0</td>
      <td>49.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.57500</td>
      <td>80.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Italy</td>
      <td>2018-07-15 00:00:00+00:00</td>
      <td>81.0</td>
      <td>82.0</td>
      <td>25.96</td>
      <td>81.0</td>
      <td>82.0</td>
      <td>9.0</td>
      <td>27.36</td>
      <td>73.0</td>
      <td>...</td>
      <td>64.0</td>
      <td>80.0</td>
      <td>78.0</td>
      <td>29.0</td>
      <td>26.0</td>
      <td>32.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.26087</td>
      <td>88.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Spain</td>
      <td>2018-07-15 00:00:00+00:00</td>
      <td>84.0</td>
      <td>85.0</td>
      <td>27.18</td>
      <td>86.0</td>
      <td>85.0</td>
      <td>9.0</td>
      <td>27.27</td>
      <td>32.0</td>
      <td>...</td>
      <td>27.0</td>
      <td>32.0</td>
      <td>20.0</td>
      <td>75.0</td>
      <td>62.0</td>
      <td>52.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.77500</td>
      <td>91.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>France</td>
      <td>2018-07-15 00:00:00+00:00</td>
      <td>86.0</td>
      <td>81.0</td>
      <td>25.05</td>
      <td>84.0</td>
      <td>85.0</td>
      <td>9.0</td>
      <td>24.82</td>
      <td>35.0</td>
      <td>...</td>
      <td>24.0</td>
      <td>53.0</td>
      <td>35.0</td>
      <td>47.0</td>
      <td>47.0</td>
      <td>67.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.45000</td>
      <td>87.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 22 columns</p>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [117]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ratings_teams_wc</span> <span class="o">=</span> <span class="n">ratings_wc</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [118]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#https://gitlab.com/djh_or/2018-world-cup-stats/blob/master/world_cup_2018_stats.csv</span>
<span class="n">results_wc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/world_cup_2018_stats.csv&quot;</span><span class="p">)</span>
<span class="n">results_wc</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[118]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Game</th>
      <th>Group</th>
      <th>Team</th>
      <th>Opponent</th>
      <th>Home/Away</th>
      <th>Score</th>
      <th>WDL</th>
      <th>Pens?</th>
      <th>Goals For</th>
      <th>Goals Against</th>
      <th>...</th>
      <th>Passes Completed</th>
      <th>Distance Covered km</th>
      <th>Balls recovered</th>
      <th>Tackles</th>
      <th>Blocks</th>
      <th>Clearances</th>
      <th>Yellow cards</th>
      <th>Red Cards</th>
      <th>Second Yellow Card leading to Red Card</th>
      <th>Fouls Committed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>A</td>
      <td>Russia</td>
      <td>Saudi Arabia</td>
      <td>home</td>
      <td>5-0</td>
      <td>W</td>
      <td>NaN</td>
      <td>5</td>
      <td>0</td>
      <td>...</td>
      <td>240</td>
      <td>118</td>
      <td>53</td>
      <td>9</td>
      <td>3</td>
      <td>19</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>22</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>A</td>
      <td>Saudi Arabia</td>
      <td>Russia</td>
      <td>away</td>
      <td>5-0</td>
      <td>L</td>
      <td>NaN</td>
      <td>0</td>
      <td>5</td>
      <td>...</td>
      <td>442</td>
      <td>105</td>
      <td>48</td>
      <td>16</td>
      <td>3</td>
      <td>31</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>10</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>A</td>
      <td>Egypt</td>
      <td>Uruguay</td>
      <td>home</td>
      <td>0-1</td>
      <td>L</td>
      <td>NaN</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>308</td>
      <td>112</td>
      <td>57</td>
      <td>12</td>
      <td>4</td>
      <td>32</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>12</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>A</td>
      <td>Uruguay</td>
      <td>Egypt</td>
      <td>away</td>
      <td>0-1</td>
      <td>W</td>
      <td>NaN</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>508</td>
      <td>111</td>
      <td>54</td>
      <td>8</td>
      <td>2</td>
      <td>22</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>B</td>
      <td>Morocco</td>
      <td>IR Iran</td>
      <td>home</td>
      <td>0-1</td>
      <td>L</td>
      <td>NaN</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>371</td>
      <td>101</td>
      <td>38</td>
      <td>9</td>
      <td>1</td>
      <td>16</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>22</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 32 columns</p>
</div></div>
</div>
<p>Before we proceed, let’s ensure that our country names match up
similarly.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [119]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># check that we found the corresponding team from team ratings in results</span>
<span class="c1"># but now we reverse it such that we try to find a rating and ranking for each wc team</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">results_wc</span><span class="o">.</span><span class="n">Team</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ratings_teams_wc</span> <span class="o">==</span> <span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cannot Find in Ratings </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">results_wc</span><span class="o">.</span><span class="n">Team</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">fifa_rankings</span><span class="o">.</span><span class="n">country_full</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="o">==</span> <span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cannot Find in Rankings </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Cannot Find in Ratings IR Iran
Cannot Find in Rankings IR Iran
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [120]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results_wc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;IR Iran&#39;</span><span class="p">,</span> <span class="s1">&#39;Iran&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [121]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">tournament_round</span> <span class="o">=</span> <span class="n">results_wc</span><span class="o">.</span><span class="n">Group</span>
<span class="n">results_wc</span> <span class="o">=</span> <span class="n">results_wc</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;Team&#39;</span><span class="p">,</span> <span class="s1">&#39;Opponent&#39;</span><span class="p">,</span> <span class="s1">&#39;WDL&#39;</span><span class="p">]]</span>
<span class="n">results_wc</span><span class="p">[</span><span class="s1">&#39;home_win&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">score</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">score</span> <span class="o">==</span> <span class="s1">&#39;W&#39;</span> <span class="k">else</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">results_wc</span><span class="o">.</span><span class="n">WDL</span><span class="p">]</span>
<span class="n">results_wc</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;WDL&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">results_wc</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[121]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Team</th>
      <th>Opponent</th>
      <th>home_win</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>123</th>
      <td>England</td>
      <td>Croatia</td>
      <td>0</td>
    </tr>
    <tr>
      <th>124</th>
      <td>Belgium</td>
      <td>England</td>
      <td>1</td>
    </tr>
    <tr>
      <th>125</th>
      <td>England</td>
      <td>Belgium</td>
      <td>0</td>
    </tr>
    <tr>
      <th>126</th>
      <td>France</td>
      <td>Croatia</td>
      <td>1</td>
    </tr>
    <tr>
      <th>127</th>
      <td>Croatia</td>
      <td>France</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Now we can match the ratings and rankings data to our test dataset as
well. We note that there might be some value in using the updated FIFA
ratings and rankings at each time of the match. However, for simplicity,
let’s just assume that teams have the same rating and rankings
throughout the tournament. We will take the rating and rankings at the
start of the tournament.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [122]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rankings_wc</span> <span class="o">=</span> <span class="n">fifa_rankings</span><span class="p">[</span><span class="n">fifa_rankings</span><span class="o">.</span><span class="n">rank_date</span> <span class="o">==</span> \
                            <span class="n">get_latest_date</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">wc_start</span><span class="p">),</span> <span class="n">fifa_rankings</span><span class="o">.</span><span class="n">rank_date</span><span class="p">)]</span>
<span class="n">results_rankings_wc1</span> <span class="o">=</span> <span class="n">results_wc</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">rankings_wc</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="s1">&#39;Team&#39;</span><span class="p">,</span> <span class="n">right_on</span> <span class="o">=</span> <span class="s1">&#39;country_full&#39;</span><span class="p">)</span>
<span class="n">results_rankings_wc2</span> <span class="o">=</span> <span class="n">results_rankings_wc1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">rankings_wc</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="s1">&#39;Opponent&#39;</span><span class="p">,</span>
                                                  <span class="n">right_on</span> <span class="o">=</span> <span class="s1">&#39;country_full&#39;</span><span class="p">)</span>
<span class="n">results_rankings_wc2</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[122]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Index([&#39;Team&#39;, &#39;Opponent&#39;, &#39;home_win&#39;, &#39;rank_x&#39;, &#39;country_full_x&#39;,
       &#39;country_abrv_x&#39;, &#39;total_points_x&#39;, &#39;previous_points_x&#39;,
       &#39;rank_change_x&#39;, &#39;cur_year_avg_x&#39;, &#39;cur_year_avg_weighted_x&#39;,
       &#39;last_year_avg_x&#39;, &#39;last_year_avg_weighted_x&#39;, &#39;two_year_ago_avg_x&#39;,
       &#39;two_year_ago_weighted_x&#39;, &#39;three_year_ago_avg_x&#39;,
       &#39;three_year_ago_weighted_x&#39;, &#39;confederation_x&#39;, &#39;rank_date_x&#39;, &#39;rank_y&#39;,
       &#39;country_full_y&#39;, &#39;country_abrv_y&#39;, &#39;total_points_y&#39;,
       &#39;previous_points_y&#39;, &#39;rank_change_y&#39;, &#39;cur_year_avg_y&#39;,
       &#39;cur_year_avg_weighted_y&#39;, &#39;last_year_avg_y&#39;,
       &#39;last_year_avg_weighted_y&#39;, &#39;two_year_ago_avg_y&#39;,
       &#39;two_year_ago_weighted_y&#39;, &#39;three_year_ago_avg_y&#39;,
       &#39;three_year_ago_weighted_y&#39;, &#39;confederation_y&#39;, &#39;rank_date_y&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [123]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># drop useless columns</span>
<span class="n">results_rankings_wc3</span> <span class="o">=</span> <span class="n">results_rankings_wc2</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Team&#39;</span><span class="p">,</span> <span class="s1">&#39;Opponent&#39;</span><span class="p">,</span><span class="s1">&#39;country_full_x&#39;</span><span class="p">,</span> <span class="s1">&#39;rank_date_y&#39;</span><span class="p">,</span> <span class="s1">&#39;country_full_y&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;rank_date_x&#39;</span><span class="p">,</span> <span class="s1">&#39;confederation_x&#39;</span><span class="p">,</span> <span class="s1">&#39;confederation_y&#39;</span><span class="p">,</span> <span class="s1">&#39;country_abrv_x&#39;</span><span class="p">,</span> <span class="s1">&#39;country_abrv_y&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># reorder columns</span>
<span class="n">results_rankings_wc3</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">results_rankings_wc3</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[123]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cur_year_avg_weighted_x</th>
      <th>cur_year_avg_weighted_y</th>
      <th>cur_year_avg_x</th>
      <th>cur_year_avg_y</th>
      <th>home_win</th>
      <th>last_year_avg_weighted_x</th>
      <th>last_year_avg_weighted_y</th>
      <th>last_year_avg_x</th>
      <th>last_year_avg_y</th>
      <th>previous_points_x</th>
      <th>...</th>
      <th>three_year_ago_avg_x</th>
      <th>three_year_ago_avg_y</th>
      <th>three_year_ago_weighted_x</th>
      <th>three_year_ago_weighted_y</th>
      <th>total_points_x</th>
      <th>total_points_y</th>
      <th>two_year_ago_avg_x</th>
      <th>two_year_ago_avg_y</th>
      <th>two_year_ago_weighted_x</th>
      <th>two_year_ago_weighted_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>166.07</td>
      <td>143.89</td>
      <td>166.07</td>
      <td>143.89</td>
      <td>1</td>
      <td>108.09</td>
      <td>180.10</td>
      <td>216.18</td>
      <td>360.20</td>
      <td>493</td>
      <td>...</td>
      <td>368.50</td>
      <td>135.09</td>
      <td>73.70</td>
      <td>27.02</td>
      <td>456.53</td>
      <td>465.28</td>
      <td>362.25</td>
      <td>380.91</td>
      <td>108.68</td>
      <td>114.27</td>
    </tr>
    <tr>
      <th>1</th>
      <td>143.89</td>
      <td>166.07</td>
      <td>143.89</td>
      <td>166.07</td>
      <td>0</td>
      <td>180.10</td>
      <td>108.09</td>
      <td>360.20</td>
      <td>216.18</td>
      <td>462</td>
      <td>...</td>
      <td>135.09</td>
      <td>368.50</td>
      <td>27.02</td>
      <td>73.70</td>
      <td>465.28</td>
      <td>456.53</td>
      <td>380.91</td>
      <td>362.25</td>
      <td>114.27</td>
      <td>108.68</td>
    </tr>
    <tr>
      <th>2</th>
      <td>208.27</td>
      <td>486.28</td>
      <td>208.27</td>
      <td>486.28</td>
      <td>0</td>
      <td>291.04</td>
      <td>243.84</td>
      <td>582.07</td>
      <td>487.69</td>
      <td>636</td>
      <td>...</td>
      <td>253.18</td>
      <td>599.26</td>
      <td>50.64</td>
      <td>119.85</td>
      <td>649.43</td>
      <td>1018.41</td>
      <td>331.62</td>
      <td>561.47</td>
      <td>99.48</td>
      <td>168.44</td>
    </tr>
    <tr>
      <th>3</th>
      <td>486.28</td>
      <td>208.27</td>
      <td>486.28</td>
      <td>208.27</td>
      <td>1</td>
      <td>243.84</td>
      <td>291.04</td>
      <td>487.69</td>
      <td>582.07</td>
      <td>976</td>
      <td>...</td>
      <td>599.26</td>
      <td>253.18</td>
      <td>119.85</td>
      <td>50.64</td>
      <td>1018.41</td>
      <td>649.43</td>
      <td>561.47</td>
      <td>331.62</td>
      <td>168.44</td>
      <td>99.48</td>
    </tr>
    <tr>
      <th>4</th>
      <td>369.10</td>
      <td>290.29</td>
      <td>369.10</td>
      <td>290.29</td>
      <td>0</td>
      <td>172.65</td>
      <td>246.02</td>
      <td>345.29</td>
      <td>492.04</td>
      <td>681</td>
      <td>...</td>
      <td>170.43</td>
      <td>398.22</td>
      <td>34.09</td>
      <td>79.64</td>
      <td>685.86</td>
      <td>708.35</td>
      <td>366.78</td>
      <td>308.01</td>
      <td>110.03</td>
      <td>92.40</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 25 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [124]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">diff_rankings_wc</span> <span class="o">=</span> <span class="n">results_rankings_wc3</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;home_win&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">diff_rankings_wc</span> <span class="o">=</span> <span class="n">diff_rankings_wc</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ncol_wc</span> <span class="o">=</span> <span class="n">diff_rankings_wc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># we only want every alternate column</span>
<span class="n">diff_rankings_wc</span> <span class="o">=</span> <span class="n">diff_rankings_wc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ncol_wc</span><span class="p">,</span> <span class="mi">2</span><span class="p">))]</span>

<span class="c1"># we want our statistics to be from perspective of home teams</span>
<span class="n">diff_rankings_wc</span> <span class="o">=</span> <span class="n">diff_rankings_wc</span><span class="o">*-</span><span class="mi">1</span>

<span class="n">diff_rankings_wc</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_diff&#39;</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">diff_rankings_wc</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
<span class="n">diff_rankings_wc</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[124]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cur_year_avg_weighted_diff</th>
      <th>cur_year_avg_diff</th>
      <th>last_year_avg_weighted_diff</th>
      <th>last_year_avg_diff</th>
      <th>previous_points_diff</th>
      <th>rank_change_diff</th>
      <th>rank_diff</th>
      <th>three_year_ago_avg_diff</th>
      <th>three_year_ago_weighted_diff</th>
      <th>total_points_diff</th>
      <th>two_year_ago_avg_diff</th>
      <th>two_year_ago_weighted_diff</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>22.18</td>
      <td>22.18</td>
      <td>-72.01</td>
      <td>-144.02</td>
      <td>31.0</td>
      <td>-4.0</td>
      <td>3.0</td>
      <td>233.41</td>
      <td>46.68</td>
      <td>-8.75</td>
      <td>-18.66</td>
      <td>-5.59</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-22.18</td>
      <td>-22.18</td>
      <td>72.01</td>
      <td>144.02</td>
      <td>-31.0</td>
      <td>4.0</td>
      <td>-3.0</td>
      <td>-233.41</td>
      <td>-46.68</td>
      <td>8.75</td>
      <td>18.66</td>
      <td>5.59</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-278.01</td>
      <td>-278.01</td>
      <td>47.20</td>
      <td>94.38</td>
      <td>-340.0</td>
      <td>-2.0</td>
      <td>31.0</td>
      <td>-346.08</td>
      <td>-69.21</td>
      <td>-368.98</td>
      <td>-229.85</td>
      <td>-68.96</td>
    </tr>
    <tr>
      <th>3</th>
      <td>278.01</td>
      <td>278.01</td>
      <td>-47.20</td>
      <td>-94.38</td>
      <td>340.0</td>
      <td>2.0</td>
      <td>-31.0</td>
      <td>346.08</td>
      <td>69.21</td>
      <td>368.98</td>
      <td>229.85</td>
      <td>68.96</td>
    </tr>
    <tr>
      <th>4</th>
      <td>78.81</td>
      <td>78.81</td>
      <td>-73.37</td>
      <td>-146.75</td>
      <td>-46.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>-227.79</td>
      <td>-45.55</td>
      <td>-22.49</td>
      <td>58.77</td>
      <td>17.63</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [125]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ratings_wc_start</span> <span class="o">=</span> <span class="n">ratings_wc</span><span class="p">[</span><span class="n">ratings_wc</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">wc_start</span><span class="p">]</span>

<span class="c1"># merge ratings with results table</span>
<span class="n">results_ratings_wc1</span> <span class="o">=</span> <span class="n">results_wc</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ratings_wc_start</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                     <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;Team&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;team&#39;</span><span class="p">)</span>
<span class="n">results_ratings_wc2</span> <span class="o">=</span> <span class="n">results_ratings_wc1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ratings_wc_start</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                             <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;Opponent&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;team&#39;</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [126]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># drop useless columns</span>
<span class="n">results_ratings_wc3</span> <span class="o">=</span> <span class="n">results_ratings_wc2</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Team&#39;</span><span class="p">,</span> <span class="s1">&#39;Opponent&#39;</span><span class="p">,</span> <span class="s1">&#39;team_x&#39;</span><span class="p">,</span> <span class="s1">&#39;team_y&#39;</span><span class="p">,</span> <span class="s1">&#39;date_y&#39;</span><span class="p">,</span> <span class="s1">&#39;date_x&#39;</span><span class="p">],</span>
                         <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># reorder columns</span>
<span class="n">results_ratings_wc3</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">results_ratings_wc3</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[126]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>attack_x</th>
      <th>attack_y</th>
      <th>bup_dribbling_x</th>
      <th>bup_dribbling_y</th>
      <th>bup_passing_x</th>
      <th>bup_passing_y</th>
      <th>bup_speed_x</th>
      <th>bup_speed_y</th>
      <th>cc_crossing_x</th>
      <th>cc_crossing_y</th>
      <th>...</th>
      <th>overall_x</th>
      <th>overall_y</th>
      <th>prestige_x</th>
      <th>prestige_y</th>
      <th>start_age_x</th>
      <th>start_age_y</th>
      <th>value_euros_millions_x</th>
      <th>value_euros_millions_y</th>
      <th>wage_euros_thousands_x</th>
      <th>wage_euros_thousands_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>80.0</td>
      <td>71.0</td>
      <td>77.0</td>
      <td>68.0</td>
      <td>49.0</td>
      <td>66.0</td>
      <td>50.0</td>
      <td>69.0</td>
      <td>37.0</td>
      <td>48.0</td>
      <td>...</td>
      <td>79.0</td>
      <td>72.0</td>
      <td>6.0</td>
      <td>4.0</td>
      <td>27.82</td>
      <td>28.00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>71.0</td>
      <td>80.0</td>
      <td>68.0</td>
      <td>77.0</td>
      <td>66.0</td>
      <td>49.0</td>
      <td>69.0</td>
      <td>50.0</td>
      <td>48.0</td>
      <td>37.0</td>
      <td>...</td>
      <td>72.0</td>
      <td>79.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>28.00</td>
      <td>27.82</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>72.0</td>
      <td>86.0</td>
      <td>34.0</td>
      <td>42.0</td>
      <td>49.0</td>
      <td>36.0</td>
      <td>52.0</td>
      <td>38.0</td>
      <td>64.0</td>
      <td>43.0</td>
      <td>...</td>
      <td>76.0</td>
      <td>80.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>27.64</td>
      <td>26.09</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>86.0</td>
      <td>72.0</td>
      <td>42.0</td>
      <td>34.0</td>
      <td>36.0</td>
      <td>49.0</td>
      <td>38.0</td>
      <td>52.0</td>
      <td>43.0</td>
      <td>64.0</td>
      <td>...</td>
      <td>80.0</td>
      <td>76.0</td>
      <td>7.0</td>
      <td>5.0</td>
      <td>26.09</td>
      <td>27.64</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>72.0</td>
      <td>79.0</td>
      <td>52.0</td>
      <td>67.0</td>
      <td>38.0</td>
      <td>69.0</td>
      <td>38.0</td>
      <td>69.0</td>
      <td>58.0</td>
      <td>37.0</td>
      <td>...</td>
      <td>76.0</td>
      <td>74.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>26.55</td>
      <td>26.27</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 41 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [127]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ratings_base_wc</span> <span class="o">=</span> <span class="n">results_ratings_wc3</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;home_win&#39;</span><span class="p">]]</span>
<span class="n">ratings_base_wc</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[127]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>home_win</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [128]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">diff_ratings_wc</span> <span class="o">=</span> <span class="n">results_ratings_wc3</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;home_win&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">diff_ratings_wc</span> <span class="o">=</span> <span class="n">diff_ratings_wc</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ncol_wc</span> <span class="o">=</span> <span class="n">diff_ratings_wc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># we only want every alternate column</span>
<span class="n">diff_ratings_wc</span> <span class="o">=</span> <span class="n">diff_ratings_wc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ncol_wc</span><span class="p">,</span> <span class="mi">2</span><span class="p">))]</span>

<span class="c1"># we want our statistics to be from perspective of home teams</span>
<span class="n">diff_ratings_wc</span> <span class="o">=</span> <span class="n">diff_ratings_wc</span><span class="o">*-</span><span class="mi">1</span>
<span class="n">diff_ratings_wc</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_diff&#39;</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">diff_ratings_wc</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

<span class="c1">#Also want difference in attack of one team and defense of the other</span>
<span class="n">diff_ratings_wc</span><span class="p">[</span><span class="s1">&#39;attack_home_defence_away_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_ratings_wc3</span><span class="p">[</span><span class="s1">&#39;attack_x&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">results_ratings_wc3</span><span class="p">[</span><span class="s1">&#39;defence_y&#39;</span><span class="p">]</span>
<span class="n">diff_ratings_wc</span><span class="p">[</span><span class="s1">&#39;attack_away_defence_home_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_ratings_wc3</span><span class="p">[</span><span class="s1">&#39;attack_y&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">results_ratings_wc3</span><span class="p">[</span><span class="s1">&#39;defence_x&#39;</span><span class="p">]</span>

<span class="n">diff_ratings_wc</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[128]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>attack_diff</th>
      <th>bup_dribbling_diff</th>
      <th>bup_passing_diff</th>
      <th>bup_speed_diff</th>
      <th>cc_crossing_diff</th>
      <th>cc_passing_diff</th>
      <th>cc_shooting_diff</th>
      <th>d_aggresion_diff</th>
      <th>d_pressure_diff</th>
      <th>d_width_diff</th>
      <th>...</th>
      <th>goalkeeeper_overall_diff</th>
      <th>growth_diff</th>
      <th>midfield_diff</th>
      <th>overall_diff</th>
      <th>prestige_diff</th>
      <th>start_age_diff</th>
      <th>value_euros_millions_diff</th>
      <th>wage_euros_thousands_diff</th>
      <th>attack_home_defence_away_diff</th>
      <th>attack_away_defence_home_diff</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>9.0</td>
      <td>9.0</td>
      <td>-17.0</td>
      <td>-19.0</td>
      <td>-11.0</td>
      <td>-9.0</td>
      <td>-27.0</td>
      <td>1.0</td>
      <td>-0.0</td>
      <td>-17.0</td>
      <td>...</td>
      <td>11.0</td>
      <td>-0.000</td>
      <td>6.0</td>
      <td>7.0</td>
      <td>2.0</td>
      <td>-0.18</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>9.0</td>
      <td>-6.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-9.0</td>
      <td>-9.0</td>
      <td>17.0</td>
      <td>19.0</td>
      <td>11.0</td>
      <td>9.0</td>
      <td>27.0</td>
      <td>-1.0</td>
      <td>-0.0</td>
      <td>17.0</td>
      <td>...</td>
      <td>-11.0</td>
      <td>-0.000</td>
      <td>-6.0</td>
      <td>-7.0</td>
      <td>-2.0</td>
      <td>0.18</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-6.0</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-14.0</td>
      <td>-8.0</td>
      <td>13.0</td>
      <td>14.0</td>
      <td>21.0</td>
      <td>25.0</td>
      <td>-12.0</td>
      <td>-9.0</td>
      <td>-0.0</td>
      <td>-30.0</td>
      <td>...</td>
      <td>-15.0</td>
      <td>-0.425</td>
      <td>-0.0</td>
      <td>-4.0</td>
      <td>-2.0</td>
      <td>1.55</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-7.0</td>
      <td>12.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>14.0</td>
      <td>8.0</td>
      <td>-13.0</td>
      <td>-14.0</td>
      <td>-21.0</td>
      <td>-25.0</td>
      <td>12.0</td>
      <td>9.0</td>
      <td>-0.0</td>
      <td>30.0</td>
      <td>...</td>
      <td>15.0</td>
      <td>0.425</td>
      <td>-0.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>-1.55</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>12.0</td>
      <td>-7.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-7.0</td>
      <td>-15.0</td>
      <td>-31.0</td>
      <td>-31.0</td>
      <td>21.0</td>
      <td>-9.0</td>
      <td>-9.0</td>
      <td>9.0</td>
      <td>17.0</td>
      <td>46.0</td>
      <td>...</td>
      <td>-3.0</td>
      <td>-0.175</td>
      <td>6.0</td>
      <td>2.0</td>
      <td>-0.0</td>
      <td>0.28</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 22 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [129]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="c1"># compile datframe</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ratings_base_wc</span><span class="p">,</span> <span class="n">diff_ratings_wc</span><span class="p">,</span> <span class="n">diff_rankings_wc</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#Assert columns of train and test are in same order</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">test</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[129]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>home_win</th>
      <th>attack_diff</th>
      <th>bup_dribbling_diff</th>
      <th>bup_passing_diff</th>
      <th>bup_speed_diff</th>
      <th>cc_crossing_diff</th>
      <th>cc_passing_diff</th>
      <th>cc_shooting_diff</th>
      <th>d_aggresion_diff</th>
      <th>d_pressure_diff</th>
      <th>...</th>
      <th>last_year_avg_weighted_diff</th>
      <th>last_year_avg_diff</th>
      <th>previous_points_diff</th>
      <th>rank_change_diff</th>
      <th>rank_diff</th>
      <th>three_year_ago_avg_diff</th>
      <th>three_year_ago_weighted_diff</th>
      <th>total_points_diff</th>
      <th>two_year_ago_avg_diff</th>
      <th>two_year_ago_weighted_diff</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>9.0</td>
      <td>9.0</td>
      <td>-17.0</td>
      <td>-19.0</td>
      <td>-11.0</td>
      <td>-9.0</td>
      <td>-27.0</td>
      <td>1.0</td>
      <td>-0.0</td>
      <td>...</td>
      <td>-72.01</td>
      <td>-144.02</td>
      <td>31.0</td>
      <td>-4.0</td>
      <td>3.0</td>
      <td>233.41</td>
      <td>46.68</td>
      <td>-8.75</td>
      <td>-18.66</td>
      <td>-5.59</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>-9.0</td>
      <td>-9.0</td>
      <td>17.0</td>
      <td>19.0</td>
      <td>11.0</td>
      <td>9.0</td>
      <td>27.0</td>
      <td>-1.0</td>
      <td>-0.0</td>
      <td>...</td>
      <td>72.01</td>
      <td>144.02</td>
      <td>-31.0</td>
      <td>4.0</td>
      <td>-3.0</td>
      <td>-233.41</td>
      <td>-46.68</td>
      <td>8.75</td>
      <td>18.66</td>
      <td>5.59</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>-14.0</td>
      <td>-8.0</td>
      <td>13.0</td>
      <td>14.0</td>
      <td>21.0</td>
      <td>25.0</td>
      <td>-12.0</td>
      <td>-9.0</td>
      <td>-0.0</td>
      <td>...</td>
      <td>47.20</td>
      <td>94.38</td>
      <td>-340.0</td>
      <td>-2.0</td>
      <td>31.0</td>
      <td>-346.08</td>
      <td>-69.21</td>
      <td>-368.98</td>
      <td>-229.85</td>
      <td>-68.96</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>14.0</td>
      <td>8.0</td>
      <td>-13.0</td>
      <td>-14.0</td>
      <td>-21.0</td>
      <td>-25.0</td>
      <td>12.0</td>
      <td>9.0</td>
      <td>-0.0</td>
      <td>...</td>
      <td>-47.20</td>
      <td>-94.38</td>
      <td>340.0</td>
      <td>2.0</td>
      <td>-31.0</td>
      <td>346.08</td>
      <td>69.21</td>
      <td>368.98</td>
      <td>229.85</td>
      <td>68.96</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>-7.0</td>
      <td>-15.0</td>
      <td>-31.0</td>
      <td>-31.0</td>
      <td>21.0</td>
      <td>-9.0</td>
      <td>-9.0</td>
      <td>9.0</td>
      <td>17.0</td>
      <td>...</td>
      <td>-73.37</td>
      <td>-146.75</td>
      <td>-46.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>-227.79</td>
      <td>-45.55</td>
      <td>-22.49</td>
      <td>58.77</td>
      <td>17.63</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 35 columns</p>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [130]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;Group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tournament_round</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [131]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#get rid of even rows since same match as odd rows.</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">test</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [133]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># save to csv</span>
<span class="n">test</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;data/test_team.csv&quot;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2018, Brian Lin, Shane Ong, Pat Sukhum, Matteo Zhang.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>