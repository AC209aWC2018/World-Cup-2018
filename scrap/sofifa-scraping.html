<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Web Scraping &#8212; World Cup  documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          World Cup</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption"><span class="caption-text">Introduction:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/problem_statement.html">Overview and Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/related_works.html">Literature Review and Related Works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/data_description.html">Description of Data</a></li>
</ul>
<p class="caption"><span class="caption-text">EDA:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../EDA-notebook.html">Exploratory Data Analysis</a></li>
</ul>
<p class="caption"><span class="caption-text">Models:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../models/baseline_model.html">Baseline Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/beyond_baseline.html">Modeling with Feature Engineered Features</a></li>
</ul>
<p class="caption"><span class="caption-text">Conclusion:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/summary.html">Summary and Future Work</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Web Scraping</a></li>
<li><a class="reference internal" href="#still-does-not-sort-teams-and-clubs-correctly">still does not sort teams and clubs correctly</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/scrap/sofifa-scraping.ipynb.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 9ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }
</style>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="k">import</span> <span class="n">BeautifulSoup</span><span class="p">,</span> <span class="n">Comment</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="k">import</span> <span class="n">Path</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;fivethirtyeight&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s1">&#39;notebook&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Web-Scraping">
<h1>Web Scraping<a class="headerlink" href="#Web-Scraping" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://sofifa.com">https://sofifa.com</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># referenced from https://realpython.com/python-web-scraping-practical-introduction/</span>
<span class="k">def</span> <span class="nf">simple_get</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attempts to scrape the content at &#39;url&#39; by making a HTTP GET request.</span>
<span class="sd">    If the content-type of the response is some kind of HTML/XML, return the</span>
<span class="sd">    text content, otherwise return None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">requests</span>
    <span class="kn">from</span> <span class="nn">contextlib</span> <span class="k">import</span> <span class="n">closing</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">closing</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_good_response</span><span class="p">(</span><span class="n">resp</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">content</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in scraping of url&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">is_good_response</span><span class="p">(</span><span class="n">resp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns True if response is some kind of HTML/XML</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
           <span class="ow">and</span> <span class="n">content_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
           <span class="ow">and</span> <span class="n">content_type</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Find all the href attributes for each national team</span>

<span class="k">def</span> <span class="nf">get_nation_href</span><span class="p">(</span><span class="n">date_url</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a date url corresponding to a specific update of FIFA 18, returns a dictionary</span>
<span class="sd">    containing the teams and their hrefs&quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://sofifa.com/teams/national&#39;</span><span class="o">+</span><span class="n">date_url</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">simple_get</span><span class="p">(</span><span class="n">url</span><span class="p">),</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>

    <span class="n">teams_href</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">html</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;href&#39;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^/team/.+&quot;</span><span class="p">)}):</span>
        <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">teams_href</span><span class="p">:</span>
            <span class="n">teams_href</span><span class="p">[</span><span class="n">link</span><span class="o">.</span><span class="n">get_text</span><span class="p">()]</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">teams_href</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">teams_href</span> <span class="o">=</span> <span class="n">get_nation_href</span><span class="p">(</span><span class="s1">&#39;?v=WC18&amp;e=159126&amp;set=true&#39;</span><span class="p">)</span> <span class="c1"># corresponds to FIFA WC18 Expansion Jun 16</span>
</pre></div>
</div>
</div>
<p>We now have the urls of all the national teams. We note that the current
urls link to the most recent ratings of the teams. We can find the urls
of all players in the national teams from this page as well. We start by
collecting the urls of all players in the national teams.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">get_players_href</span><span class="p">(</span><span class="n">teams_href</span><span class="p">,</span> <span class="n">date_url</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a dictionary of team hrefs and names and a segment of a date url, corresponding to a specific update of FIFA 18</span>
<span class="sd">    returns a dictionary containing the original href, a list of all players in the team, and a list of all</span>
<span class="sd">    players href in the team, for all teams&quot;&quot;&quot;</span>
    <span class="n">teams</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">team</span><span class="p">,</span> <span class="n">href</span> <span class="ow">in</span> <span class="n">teams_href</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">url_team</span> <span class="o">=</span> <span class="s1">&#39;https://sofifa.com&#39;</span><span class="o">+</span><span class="n">href</span><span class="o">+</span><span class="n">date_url</span>
        <span class="n">html_team</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">simple_get</span><span class="p">(</span><span class="n">url_team</span><span class="p">),</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>

        <span class="n">player_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">player_href_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">html_team</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;href&#39;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^/player/.+&quot;</span><span class="p">)}):</span>
            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">player_href_list</span><span class="p">:</span>
                <span class="n">player_href_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">player_list</span><span class="p">:</span>
                <span class="n">player_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>

        <span class="n">teams</span><span class="p">[</span><span class="n">team</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;href&#39;</span><span class="p">:</span> <span class="n">href</span><span class="p">,</span>
                       <span class="s1">&#39;players&#39;</span><span class="p">:</span> <span class="n">player_list</span><span class="p">,</span>
                       <span class="s1">&#39;players_href&#39;</span><span class="p">:</span> <span class="n">player_href_list</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">teams</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">teams</span> <span class="o">=</span> <span class="n">get_players_href</span><span class="p">(</span><span class="n">teams_href</span><span class="p">,</span> <span class="s1">&#39;?v=WC18&amp;e=159126&amp;set=true&#39;</span><span class="p">)</span> <span class="c1"># corresponds to FIFA WC18 Expansion Jun 16</span>
</pre></div>
</div>
</div>
<p>Now that we have the urls to all the players in the national teams, we
can collect the individual player data. We will collect the key
summarized data for now.</p>
<p>url_player =
‘<a class="reference external" href="https://sofifa.com/player/231747/kylian-mbappe/">https://sofifa.com/player/231747/kylian-mbappe/</a>’+‘?v=18&amp;e=159124&amp;set=true’
html_player = BeautifulSoup(simple_get(url_player), ‘html.parser’)
club_nation = html_player.find_all(‘figure’, attrs={‘class’: “avatar
avatar-sm”}) club_nation[0].find_next(‘a’, attrs={‘href’:
re.compile(“^/team/.*”)}).find_next(‘span’).get_text()</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="c1"># still does not sort teams and clubs correctly</span>
<span class="k">def</span> <span class="nf">get_players</span><span class="p">(</span><span class="n">teams</span><span class="p">,</span> <span class="n">date_url</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given the output dictionary from get_players_href,</span>
<span class="sd">    and a segment of a date url, corresponding to a specific update of FIFA 18,</span>
<span class="sd">    returns a dataframe containing the summary data for each player in the teams&quot;&quot;&quot;</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tname</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">teams</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">player_href</span> <span class="o">=</span> <span class="n">teams</span><span class="p">[</span><span class="n">tname</span><span class="p">][</span><span class="s1">&#39;players_href&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">player</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">player_href</span><span class="p">):</span>
            <span class="n">url_player</span> <span class="o">=</span> <span class="s1">&#39;https://sofifa.com&#39;</span><span class="o">+</span><span class="n">player</span><span class="o">+</span><span class="n">date_url</span>
            <span class="n">html_player</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">simple_get</span><span class="p">(</span><span class="n">url_player</span><span class="p">),</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>

            <span class="n">h1</span> <span class="o">=</span> <span class="n">html_player</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">)</span>

            <span class="n">name_id</span> <span class="o">=</span> <span class="n">h1</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ID</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\((.+)\)&#39;</span><span class="p">,</span> <span class="n">name_id</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">full_name</span> <span class="o">=</span> <span class="n">h1</span><span class="o">.</span><span class="n">find_next</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">next_element</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="c1"># account for multiple preferred positions</span>
            <span class="n">position</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">h1</span><span class="o">.</span><span class="n">find_next</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">):</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; &#39;</span>
                <span class="n">position</span> <span class="o">+=</span> <span class="n">pos</span>
            <span class="n">position</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="n">age</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Age (\d+) .+&#39;</span> <span class="p">,</span> <span class="n">h1</span><span class="o">.</span><span class="n">find_next</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">next_sibling</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># account for +/- signs</span>
            <span class="n">span</span> <span class="o">=</span> <span class="n">html_player</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;card-body stats&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">)</span>
            <span class="n">span_label</span> <span class="o">=</span> <span class="p">(</span><span class="n">html_player</span>
                          <span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;card-body stats&#39;</span><span class="p">})</span>
                          <span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;label.+&quot;</span><span class="p">)}))</span>

            <span class="n">overall</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">span_label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
            <span class="n">potential</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">span_label</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">span</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
            <span class="n">wage</span> <span class="o">=</span> <span class="n">span</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>

            <span class="c1"># account for different order of clubs and national teams</span>
            <span class="n">club_nation</span> <span class="o">=</span> <span class="n">html_player</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s2">&quot;avatar avatar-sm&quot;</span><span class="p">})</span>
            <span class="n">cn0</span> <span class="o">=</span> <span class="n">club_nation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find_next</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;href&#39;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^/team/.*&quot;</span><span class="p">)})</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">club_nation</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cn1</span> <span class="o">=</span> <span class="n">club_nation</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find_next</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;href&#39;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^/team/.*&quot;</span><span class="p">)})</span>
                <span class="k">if</span> <span class="n">cn0</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="o">==</span> <span class="n">tname</span><span class="p">:</span>
                    <span class="n">club</span> <span class="o">=</span> <span class="n">cn1</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
                    <span class="n">club_rating</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cn1</span><span class="o">.</span><span class="n">find_next</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
                    <span class="n">team</span> <span class="o">=</span> <span class="n">cn0</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
                    <span class="n">team_rating</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cn0</span><span class="o">.</span><span class="n">find_next</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">club</span> <span class="o">=</span> <span class="n">cn0</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
                    <span class="n">club_rating</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cn0</span><span class="o">.</span><span class="n">find_next</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
                    <span class="n">team</span> <span class="o">=</span> <span class="n">cn1</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
                    <span class="n">team_rating</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cn1</span><span class="o">.</span><span class="n">find_next</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cn0</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="o">==</span> <span class="n">tname</span><span class="p">:</span>
                    <span class="n">club</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">club_rating</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">team</span> <span class="o">=</span> <span class="n">cn0</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
                    <span class="n">team_rating</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cn0</span><span class="o">.</span><span class="n">find_next</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">club</span> <span class="o">=</span> <span class="n">cn0</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
                    <span class="n">club_rating</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cn0</span><span class="o">.</span><span class="n">find_next</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
                    <span class="n">team</span> <span class="o">=</span> <span class="n">tname</span>
                    <span class="n">team_rating</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>


            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ID</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">full_name</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span>
                   <span class="n">age</span><span class="p">,</span> <span class="n">overall</span><span class="p">,</span> <span class="n">potential</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span>
                   <span class="n">wage</span><span class="p">,</span> <span class="n">club</span><span class="p">,</span> <span class="n">club_rating</span><span class="p">,</span> <span class="n">team</span><span class="p">,</span> <span class="n">team_rating</span><span class="p">])</span>

    <span class="n">summary_dat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;full_name&#39;</span><span class="p">,</span> <span class="s1">&#39;position&#39;</span><span class="p">,</span>
                                                 <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;overall&#39;</span><span class="p">,</span> <span class="s1">&#39;potential&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span>
                                                 <span class="s1">&#39;wage&#39;</span><span class="p">,</span> <span class="s1">&#39;club&#39;</span><span class="p">,</span> <span class="s1">&#39;club_rating&#39;</span><span class="p">,</span> <span class="s1">&#39;team&#39;</span><span class="p">,</span> <span class="s1">&#39;team_rating&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">summary_dat</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="still-does-not-sort-teams-and-clubs-correctly">
<h1>still does not sort teams and clubs correctly<a class="headerlink" href="#still-does-not-sort-teams-and-clubs-correctly" title="Permalink to this headline">¶</a></h1>
<p>def get_players(teams, date_url): “”“Given the output dictionary from
get_players_href,
and a segment of a date url, corresponding to a specific update of FIFA
18, returns a dataframe containing the summary data for each player in
the teams””” summary = [] for tname, _ in teams.items(): player_href =
teams[tname][‘players_href’] for i, player in enumerate(player_href):
url_player = ‘<a class="reference external" href="https://sofifa.com">https://sofifa.com</a>’+player+date_url html_player =
BeautifulSoup(simple_get(url_player), ‘html.parser’)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">h1</span> <span class="o">=</span> <span class="n">html_player</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">)</span>

        <span class="n">name_id</span> <span class="o">=</span> <span class="n">h1</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ID</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\((.+)\)&#39;</span><span class="p">,</span> <span class="n">name_id</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">full_name</span> <span class="o">=</span> <span class="n">h1</span><span class="o">.</span><span class="n">find_next</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">next_element</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># account for multiple preferred positions</span>
        <span class="n">position</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">h1</span><span class="o">.</span><span class="n">find_next</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">):</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; &#39;</span>
            <span class="n">position</span> <span class="o">+=</span> <span class="n">pos</span>
        <span class="n">position</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="n">age</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Age (\d+) .+&#39;</span> <span class="p">,</span> <span class="n">h1</span><span class="o">.</span><span class="n">find_next</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">next_sibling</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># account for +/- signs</span>
        <span class="n">span</span> <span class="o">=</span> <span class="n">html_player</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;card-body stats&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">)</span>
        <span class="n">span_label</span> <span class="o">=</span> <span class="p">(</span><span class="n">html_player</span>
                      <span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;card-body stats&#39;</span><span class="p">})</span>
                      <span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;label.+&quot;</span><span class="p">)}))</span>

        <span class="n">overall</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">span_label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
        <span class="n">potential</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">span_label</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">span</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
        <span class="n">wage</span> <span class="o">=</span> <span class="n">span</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>

        <span class="c1"># account for different order of clubs and national teams</span>
        <span class="n">club_nation</span> <span class="o">=</span> <span class="n">html_player</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;href&#39;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^/team/.*&quot;</span><span class="p">)})</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">club_nation</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">club_nation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="o">==</span> <span class="n">tname</span><span class="p">:</span>
                <span class="c1"># account for players who are on loan. they will have 4 teams</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">club_nation</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># account for players who are on loan. they will have 4 teams</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">club_nation</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="mi">2</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">club</span> <span class="o">=</span> <span class="n">club_nation</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
            <span class="n">club_rating</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">club_nation</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">find_next</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
            <span class="n">team</span> <span class="o">=</span> <span class="n">club_nation</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
            <span class="n">team_rating</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">club_nation</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">find_next</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">club_nation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="o">==</span> <span class="n">tname</span><span class="p">:</span>
                <span class="n">club</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">club_rating</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">team</span> <span class="o">=</span> <span class="n">club_nation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
                <span class="n">team_rating</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">club_nation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find_next</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">club</span> <span class="o">=</span> <span class="n">club_nation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
                <span class="n">club_rating</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">club_nation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find_next</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>
                <span class="n">team</span> <span class="o">=</span> <span class="n">tname</span>
                <span class="n">team_rating</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="c1"># note that we can impute this later even though the webpage does not have this</span>

        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ID</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">full_name</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span>
               <span class="n">age</span><span class="p">,</span> <span class="n">overall</span><span class="p">,</span> <span class="n">potential</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span>
               <span class="n">wage</span><span class="p">,</span> <span class="n">club</span><span class="p">,</span> <span class="n">club_rating</span><span class="p">,</span> <span class="n">team</span><span class="p">,</span> <span class="n">team_rating</span><span class="p">])</span>

<span class="n">summary_dat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;full_name&#39;</span><span class="p">,</span> <span class="s1">&#39;position&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;overall&#39;</span><span class="p">,</span> <span class="s1">&#39;potential&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;wage&#39;</span><span class="p">,</span> <span class="s1">&#39;club&#39;</span><span class="p">,</span> <span class="s1">&#39;club_rating&#39;</span><span class="p">,</span> <span class="s1">&#39;team&#39;</span><span class="p">,</span> <span class="s1">&#39;team_rating&#39;</span><span class="p">])</span>

<span class="k">return</span> <span class="n">summary_dat</span>
</pre></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># for players in FIFA WC18 Expansion Jun 16, get their stats from FIFA 18 Jun 14</span>
<span class="n">players</span> <span class="o">=</span> <span class="n">get_players</span><span class="p">(</span><span class="n">teams</span><span class="p">,</span> <span class="s1">&#39;?v=18&amp;e=159124&amp;set=true&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">players</span><span class="p">[</span><span class="n">players</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">204713</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">KeyError</span>                                  Traceback (most recent call last)
<span class="ansi-green-intense-fg ansi-bold">&lt;ipython-input-27-e4543af2dc26&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">----&gt; 1</span><span class="ansi-yellow-intense-fg ansi-bold"> </span>players<span class="ansi-yellow-intense-fg ansi-bold">[</span>players<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;ID&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>

<span class="ansi-green-intense-fg ansi-bold">~\Anaconda3\lib\site-packages\pandas\core\frame.py</span> in <span class="ansi-cyan-fg">__getitem__</span><span class="ansi-blue-intense-fg ansi-bold">(self, key)</span>
<span class="ansi-green-fg">   2680</span>         <span class="ansi-green-intense-fg ansi-bold">if</span> isinstance<span class="ansi-yellow-intense-fg ansi-bold">(</span>key<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">(</span>Series<span class="ansi-yellow-intense-fg ansi-bold">,</span> np<span class="ansi-yellow-intense-fg ansi-bold">.</span>ndarray<span class="ansi-yellow-intense-fg ansi-bold">,</span> Index<span class="ansi-yellow-intense-fg ansi-bold">,</span> list<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">   2681</span>             <span class="ansi-red-intense-fg ansi-bold"># either boolean or fancy integer index</span>
<span class="ansi-green-intense-fg ansi-bold">-&gt; 2682</span><span class="ansi-yellow-intense-fg ansi-bold">             </span><span class="ansi-green-intense-fg ansi-bold">return</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_getitem_array<span class="ansi-yellow-intense-fg ansi-bold">(</span>key<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">   2683</span>         <span class="ansi-green-intense-fg ansi-bold">elif</span> isinstance<span class="ansi-yellow-intense-fg ansi-bold">(</span>key<span class="ansi-yellow-intense-fg ansi-bold">,</span> DataFrame<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">   2684</span>             <span class="ansi-green-intense-fg ansi-bold">return</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_getitem_frame<span class="ansi-yellow-intense-fg ansi-bold">(</span>key<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-intense-fg ansi-bold">~\Anaconda3\lib\site-packages\pandas\core\frame.py</span> in <span class="ansi-cyan-fg">_getitem_array</span><span class="ansi-blue-intense-fg ansi-bold">(self, key)</span>
<span class="ansi-green-fg">   2724</span>             <span class="ansi-green-intense-fg ansi-bold">return</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_take<span class="ansi-yellow-intense-fg ansi-bold">(</span>indexer<span class="ansi-yellow-intense-fg ansi-bold">,</span> axis<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-cyan-intense-fg ansi-bold">0</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">   2725</span>         <span class="ansi-green-intense-fg ansi-bold">else</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">-&gt; 2726</span><span class="ansi-yellow-intense-fg ansi-bold">             </span>indexer <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>loc<span class="ansi-yellow-intense-fg ansi-bold">.</span>_convert_to_indexer<span class="ansi-yellow-intense-fg ansi-bold">(</span>key<span class="ansi-yellow-intense-fg ansi-bold">,</span> axis<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-cyan-intense-fg ansi-bold">1</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">   2727</span>             <span class="ansi-green-intense-fg ansi-bold">return</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_take<span class="ansi-yellow-intense-fg ansi-bold">(</span>indexer<span class="ansi-yellow-intense-fg ansi-bold">,</span> axis<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-cyan-intense-fg ansi-bold">1</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">   2728</span>

<span class="ansi-green-intense-fg ansi-bold">~\Anaconda3\lib\site-packages\pandas\core\indexing.py</span> in <span class="ansi-cyan-fg">_convert_to_indexer</span><span class="ansi-blue-intense-fg ansi-bold">(self, obj, axis, is_setter)</span>
<span class="ansi-green-fg">   1325</span>                 <span class="ansi-green-intense-fg ansi-bold">if</span> mask<span class="ansi-yellow-intense-fg ansi-bold">.</span>any<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">   1326</span>                     raise KeyError(&#39;{mask} not in index&#39;
<span class="ansi-green-intense-fg ansi-bold">-&gt; 1327</span><span class="ansi-yellow-intense-fg ansi-bold">                                    .format(mask=objarr[mask]))
</span><span class="ansi-green-fg">   1328</span>
<span class="ansi-green-fg">   1329</span>                 <span class="ansi-green-intense-fg ansi-bold">return</span> com<span class="ansi-yellow-intense-fg ansi-bold">.</span>_values_from_object<span class="ansi-yellow-intense-fg ansi-bold">(</span>indexer<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-red-intense-fg ansi-bold">KeyError</span>: &#34;[&#39;212188&#39; &#39;176635&#39; &#39;188350&#39; ..., &#39;206566&#39; &#39;224769&#39; &#39;222402&#39;] not in index&#34;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">players</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;../datasets/sofifa/sofifa_players.csv&#39;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2018, Brian Lin, Shane Ong, Pat Sukhum, Matteo Zhang.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>